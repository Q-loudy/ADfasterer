{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";\nimport VTooltip from \"v-tooltip\";\nimport VueGtag from \"vue-gtag\";\nimport { DEV } from \"@/env\";\nimport { useLongPress, useRepeatingClick } from \"./longpress\";\nimport { notify } from \"./notify\";\nimport { state } from \"./ui.init\";\nimport GameUIComponent from \"@/components/GameUIComponent\";\nVue.mixin({\n  computed: {\n    $viewModel() {\n      return state.view;\n    }\n\n  },\n\n  created() {\n    if (this.update) {\n      this.on$(GAME_EVENT.UPDATE, this.update);\n\n      if (GameUI.initialized) {\n        this.update();\n      }\n    } // Following is used to force the recomputation of computed values\n    // from this fiddle https://codepen.io/sirlancelot/pen/JBeXeV\n\n\n    const recomputed = Object.create(null);\n    const watchers = this._computedWatchers;\n    if (!watchers) return;\n\n    for (const key in watchers) makeRecomputable(watchers[key], key, recomputed);\n\n    this.$recompute = key => recomputed[key] = !recomputed[key];\n\n    Vue.observable(recomputed);\n  },\n\n  destroyed() {\n    EventHub.ui.offAll(this);\n  },\n\n  methods: {\n    emitClick() {\n      this.$emit(\"click\");\n    },\n\n    emitInput(val) {\n      this.$emit(\"input\", val);\n    },\n\n    emitClose() {\n      this.$emit(\"close\");\n    },\n\n    on$(event, fn) {\n      EventHub.ui.on(event, fn, this);\n    },\n\n    format(value, places, placesUnder1000) {\n      return format(value, places, placesUnder1000);\n    },\n\n    formatInt(value) {\n      return formatInt(value);\n    },\n\n    formatPercents(value, places) {\n      return formatPercents(value, places);\n    },\n\n    formatRarity(value) {\n      return formatRarity(value);\n    },\n\n    formatX(value, places, placesUnder1000) {\n      return formatX(value, places, placesUnder1000);\n    },\n\n    formatPow(value, places, placesUnder1000) {\n      return formatPow(value, places, placesUnder1000);\n    },\n\n    formatPostBreak(value, places, placesUnder1000) {\n      return formatPostBreak(value, places, placesUnder1000);\n    },\n\n    pluralize,\n    quantify,\n    quantifyInt\n  }\n}); // This function is also from the fiddle above\n\nfunction makeRecomputable(watcher, key, recomputed) {\n  const original = watcher.getter;\n  recomputed[key] = true; // eslint-disable-next-line no-sequences\n\n  watcher.getter = vm => (recomputed[key], original.call(vm, vm));\n}\n\nconst ReactivityComplainer = {\n  complain() {\n    this.checkReactivity(player, \"player\");\n  },\n\n  checkReactivity(obj, path) {\n    if (obj === undefined || obj === null) {\n      return;\n    }\n\n    if (obj.__ob__ !== undefined) {\n      throw new Error(`Boi you fukked up - ${path} became REACTIVE (oh shite)`);\n    }\n\n    for (const key in obj) {\n      if (!Object.prototype.hasOwnProperty.call(obj, key)) continue;\n      const prop = obj[key];\n\n      if (typeof prop === \"object\") {\n        this.checkReactivity(prop, `${path}.${key}`);\n      }\n    }\n  }\n\n};\nexport const GameUI = {\n  notify,\n  events: [],\n  flushPromise: undefined,\n  initialized: false,\n  globalClickListener: null,\n  touchDevice: \"ontouchstart\" in window || window.navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0 || window.DocumentTouch && document instanceof DocumentTouch,\n\n  dispatch(event, args) {\n    const index = this.events.indexOf(event);\n\n    if (index !== -1) {\n      this.events.splice(index, 1);\n    }\n\n    if (event !== GAME_EVENT.UPDATE) {\n      this.events.push([event, args]);\n    }\n\n    if (this.flushPromise) return;\n    this.flushPromise = Promise.resolve().then(this.flushEvents.bind(this));\n  },\n\n  flushEvents() {\n    this.flushPromise = undefined;\n\n    if (DEV) {\n      if (PerformanceStats.isOn && PerformanceStats.currentBlocks.length > 0) {\n        Vue.nextTick(() => PerformanceStats.start(\"Vue Render\"));\n        PerformanceStats.start(\"Vue Update\");\n      }\n    }\n\n    for (const event of this.events) {\n      EventHub.ui.dispatch(event[0], event[1]);\n    }\n\n    EventHub.ui.dispatch(GAME_EVENT.UPDATE);\n\n    if (DEV) {\n      ReactivityComplainer.complain();\n\n      if (PerformanceStats.isOn && PerformanceStats.currentBlocks.length > 0) {\n        PerformanceStats.end();\n        Vue.nextTick(() => {\n          PerformanceStats.end(\"Vue Render\");\n          PerformanceStats.end(\"Frame Time\");\n          PerformanceStats.render();\n        });\n      }\n    }\n\n    this.events = [];\n  },\n\n  update() {\n    this.dispatch(GAME_EVENT.UPDATE);\n  }\n\n};\nexport const UIID = function () {\n  let id = 0;\n  return {\n    next: () => id++\n  };\n}();\nVTooltip.options.defaultClass = \"general-tooltip\";\nVTooltip.options.popover.defaultBaseClass = \"general-tooltip\";\nVTooltip.options.defaultTemplate = '<div role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>';\nVue.use(VTooltip);\n\n(function () {\n  const methodStrategy = Vue.config.optionMergeStrategies.methods; // eslint-disable-next-line max-params\n\n  Vue.config.optionMergeStrategies.methods = (parentVal, childVal, vm, key) => {\n    const result = methodStrategy(parentVal, childVal, vm, key);\n\n    const hasUpdate = val => val && val.update;\n\n    if (!hasUpdate(parentVal) || !hasUpdate(childVal)) return result;\n\n    result.update = function () {\n      parentVal.update.call(this);\n      childVal.update.call(this);\n    };\n\n    return result;\n  };\n})();\n\nuseLongPress(Vue);\nuseRepeatingClick(Vue);\nVue.use(VueGtag, {\n  config: {\n    id: \"UA-77268961-1\"\n  }\n});\nexport const ui = new Vue({\n  el: \"#ui\",\n  components: {\n    GameUIComponent\n  },\n  data: state,\n  computed: {\n    notation() {\n      return Notations.find(this.notationName);\n    },\n\n    currentGlyphTooltip() {\n      return this.view.tabs.reality.currentGlyphTooltip;\n    },\n\n    scrollWindow() {\n      return this.view.scrollWindow;\n    },\n\n    newUI() {\n      return this.view.newUI;\n    }\n\n  },\n  watch: {\n    currentGlyphTooltip(newVal) {\n      if (newVal !== -1 && !GameUI.globalClickListener) {\n        GameUI.globalClickListener = () => {\n          this.view.tabs.reality.currentGlyphTooltip = -1;\n          document.removeEventListener(\"click\", GameUI.globalClickListener);\n          GameUI.globalClickListener = null;\n        };\n\n        document.addEventListener(\"click\", GameUI.globalClickListener);\n      } else if (newVal === -1 && GameUI.globalClickListener) {\n        document.removeEventListener(\"click\", GameUI.globalClickListener);\n        GameUI.globalClickListener = null;\n      }\n    },\n\n    scrollWindow(newVal, oldVal) {\n      if (newVal !== 0 && oldVal === 0) {\n        this.scroll(Date.now());\n      }\n    }\n\n  },\n  methods: {\n    scroll(t) {\n      const now = Date.now();\n\n      if (this.view.scrollWindow) {\n        window.scrollBy(0, this.view.scrollWindow * (now - t) / 2);\n        setTimeout(() => this.scroll(now), 20);\n      }\n    }\n\n  },\n  render: h => h(GameUIComponent)\n});","map":{"version":3,"sources":["C:/Games/ADFasterer/ADfasterer/src/core/ui.js"],"names":["VTooltip","VueGtag","DEV","useLongPress","useRepeatingClick","notify","state","GameUIComponent","Vue","mixin","computed","$viewModel","view","created","update","on$","GAME_EVENT","UPDATE","GameUI","initialized","recomputed","Object","create","watchers","_computedWatchers","key","makeRecomputable","$recompute","observable","destroyed","EventHub","ui","offAll","methods","emitClick","$emit","emitInput","val","emitClose","event","fn","on","format","value","places","placesUnder1000","formatInt","formatPercents","formatRarity","formatX","formatPow","formatPostBreak","pluralize","quantify","quantifyInt","watcher","original","getter","vm","call","ReactivityComplainer","complain","checkReactivity","player","obj","path","undefined","__ob__","Error","prototype","hasOwnProperty","prop","events","flushPromise","globalClickListener","touchDevice","window","navigator","maxTouchPoints","msMaxTouchPoints","DocumentTouch","document","dispatch","args","index","indexOf","splice","push","Promise","resolve","then","flushEvents","bind","PerformanceStats","isOn","currentBlocks","length","nextTick","start","end","render","UIID","id","next","options","defaultClass","popover","defaultBaseClass","defaultTemplate","use","methodStrategy","config","optionMergeStrategies","parentVal","childVal","result","hasUpdate","el","components","data","notation","Notations","find","notationName","currentGlyphTooltip","tabs","reality","scrollWindow","newUI","watch","newVal","removeEventListener","addEventListener","oldVal","scroll","Date","now","t","scrollBy","setTimeout","h"],"mappings":";AAAA,OAAOA,QAAP,MAAqB,WAArB;AACA,OAAOC,OAAP,MAAoB,UAApB;AAEA,SAASC,GAAT,QAAoB,OAApB;AAEA,SAASC,YAAT,EAAuBC,iBAAvB,QAAgD,aAAhD;AACA,SAASC,MAAT,QAAuB,UAAvB;AACA,SAASC,KAAT,QAAsB,WAAtB;AAEA,OAAOC,eAAP,MAA4B,8BAA5B;AAEAC,GAAG,CAACC,KAAJ,CAAU;AACRC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,UAAU,GAAG;AACX,aAAOL,KAAK,CAACM,IAAb;AACD;;AAHO,GADF;;AAMRC,EAAAA,OAAO,GAAG;AACR,QAAI,KAAKC,MAAT,EAAiB;AACf,WAAKC,GAAL,CAASC,UAAU,CAACC,MAApB,EAA4B,KAAKH,MAAjC;;AACA,UAAII,MAAM,CAACC,WAAX,EAAwB;AACtB,aAAKL,MAAL;AACD;AACF,KANO,CAQR;AACA;;;AACA,UAAMM,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAnB;AACA,UAAMC,QAAQ,GAAG,KAAKC,iBAAtB;AAEA,QAAI,CAACD,QAAL,EAAe;;AAEf,SAAK,MAAME,GAAX,IAAkBF,QAAlB,EAA4BG,gBAAgB,CAACH,QAAQ,CAACE,GAAD,CAAT,EAAgBA,GAAhB,EAAqBL,UAArB,CAAhB;;AAE5B,SAAKO,UAAL,GAAkBF,GAAG,IAAIL,UAAU,CAACK,GAAD,CAAV,GAAkB,CAACL,UAAU,CAACK,GAAD,CAAtD;;AACAjB,IAAAA,GAAG,CAACoB,UAAJ,CAAeR,UAAf;AACD,GAzBO;;AA0BRS,EAAAA,SAAS,GAAG;AACVC,IAAAA,QAAQ,CAACC,EAAT,CAAYC,MAAZ,CAAmB,IAAnB;AACD,GA5BO;;AA6BRC,EAAAA,OAAO,EAAE;AACPC,IAAAA,SAAS,GAAG;AACV,WAAKC,KAAL,CAAW,OAAX;AACD,KAHM;;AAIPC,IAAAA,SAAS,CAACC,GAAD,EAAM;AACb,WAAKF,KAAL,CAAW,OAAX,EAAoBE,GAApB;AACD,KANM;;AAOPC,IAAAA,SAAS,GAAG;AACV,WAAKH,KAAL,CAAW,OAAX;AACD,KATM;;AAUPpB,IAAAA,GAAG,CAACwB,KAAD,EAAQC,EAAR,EAAY;AACbV,MAAAA,QAAQ,CAACC,EAAT,CAAYU,EAAZ,CAAeF,KAAf,EAAsBC,EAAtB,EAA0B,IAA1B;AACD,KAZM;;AAaPE,IAAAA,MAAM,CAACC,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,EAAiC;AACrC,aAAOH,MAAM,CAACC,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,CAAb;AACD,KAfM;;AAgBPC,IAAAA,SAAS,CAACH,KAAD,EAAQ;AACf,aAAOG,SAAS,CAACH,KAAD,CAAhB;AACD,KAlBM;;AAmBPI,IAAAA,cAAc,CAACJ,KAAD,EAAQC,MAAR,EAAgB;AAC5B,aAAOG,cAAc,CAACJ,KAAD,EAAQC,MAAR,CAArB;AACD,KArBM;;AAsBPI,IAAAA,YAAY,CAACL,KAAD,EAAQ;AAClB,aAAOK,YAAY,CAACL,KAAD,CAAnB;AACD,KAxBM;;AAyBPM,IAAAA,OAAO,CAACN,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,EAAiC;AACtC,aAAOI,OAAO,CAACN,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,CAAd;AACD,KA3BM;;AA4BPK,IAAAA,SAAS,CAACP,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,EAAiC;AACxC,aAAOK,SAAS,CAACP,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,CAAhB;AACD,KA9BM;;AA+BPM,IAAAA,eAAe,CAACR,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,EAAiC;AAC9C,aAAOM,eAAe,CAACR,KAAD,EAAQC,MAAR,EAAgBC,eAAhB,CAAtB;AACD,KAjCM;;AAkCPO,IAAAA,SAlCO;AAmCPC,IAAAA,QAnCO;AAoCPC,IAAAA;AApCO;AA7BD,CAAV,E,CAqEA;;AACA,SAAS5B,gBAAT,CAA0B6B,OAA1B,EAAmC9B,GAAnC,EAAwCL,UAAxC,EAAoD;AAClD,QAAMoC,QAAQ,GAAGD,OAAO,CAACE,MAAzB;AACArC,EAAAA,UAAU,CAACK,GAAD,CAAV,GAAkB,IAAlB,CAFkD,CAIlD;;AACA8B,EAAAA,OAAO,CAACE,MAAR,GAAiBC,EAAE,KAAKtC,UAAU,CAACK,GAAD,CAAV,EAAiB+B,QAAQ,CAACG,IAAT,CAAcD,EAAd,EAAkBA,EAAlB,CAAtB,CAAnB;AACD;;AAED,MAAME,oBAAoB,GAAG;AAC3BC,EAAAA,QAAQ,GAAG;AACT,SAAKC,eAAL,CAAqBC,MAArB,EAA6B,QAA7B;AACD,GAH0B;;AAI3BD,EAAAA,eAAe,CAACE,GAAD,EAAMC,IAAN,EAAY;AACzB,QAAID,GAAG,KAAKE,SAAR,IAAqBF,GAAG,KAAK,IAAjC,EAAuC;AACrC;AACD;;AACD,QAAIA,GAAG,CAACG,MAAJ,KAAeD,SAAnB,EAA8B;AAC5B,YAAM,IAAIE,KAAJ,CAAW,uBAAsBH,IAAK,6BAAtC,CAAN;AACD;;AACD,SAAK,MAAMxC,GAAX,IAAkBuC,GAAlB,EAAuB;AACrB,UAAI,CAAC3C,MAAM,CAACgD,SAAP,CAAiBC,cAAjB,CAAgCX,IAAhC,CAAqCK,GAArC,EAA0CvC,GAA1C,CAAL,EAAqD;AACrD,YAAM8C,IAAI,GAAGP,GAAG,CAACvC,GAAD,CAAhB;;AACA,UAAI,OAAO8C,IAAP,KAAgB,QAApB,EAA8B;AAC5B,aAAKT,eAAL,CAAqBS,IAArB,EAA4B,GAAEN,IAAK,IAAGxC,GAAI,EAA1C;AACD;AACF;AACF;;AAlB0B,CAA7B;AAqBA,OAAO,MAAMP,MAAM,GAAG;AACpBb,EAAAA,MADoB;AAEpBmE,EAAAA,MAAM,EAAE,EAFY;AAGpBC,EAAAA,YAAY,EAAEP,SAHM;AAIpB/C,EAAAA,WAAW,EAAE,KAJO;AAKpBuD,EAAAA,mBAAmB,EAAE,IALD;AAMpBC,EAAAA,WAAW,EAAG,kBAAkBC,MAAlB,IACZA,MAAM,CAACC,SAAP,CAAiBC,cAAjB,GAAkC,CADtB,IAC2BF,MAAM,CAACC,SAAP,CAAiBE,gBAAjB,GAAoC,CAD/D,IAEXH,MAAM,CAACI,aAAP,IAAwBC,QAAQ,YAAYD,aAR3B;;AASpBE,EAAAA,QAAQ,CAAC3C,KAAD,EAAQ4C,IAAR,EAAc;AACpB,UAAMC,KAAK,GAAG,KAAKZ,MAAL,CAAYa,OAAZ,CAAoB9C,KAApB,CAAd;;AACA,QAAI6C,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChB,WAAKZ,MAAL,CAAYc,MAAZ,CAAmBF,KAAnB,EAA0B,CAA1B;AACD;;AACD,QAAI7C,KAAK,KAAKvB,UAAU,CAACC,MAAzB,EAAiC;AAC/B,WAAKuD,MAAL,CAAYe,IAAZ,CAAiB,CAAChD,KAAD,EAAQ4C,IAAR,CAAjB;AACD;;AACD,QAAI,KAAKV,YAAT,EAAuB;AACvB,SAAKA,YAAL,GAAoBe,OAAO,CAACC,OAAR,GACjBC,IADiB,CACZ,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CADY,CAApB;AAED,GApBmB;;AAqBpBD,EAAAA,WAAW,GAAG;AACZ,SAAKlB,YAAL,GAAoBP,SAApB;;AACA,QAAIhE,GAAJ,EAAS;AACP,UAAI2F,gBAAgB,CAACC,IAAjB,IAAyBD,gBAAgB,CAACE,aAAjB,CAA+BC,MAA/B,GAAwC,CAArE,EAAwE;AACtExF,QAAAA,GAAG,CAACyF,QAAJ,CAAa,MAAMJ,gBAAgB,CAACK,KAAjB,CAAuB,YAAvB,CAAnB;AACAL,QAAAA,gBAAgB,CAACK,KAAjB,CAAuB,YAAvB;AACD;AACF;;AACD,SAAK,MAAM3D,KAAX,IAAoB,KAAKiC,MAAzB,EAAiC;AAC/B1C,MAAAA,QAAQ,CAACC,EAAT,CAAYmD,QAAZ,CAAqB3C,KAAK,CAAC,CAAD,CAA1B,EAA+BA,KAAK,CAAC,CAAD,CAApC;AACD;;AACDT,IAAAA,QAAQ,CAACC,EAAT,CAAYmD,QAAZ,CAAqBlE,UAAU,CAACC,MAAhC;;AACA,QAAIf,GAAJ,EAAS;AACP0D,MAAAA,oBAAoB,CAACC,QAArB;;AACA,UAAIgC,gBAAgB,CAACC,IAAjB,IAAyBD,gBAAgB,CAACE,aAAjB,CAA+BC,MAA/B,GAAwC,CAArE,EAAwE;AACtEH,QAAAA,gBAAgB,CAACM,GAAjB;AACA3F,QAAAA,GAAG,CAACyF,QAAJ,CAAa,MAAM;AACjBJ,UAAAA,gBAAgB,CAACM,GAAjB,CAAqB,YAArB;AACAN,UAAAA,gBAAgB,CAACM,GAAjB,CAAqB,YAArB;AACAN,UAAAA,gBAAgB,CAACO,MAAjB;AACD,SAJD;AAKD;AACF;;AACD,SAAK5B,MAAL,GAAc,EAAd;AACD,GA7CmB;;AA8CpB1D,EAAAA,MAAM,GAAG;AACP,SAAKoE,QAAL,CAAclE,UAAU,CAACC,MAAzB;AACD;;AAhDmB,CAAf;AAmDP,OAAO,MAAMoF,IAAI,GAAI,YAAW;AAC9B,MAAIC,EAAE,GAAG,CAAT;AACA,SAAO;AAAEC,IAAAA,IAAI,EAAE,MAAMD,EAAE;AAAhB,GAAP;AACD,CAHoB,EAAd;AAKPtG,QAAQ,CAACwG,OAAT,CAAiBC,YAAjB,GAAgC,iBAAhC;AACAzG,QAAQ,CAACwG,OAAT,CAAiBE,OAAjB,CAAyBC,gBAAzB,GAA4C,iBAA5C;AACA3G,QAAQ,CAACwG,OAAT,CAAiBI,eAAjB,GACE,8FADF;AAEApG,GAAG,CAACqG,GAAJ,CAAQ7G,QAAR;;AAEC,aAAW;AACV,QAAM8G,cAAc,GAAGtG,GAAG,CAACuG,MAAJ,CAAWC,qBAAX,CAAiC/E,OAAxD,CADU,CAEV;;AACAzB,EAAAA,GAAG,CAACuG,MAAJ,CAAWC,qBAAX,CAAiC/E,OAAjC,GAA2C,CAACgF,SAAD,EAAYC,QAAZ,EAAsBxD,EAAtB,EAA0BjC,GAA1B,KAAkC;AAC3E,UAAM0F,MAAM,GAAGL,cAAc,CAACG,SAAD,EAAYC,QAAZ,EAAsBxD,EAAtB,EAA0BjC,GAA1B,CAA7B;;AACA,UAAM2F,SAAS,GAAG/E,GAAG,IAAIA,GAAG,IAAIA,GAAG,CAACvB,MAApC;;AACA,QAAI,CAACsG,SAAS,CAACH,SAAD,CAAV,IAAyB,CAACG,SAAS,CAACF,QAAD,CAAvC,EAAmD,OAAOC,MAAP;;AACnDA,IAAAA,MAAM,CAACrG,MAAP,GAAgB,YAAW;AACzBmG,MAAAA,SAAS,CAACnG,MAAV,CAAiB6C,IAAjB,CAAsB,IAAtB;AACAuD,MAAAA,QAAQ,CAACpG,MAAT,CAAgB6C,IAAhB,CAAqB,IAArB;AACD,KAHD;;AAIA,WAAOwD,MAAP;AACD,GATD;AAUD,CAbA,GAAD;;AAeAhH,YAAY,CAACK,GAAD,CAAZ;AACAJ,iBAAiB,CAACI,GAAD,CAAjB;AACAA,GAAG,CAACqG,GAAJ,CAAQ5G,OAAR,EAAiB;AACf8G,EAAAA,MAAM,EAAE;AAAET,IAAAA,EAAE,EAAE;AAAN;AADO,CAAjB;AAIA,OAAO,MAAMvE,EAAE,GAAG,IAAIvB,GAAJ,CAAQ;AACxB6G,EAAAA,EAAE,EAAE,KADoB;AAExBC,EAAAA,UAAU,EAAE;AACV/G,IAAAA;AADU,GAFY;AAKxBgH,EAAAA,IAAI,EAAEjH,KALkB;AAMxBI,EAAAA,QAAQ,EAAE;AACR8G,IAAAA,QAAQ,GAAG;AACT,aAAOC,SAAS,CAACC,IAAV,CAAe,KAAKC,YAApB,CAAP;AACD,KAHO;;AAIRC,IAAAA,mBAAmB,GAAG;AACpB,aAAO,KAAKhH,IAAL,CAAUiH,IAAV,CAAeC,OAAf,CAAuBF,mBAA9B;AACD,KANO;;AAORG,IAAAA,YAAY,GAAG;AACb,aAAO,KAAKnH,IAAL,CAAUmH,YAAjB;AACD,KATO;;AAURC,IAAAA,KAAK,GAAG;AACN,aAAO,KAAKpH,IAAL,CAAUoH,KAAjB;AACD;;AAZO,GANc;AAoBxBC,EAAAA,KAAK,EAAE;AACLL,IAAAA,mBAAmB,CAACM,MAAD,EAAS;AAC1B,UAAIA,MAAM,KAAK,CAAC,CAAZ,IAAiB,CAAChH,MAAM,CAACwD,mBAA7B,EAAkD;AAChDxD,QAAAA,MAAM,CAACwD,mBAAP,GAA6B,MAAM;AACjC,eAAK9D,IAAL,CAAUiH,IAAV,CAAeC,OAAf,CAAuBF,mBAAvB,GAA6C,CAAC,CAA9C;AACA3C,UAAAA,QAAQ,CAACkD,mBAAT,CAA6B,OAA7B,EAAsCjH,MAAM,CAACwD,mBAA7C;AACAxD,UAAAA,MAAM,CAACwD,mBAAP,GAA6B,IAA7B;AACD,SAJD;;AAKAO,QAAAA,QAAQ,CAACmD,gBAAT,CAA0B,OAA1B,EAAmClH,MAAM,CAACwD,mBAA1C;AACD,OAPD,MAOO,IAAIwD,MAAM,KAAK,CAAC,CAAZ,IAAiBhH,MAAM,CAACwD,mBAA5B,EAAiD;AACtDO,QAAAA,QAAQ,CAACkD,mBAAT,CAA6B,OAA7B,EAAsCjH,MAAM,CAACwD,mBAA7C;AACAxD,QAAAA,MAAM,CAACwD,mBAAP,GAA6B,IAA7B;AACD;AACF,KAbI;;AAcLqD,IAAAA,YAAY,CAACG,MAAD,EAASG,MAAT,EAAiB;AAC3B,UAAIH,MAAM,KAAK,CAAX,IAAgBG,MAAM,KAAK,CAA/B,EAAkC;AAChC,aAAKC,MAAL,CAAYC,IAAI,CAACC,GAAL,EAAZ;AACD;AACF;;AAlBI,GApBiB;AAwCxBvG,EAAAA,OAAO,EAAE;AACPqG,IAAAA,MAAM,CAACG,CAAD,EAAI;AACR,YAAMD,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAZ;;AACA,UAAI,KAAK5H,IAAL,CAAUmH,YAAd,EAA4B;AAC1BnD,QAAAA,MAAM,CAAC8D,QAAP,CAAgB,CAAhB,EAAmB,KAAK9H,IAAL,CAAUmH,YAAV,IAA0BS,GAAG,GAAGC,CAAhC,IAAqC,CAAxD;AACAE,QAAAA,UAAU,CAAC,MAAM,KAAKL,MAAL,CAAYE,GAAZ,CAAP,EAAyB,EAAzB,CAAV;AACD;AACF;;AAPM,GAxCe;AAiDxBpC,EAAAA,MAAM,EAAEwC,CAAC,IAAIA,CAAC,CAACrI,eAAD;AAjDU,CAAR,CAAX","sourcesContent":["import VTooltip from \"v-tooltip\";\r\nimport VueGtag from \"vue-gtag\";\r\n\r\nimport { DEV } from \"@/env\";\r\n\r\nimport { useLongPress, useRepeatingClick } from \"./longpress\";\r\nimport { notify } from \"./notify\";\r\nimport { state } from \"./ui.init\";\r\n\r\nimport GameUIComponent from \"@/components/GameUIComponent\";\r\n\r\nVue.mixin({\r\n  computed: {\r\n    $viewModel() {\r\n      return state.view;\r\n    }\r\n  },\r\n  created() {\r\n    if (this.update) {\r\n      this.on$(GAME_EVENT.UPDATE, this.update);\r\n      if (GameUI.initialized) {\r\n        this.update();\r\n      }\r\n    }\r\n\r\n    // Following is used to force the recomputation of computed values\r\n    // from this fiddle https://codepen.io/sirlancelot/pen/JBeXeV\r\n    const recomputed = Object.create(null);\r\n    const watchers = this._computedWatchers;\r\n\r\n    if (!watchers) return;\r\n\r\n    for (const key in watchers) makeRecomputable(watchers[key], key, recomputed);\r\n\r\n    this.$recompute = key => recomputed[key] = !recomputed[key];\r\n    Vue.observable(recomputed);\r\n  },\r\n  destroyed() {\r\n    EventHub.ui.offAll(this);\r\n  },\r\n  methods: {\r\n    emitClick() {\r\n      this.$emit(\"click\");\r\n    },\r\n    emitInput(val) {\r\n      this.$emit(\"input\", val);\r\n    },\r\n    emitClose() {\r\n      this.$emit(\"close\");\r\n    },\r\n    on$(event, fn) {\r\n      EventHub.ui.on(event, fn, this);\r\n    },\r\n    format(value, places, placesUnder1000) {\r\n      return format(value, places, placesUnder1000);\r\n    },\r\n    formatInt(value) {\r\n      return formatInt(value);\r\n    },\r\n    formatPercents(value, places) {\r\n      return formatPercents(value, places);\r\n    },\r\n    formatRarity(value) {\r\n      return formatRarity(value);\r\n    },\r\n    formatX(value, places, placesUnder1000) {\r\n      return formatX(value, places, placesUnder1000);\r\n    },\r\n    formatPow(value, places, placesUnder1000) {\r\n      return formatPow(value, places, placesUnder1000);\r\n    },\r\n    formatPostBreak(value, places, placesUnder1000) {\r\n      return formatPostBreak(value, places, placesUnder1000);\r\n    },\r\n    pluralize,\r\n    quantify,\r\n    quantifyInt\r\n  }\r\n});\r\n\r\n// This function is also from the fiddle above\r\nfunction makeRecomputable(watcher, key, recomputed) {\r\n  const original = watcher.getter;\r\n  recomputed[key] = true;\r\n\r\n  // eslint-disable-next-line no-sequences\r\n  watcher.getter = vm => (recomputed[key], original.call(vm, vm));\r\n}\r\n\r\nconst ReactivityComplainer = {\r\n  complain() {\r\n    this.checkReactivity(player, \"player\");\r\n  },\r\n  checkReactivity(obj, path) {\r\n    if (obj === undefined || obj === null) {\r\n      return;\r\n    }\r\n    if (obj.__ob__ !== undefined) {\r\n      throw new Error(`Boi you fukked up - ${path} became REACTIVE (oh shite)`);\r\n    }\r\n    for (const key in obj) {\r\n      if (!Object.prototype.hasOwnProperty.call(obj, key)) continue;\r\n      const prop = obj[key];\r\n      if (typeof prop === \"object\") {\r\n        this.checkReactivity(prop, `${path}.${key}`);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const GameUI = {\r\n  notify,\r\n  events: [],\r\n  flushPromise: undefined,\r\n  initialized: false,\r\n  globalClickListener: null,\r\n  touchDevice: (\"ontouchstart\" in window ||\r\n    window.navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0 ||\r\n    (window.DocumentTouch && document instanceof DocumentTouch)),\r\n  dispatch(event, args) {\r\n    const index = this.events.indexOf(event);\r\n    if (index !== -1) {\r\n      this.events.splice(index, 1);\r\n    }\r\n    if (event !== GAME_EVENT.UPDATE) {\r\n      this.events.push([event, args]);\r\n    }\r\n    if (this.flushPromise) return;\r\n    this.flushPromise = Promise.resolve()\r\n      .then(this.flushEvents.bind(this));\r\n  },\r\n  flushEvents() {\r\n    this.flushPromise = undefined;\r\n    if (DEV) {\r\n      if (PerformanceStats.isOn && PerformanceStats.currentBlocks.length > 0) {\r\n        Vue.nextTick(() => PerformanceStats.start(\"Vue Render\"));\r\n        PerformanceStats.start(\"Vue Update\");\r\n      }\r\n    }\r\n    for (const event of this.events) {\r\n      EventHub.ui.dispatch(event[0], event[1]);\r\n    }\r\n    EventHub.ui.dispatch(GAME_EVENT.UPDATE);\r\n    if (DEV) {\r\n      ReactivityComplainer.complain();\r\n      if (PerformanceStats.isOn && PerformanceStats.currentBlocks.length > 0) {\r\n        PerformanceStats.end();\r\n        Vue.nextTick(() => {\r\n          PerformanceStats.end(\"Vue Render\");\r\n          PerformanceStats.end(\"Frame Time\");\r\n          PerformanceStats.render();\r\n        });\r\n      }\r\n    }\r\n    this.events = [];\r\n  },\r\n  update() {\r\n    this.dispatch(GAME_EVENT.UPDATE);\r\n  }\r\n};\r\n\r\nexport const UIID = (function() {\r\n  let id = 0;\r\n  return { next: () => id++ };\r\n}());\r\n\r\nVTooltip.options.defaultClass = \"general-tooltip\";\r\nVTooltip.options.popover.defaultBaseClass = \"general-tooltip\";\r\nVTooltip.options.defaultTemplate =\r\n  '<div role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>';\r\nVue.use(VTooltip);\r\n\r\n(function() {\r\n  const methodStrategy = Vue.config.optionMergeStrategies.methods;\r\n  // eslint-disable-next-line max-params\r\n  Vue.config.optionMergeStrategies.methods = (parentVal, childVal, vm, key) => {\r\n    const result = methodStrategy(parentVal, childVal, vm, key);\r\n    const hasUpdate = val => val && val.update;\r\n    if (!hasUpdate(parentVal) || !hasUpdate(childVal)) return result;\r\n    result.update = function() {\r\n      parentVal.update.call(this);\r\n      childVal.update.call(this);\r\n    };\r\n    return result;\r\n  };\r\n}());\r\n\r\nuseLongPress(Vue);\r\nuseRepeatingClick(Vue);\r\nVue.use(VueGtag, {\r\n  config: { id: \"UA-77268961-1\" }\r\n});\r\n\r\nexport const ui = new Vue({\r\n  el: \"#ui\",\r\n  components: {\r\n    GameUIComponent\r\n  },\r\n  data: state,\r\n  computed: {\r\n    notation() {\r\n      return Notations.find(this.notationName);\r\n    },\r\n    currentGlyphTooltip() {\r\n      return this.view.tabs.reality.currentGlyphTooltip;\r\n    },\r\n    scrollWindow() {\r\n      return this.view.scrollWindow;\r\n    },\r\n    newUI() {\r\n      return this.view.newUI;\r\n    },\r\n  },\r\n  watch: {\r\n    currentGlyphTooltip(newVal) {\r\n      if (newVal !== -1 && !GameUI.globalClickListener) {\r\n        GameUI.globalClickListener = () => {\r\n          this.view.tabs.reality.currentGlyphTooltip = -1;\r\n          document.removeEventListener(\"click\", GameUI.globalClickListener);\r\n          GameUI.globalClickListener = null;\r\n        };\r\n        document.addEventListener(\"click\", GameUI.globalClickListener);\r\n      } else if (newVal === -1 && GameUI.globalClickListener) {\r\n        document.removeEventListener(\"click\", GameUI.globalClickListener);\r\n        GameUI.globalClickListener = null;\r\n      }\r\n    },\r\n    scrollWindow(newVal, oldVal) {\r\n      if (newVal !== 0 && oldVal === 0) {\r\n        this.scroll(Date.now());\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    scroll(t) {\r\n      const now = Date.now();\r\n      if (this.view.scrollWindow) {\r\n        window.scrollBy(0, this.view.scrollWindow * (now - t) / 2);\r\n        setTimeout(() => this.scroll(now), 20);\r\n      }\r\n    }\r\n  },\r\n  render: h => h(GameUIComponent)\r\n});\r\n"]},"metadata":{},"sourceType":"module"}