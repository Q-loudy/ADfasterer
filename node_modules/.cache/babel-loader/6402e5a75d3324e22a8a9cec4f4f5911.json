{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.reverse.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport TWEEN from \"tween.js\";\nimport { ElectronRuntime, SteamRuntime } from \"@/steam\";\nimport { DC } from \"./core/constants\";\nimport { deepmergeAll } from \"@/utility/deepmerge\";\nimport { DEV } from \"@/env\";\nimport { SpeedrunMilestones } from \"./core/speedrun\";\nimport { Cloud } from \"./core/storage\";\nimport { supportedBrowsers } from \"./supported-browsers\";\nimport Payments from \"./core/payments\";\n\nif (GlobalErrorHandler.handled) {\n  throw new Error(\"Initialization failed\");\n}\n\nGlobalErrorHandler.cleanStart = true;\nexport function playerInfinityUpgradesOnReset() {\n  const infinityUpgrades = new Set([\"timeMult\", \"dimMult\", \"timeMult2\", \"skipReset1\", \"skipReset2\", \"unspentBonus\", \"27Mult\", \"18Mult\", \"36Mult\", \"resetMult\", \"skipReset3\", \"passiveGen\", \"45Mult\", \"resetBoost\", \"galaxyBoost\", \"skipResetGalaxy\", \"ipOffline\"]);\n  const breakInfinityUpgrades = new Set([\"timeMult\", \"dimMult\", \"timeMult2\", \"skipReset1\", \"skipReset2\", \"unspentBonus\", \"27Mult\", \"18Mult\", \"36Mult\", \"resetMult\", \"skipReset3\", \"passiveGen\", \"45Mult\", \"resetBoost\", \"galaxyBoost\", \"skipResetGalaxy\", \"totalMult\", \"currentMult\", \"postGalaxy\", \"challengeMult\", \"achievementMult\", \"infinitiedMult\", \"infinitiedGeneration\", \"autoBuyerUpgrade\", \"autobuyMaxDimboosts\", \"ipOffline\"]);\n\n  if (PelleUpgrade.keepBreakInfinityUpgrades.canBeApplied) {\n    player.infinityUpgrades = new Set([...player.infinityUpgrades].filter(u => breakInfinityUpgrades.has(u)));\n    return;\n  }\n\n  if (PelleUpgrade.keepInfinityUpgrades.canBeApplied) {\n    player.infinityUpgrades = new Set([...player.infinityUpgrades].filter(u => infinityUpgrades.has(u)));\n    player.infinityRebuyables = [0, 0, 0];\n    GameCache.tickSpeedMultDecrease.invalidate();\n    GameCache.dimensionMultDecrease.invalidate();\n    return;\n  }\n\n  if (RealityUpgrade(10).isBought || EternityMilestone.keepBreakUpgrades.isReached) {\n    player.infinityUpgrades = breakInfinityUpgrades;\n    player.infinityRebuyables = [8, 7, 10];\n  } else if (EternityMilestone.keepInfinityUpgrades.isReached) {\n    player.infinityUpgrades = infinityUpgrades;\n    player.infinityRebuyables = [0, 0, 0];\n  } else {\n    player.infinityUpgrades.clear();\n    player.infinityRebuyables = [0, 0, 0];\n  }\n\n  if (Pelle.isDoomed) {\n    player.infinityUpgrades.clear();\n    player.infinityRebuyables = [0, 0, 0];\n  }\n\n  GameCache.tickSpeedMultDecrease.invalidate();\n  GameCache.dimensionMultDecrease.invalidate();\n}\nexport function breakInfinity() {\n  if (!Autobuyer.bigCrunch.hasMaxedInterval) return;\n  if (InfinityChallenge.isRunning) return;\n\n  for (const autobuyer of Autobuyers.all) {\n    if (autobuyer.data.interval !== undefined) autobuyer.maxIntervalForFree();\n  } // There's a potential migration edge case involving already-maxed autobuyers; this should give the achievement\n\n\n  Achievement(61).tryUnlock();\n  player.break = !player.break;\n  TabNotification.ICUnlock.tryTrigger();\n  EventHub.dispatch(player.break ? GAME_EVENT.BREAK_INFINITY : GAME_EVENT.FIX_INFINITY);\n  GameUI.update();\n}\nexport function gainedInfinityPoints() {\n  const div = Effects.min(308, Achievement(103), TimeStudy(111));\n\n  if (Pelle.isDisabled(\"IPMults\")) {\n    return Decimal.pow10(player.records.thisInfinity.maxAM.log10() / div - 0.75).timesEffectsOf(PelleRifts.vacuum).times(Pelle.specialGlyphEffect.infinity).floor();\n  }\n\n  let ip = player.break ? Decimal.pow10(player.records.thisInfinity.maxAM.log10() / div - 0.75) : new Decimal(308 / div);\n\n  if (Effarig.isRunning && Effarig.currentStage === EFFARIG_STAGES.ETERNITY) {\n    ip = ip.min(DC.E200);\n  }\n\n  ip = ip.times(GameCache.totalIPMult.value);\n\n  if (Teresa.isRunning) {\n    ip = ip.pow(0.55);\n  } else if (V.isRunning) {\n    ip = ip.pow(0.5);\n  } else if (Laitela.isRunning) {\n    ip = dilatedValueOf(ip);\n  }\n\n  if (GlyphAlteration.isAdded(\"infinity\")) {\n    ip = ip.pow(getSecondaryGlyphEffect(\"infinityIP\"));\n  }\n\n  return ip.floor();\n}\n\nfunction totalEPMult() {\n  return Pelle.isDisabled(\"EPMults\") ? Pelle.specialGlyphEffect.time.timesEffectOf(PelleRifts.vacuum.milestones[2]) : getAdjustedGlyphEffect(\"cursedEP\").times(ShopPurchase.EPPurchases.currentMult).timesEffectsOf(EternityUpgrade.epMult, TimeStudy(61), TimeStudy(122), TimeStudy(121), TimeStudy(123), RealityUpgrade(12), GlyphEffect.epMult);\n}\n\nexport function gainedEternityPoints() {\n  let ep = DC.D5.pow(player.records.thisEternity.maxIP.plus(gainedInfinityPoints()).log10() / (308 - PelleRifts.recursion.effectValue.toNumber()) - 0.7).times(totalEPMult());\n\n  if (Teresa.isRunning) {\n    ep = ep.pow(0.55);\n  } else if (V.isRunning) {\n    ep = ep.pow(0.5);\n  } else if (Laitela.isRunning) {\n    ep = dilatedValueOf(ep);\n  }\n\n  if (GlyphAlteration.isAdded(\"time\")) {\n    ep = ep.pow(getSecondaryGlyphEffect(\"timeEP\"));\n  }\n\n  return ep.floor();\n}\nexport function requiredIPForEP(epAmount) {\n  return Decimal.pow10(308 * (Decimal.log(Decimal.divide(epAmount, totalEPMult()), 5) + 0.7)).clampMin(Number.MAX_VALUE);\n}\nexport function gainedGlyphLevel() {\n  const glyphState = getGlyphLevelInputs();\n  let rawLevel = Math.floor(glyphState.rawLevel);\n  if (!isFinite(rawLevel)) rawLevel = 0;\n  let actualLevel = Math.floor(glyphState.actualLevel);\n  if (!isFinite(actualLevel)) actualLevel = 0;\n  return {\n    rawLevel,\n    actualLevel\n  };\n}\nexport function resetChallengeStuff() {\n  player.chall2Pow = 1;\n  player.chall3Pow = DC.D0_01;\n  Currency.matter.reset();\n  player.chall8TotalSacrifice = DC.D1;\n  player.postC4Tier = 1;\n}\nexport function ratePerMinute(amount, time) {\n  return Decimal.divide(amount, time / (60 * 1000));\n} // eslint-disable-next-line max-params\n\nexport function addInfinityTime(time, realTime, ip, infinities) {\n  let challenge = \"\";\n  if (player.challenge.normal.current) challenge = `Normal Challenge ${player.challenge.normal.current}`;\n  if (player.challenge.infinity.current) challenge = `Infinity Challenge ${player.challenge.infinity.current}`;\n  player.records.recentInfinities.pop();\n  player.records.recentInfinities.unshift([time / getGlobalSpeedFactor(), realTime, ip, infinities, challenge]);\n  GameCache.bestRunIPPM.invalidate();\n}\nexport function resetInfinityRuns() {\n  player.records.recentInfinities = Array.from({\n    length: 10\n  }, () => [Number.MAX_VALUE, Number.MAX_VALUE, DC.D1, DC.D1, \"\"]);\n  GameCache.bestRunIPPM.invalidate();\n} // Player gains 50% of infinities they would get based on their best infinities/hour crunch if they have the\n// milestone and turned on infinity autobuyer with 1 minute or less per crunch\n\nexport function getInfinitiedMilestoneReward(ms, considerMilestoneReached) {\n  return Autobuyer.bigCrunch.autoInfinitiesAvailable(considerMilestoneReached) ? Decimal.floor(player.records.thisEternity.bestInfinitiesPerMs.times(ms).dividedBy(2)) : DC.D0;\n} // eslint-disable-next-line max-params\n\nexport function addEternityTime(time, realTime, ep, eternities) {\n  let challenge = \"\";\n\n  if (player.challenge.eternity.current) {\n    const currEC = player.challenge.eternity.current;\n    const ec = EternityChallenge(currEC);\n    const challText = player.dilation.active ? \"Dilated EC\" : \"Eternity Challenge\";\n    challenge = `${challText} ${currEC} (${formatInt(ec.completions)}/${formatInt(ec.maxCompletions)})`;\n  } else if (player.dilation.active) challenge = \"Time Dilation\"; // If we call this function outside of dilation, it uses the existing AM and produces an erroneous number\n\n\n  const gainedTP = player.dilation.active ? getTachyonGain() : DC.D0;\n  player.records.recentEternities.pop();\n  player.records.recentEternities.unshift([time / getGlobalSpeedFactor(), realTime, ep, eternities, challenge, gainedTP]);\n  GameCache.averageRealTimePerEternity.invalidate();\n}\nexport function resetEternityRuns() {\n  player.records.recentEternities = Array.from({\n    length: 10\n  }, () => [Number.MAX_VALUE, Number.MAX_VALUE, DC.D1, DC.D1, \"\", DC.D0]);\n  GameCache.averageRealTimePerEternity.invalidate();\n} // Player gains 50% of the eternities they would get if they continuously repeated their fastest eternity, if they\n// have the auto-eternity milestone and turned on eternity autobuyer with 0 EP\n\nexport function getEternitiedMilestoneReward(ms, considerMilestoneReached) {\n  return Autobuyer.eternity.autoEternitiesAvailable(considerMilestoneReached) ? Decimal.floor(player.records.thisReality.bestEternitiesPerMs.times(ms).dividedBy(2)) : DC.D0;\n}\n\nfunction isOfflineEPGainEnabled() {\n  return player.options.offlineProgress && !Autobuyer.bigCrunch.autoInfinitiesAvailable() && !Autobuyer.eternity.autoEternitiesAvailable();\n}\n\nexport function getOfflineEPGain(ms) {\n  if (!EternityMilestone.autoEP.isReached || !isOfflineEPGainEnabled()) return DC.D0;\n  return player.records.bestEternity.bestEPminReality.times(TimeSpan.fromMilliseconds(ms).totalMinutes / 4);\n} // Note: realities and ampFactor must be distinct because there are a few things farther up which only multiply\n// reality count and none of the other things\n// eslint-disable-next-line max-params\n\nexport function addRealityTime(time, realTime, rm, level, realities, ampFactor, projIM) {\n  let reality = \"\";\n  const celestials = [Teresa, Effarig, Enslaved, V, Ra, Laitela];\n\n  for (const cel of celestials) {\n    if (cel.isRunning) reality = cel.displayName;\n  }\n\n  const shards = Effarig.shardsGained;\n  player.records.recentRealities.pop();\n  player.records.recentRealities.unshift([time / getGlobalSpeedFactor(), realTime, rm.times(ampFactor), realities, reality, level, shards * ampFactor, projIM]);\n}\nexport function gainedInfinities() {\n  if (EternityChallenge(4).isRunning || Pelle.isDisabled(\"InfinitiedMults\")) {\n    return DC.D1;\n  }\n\n  let infGain = Effects.max(1, Achievement(87)).toDecimal();\n  infGain = infGain.timesEffectsOf(TimeStudy(32), RealityUpgrade(5), RealityUpgrade(7), Achievement(131).effects.infinitiesGain, Achievement(164), Ra.unlocks.continuousTTBoost.effects.infinity);\n  infGain = infGain.times(getAdjustedGlyphEffect(\"infinityinfmult\"));\n  infGain = infGain.powEffectOf(SingularityMilestone.infinitiedPow);\n  return infGain;\n}\nexport function updateRefresh() {\n  GameStorage.save();\n  location.reload(true);\n}\nexport const GAME_SPEED_EFFECT = {\n  FIXED_SPEED: 1,\n  TIME_GLYPH: 2,\n  BLACK_HOLE: 3,\n  TIME_STORAGE: 4,\n  SINGULARITY_MILESTONE: 5,\n  NERFS: 6\n};\n/**\r\n  * @param {number[]?} effectsToConsider A list of various game speed changing effects to apply when calculating\r\n  *   the game speed.  If left undefined, all effects will be applied.\r\n  * @param {number?} blackHolesActiveOverride A numerical value which forces all black holes up to its specified index\r\n  *   to be active for the purposes of game speed calculation. This is only used during offline black hole stuff.\r\n  */\n\nexport function getGameSpeedupFactor(effectsToConsider, blackHolesActiveOverride) {\n  let effects;\n\n  if (effectsToConsider === undefined) {\n    effects = [GAME_SPEED_EFFECT.FIXED_SPEED, GAME_SPEED_EFFECT.TIME_GLYPH, GAME_SPEED_EFFECT.BLACK_HOLE, GAME_SPEED_EFFECT.TIME_STORAGE, GAME_SPEED_EFFECT.SINGULARITY_MILESTONE, GAME_SPEED_EFFECT.NERFS];\n  } else {\n    effects = effectsToConsider;\n  }\n\n  if (effects.includes(GAME_SPEED_EFFECT.FIXED_SPEED)) {\n    if (EternityChallenge(12).isRunning) {\n      return 1 / 1000;\n    }\n  }\n\n  let factor = 1;\n\n  if (effects.includes(GAME_SPEED_EFFECT.BLACK_HOLE)) {\n    if (BlackHoles.areNegative) {\n      factor *= player.blackHoleNegative;\n    } else if (!BlackHoles.arePaused) {\n      for (const blackHole of BlackHoles.list) {\n        if (!blackHole.isUnlocked) break;\n        const isActive = blackHolesActiveOverride === undefined ? blackHole.isActive : blackHole.id <= blackHolesActiveOverride;\n        if (!isActive) break;\n        factor *= Math.pow(blackHole.power, BlackHoles.unpauseAccelerationFactor);\n        factor *= VUnlocks.achievementBH.effectOrDefault(1);\n      }\n    }\n  }\n\n  if (effects.includes(GAME_SPEED_EFFECT.SINGULARITY_MILESTONE)) {\n    factor *= SingularityMilestone.gamespeedFromSingularities.effectOrDefault(1);\n  }\n\n  if (effects.includes(GAME_SPEED_EFFECT.TIME_GLYPH)) {\n    factor *= getAdjustedGlyphEffect(\"timespeed\");\n    factor = Math.pow(factor, getAdjustedGlyphEffect(\"effarigblackhole\"));\n  }\n\n  if (Enslaved.isStoringGameTime && effects.includes(GAME_SPEED_EFFECT.TIME_STORAGE)) {\n    const storedTimeWeight = Ra.unlocks.autoPulseTime.canBeApplied ? 0.99 : 1;\n    factor = factor * (1 - storedTimeWeight) + storedTimeWeight;\n  } // These effects should always be active, but need to be disabled during offline black hole simulations because\n  // otherwise it gets applied twice\n\n\n  if (effects.includes(GAME_SPEED_EFFECT.NERFS)) {\n    if (Effarig.isRunning) {\n      factor = Effarig.multiplier(factor).toNumber();\n    } else if (Laitela.isRunning) {\n      const nerfModifier = Math.clampMax(Time.thisRealityRealTime.totalMinutes / 10, 1);\n      factor = Math.pow(factor, nerfModifier);\n    }\n  }\n\n  factor *= PelleUpgrade.timeSpeedMult.effectValue.toNumber(); // 1e-300 is now possible with max inverted BH, going below it would be possible with\n  // an effarig glyph.\n\n  factor = Math.clamp(factor, 1e-300, 1e300);\n  return factor;\n}\nexport function getGameSpeedupForDisplay() {\n  const speedFactor = getGameSpeedupFactor();\n\n  if (Enslaved.isAutoReleasing && Enslaved.canRelease(true) && !BlackHoles.areNegative && !Pelle.isDisabled(\"blackhole\")) {\n    return Math.max(Enslaved.autoReleaseSpeed, speedFactor);\n  }\n\n  return speedFactor;\n} // Separated out for organization; however this is also used in more than one spot in gameLoop() as well. Returns\n// true if the rest of the game loop should be skipped\n\nexport function realTimeMechanics(realDiff) {\n  // realDiff have calculated getGlobalSpeedFactor() effect.\n  // Ra memory generation bypasses stored real time, but memory chunk generation is disabled when storing real time.\n  // This is in order to prevent players from using time inside of Ra's reality for amplification as well\n  Ra.memoryTick(realDiff / Math.pow(getGlobalSpeedFactor(), 1 / 2), !Enslaved.isStoringRealTime);\n\n  if (AlchemyResource.momentum.isUnlocked) {\n    player.celestials.ra.momentumTime += realDiff * Achievement(175).effectOrDefault(1);\n  }\n\n  DarkMatterDimensions.tick(realDiff / Math.pow(getGlobalSpeedFactor(), 1 / 2)); // When storing real time, skip everything else having to do with production once stats are updated\n\n  if (Enslaved.isStoringRealTime) {\n    // Time recording should not be speeded up by getGlobalSpeedFactor().\n    realDiff /= getGlobalSpeedFactor();\n    player.records.realTimePlayed += realDiff;\n    player.records.thisInfinity.realTime += realDiff;\n    player.records.thisEternity.realTime += realDiff;\n    player.records.thisReality.realTime += realDiff;\n    Enslaved.storeRealTime(); // Most autobuyers will only tick usefully on the very first tick, but this needs to be here in order to allow\n    // the autobuyers unaffected by time storage to tick as well\n\n    Autobuyers.tick();\n    GameUI.update();\n    return true;\n  }\n\n  return false;\n} // \"passDiff\" is in ms. It is only unspecified when it's being called normally and not due to simulating time, in which\n// case it uses the gap between now and the last time the function was called (capped at a day). This is on average\n// equal to the update rate, but may be much larger if the game was unfocused or the device went to sleep for some time.\n// eslint-disable-next-line complexity\n\nexport function gameLoop(passDiff, options = {}) {\n  PerformanceStats.start(\"Frame Time\");\n  PerformanceStats.start(\"Game Update\");\n  EventHub.dispatch(GAME_EVENT.GAME_TICK_BEFORE); // When you have offline progress on and game paused, and just get back from offline, and resume the game, the game\n  // treats all prievous time offline and simulates them. This is unintended so here is a fix.\n\n  if (player.options.gamePaused) player.lastUpdate = Date.now(); // In certain cases we want to allow the player to interact with the game's settings and tabs, but prevent any actual\n  // resource generation from happening - in these cases, we have to make sure this all comes before the hibernation\n  // check or else it'll attempt to run the game anyway\n\n  if (Speedrun.isPausedAtStart() || GameEnd.creditsEverClosed || player.options.gamePaused) {\n    GameUI.update();\n    return;\n  }\n\n  let diff = passDiff;\n  const thisUpdate = Date.now();\n  const realDiff = (diff === undefined ? Math.clamp(thisUpdate - player.lastUpdate, 1, 8.64e7) : diff) * getGlobalSpeedFactor();\n  if (!GameStorage.ignoreBackupTimer) player.backupTimer += realDiff / getGlobalSpeedFactor(); // For single ticks longer than a minute from the GameInterval loop, we assume that the device has gone to sleep or\n  // hibernation - in those cases we stop the interval and simulate time instead. The gameLoop interval automatically\n  // restarts itself at the end of the simulateTime call. This will not trigger for an unfocused game, as this seems to\n  // result in a ~1 second tick rate for browsers.\n  // Note that we have to explicitly call all the real-time mechanics with the existing value of realDiff, because\n  // simply letting it run through simulateTime seems to result in it using zero\n\n  if (player.options.hibernationCatchup && passDiff === undefined && realDiff > 6e4 * getGlobalSpeedFactor()) {\n    GameIntervals.gameLoop.stop();\n    simulateTime(realDiff / 1000 / getGlobalSpeedFactor(), true);\n    realTimeMechanics(realDiff);\n    return;\n  } // Run all the functions which only depend on real time and not game time, skipping the rest of the loop if needed\n\n\n  if (realTimeMechanics(realDiff)) return; // Ra-Nameless auto-release stored time (once every 5 ticks)\n\n  if (Enslaved.isAutoReleasing) {\n    Enslaved.autoReleaseTick++;\n  }\n\n  if (Enslaved.autoReleaseTick >= 5) {\n    Enslaved.autoReleaseTick = 0;\n    Enslaved.useStoredTime(true);\n    Enslaved.isReleaseTick = true;\n  } else if (!Enslaved.isReleaseTick) {\n    Enslaved.nextTickDiff = realDiff;\n  }\n\n  if (diff === undefined) {\n    diff = Enslaved.nextTickDiff;\n  } else diff *= getGlobalSpeedFactor();\n\n  Autobuyers.tick();\n  Tutorial.tutorialLoop();\n\n  if (Achievement(165).isUnlocked && player.celestials.effarig.autoAdjustGlyphWeights) {\n    autoAdjustGlyphWeights();\n  } // We do these after autobuyers, since it's possible something there might\n  // change a multiplier.\n\n\n  GameCache.antimatterDimensionCommonMultiplier.invalidate();\n  GameCache.antimatterDimensionFinalMultipliers.invalidate();\n  GameCache.infinityDimensionCommonMultiplier.invalidate();\n  GameCache.timeDimensionCommonMultiplier.invalidate();\n  GameCache.totalIPMult.invalidate();\n  const blackHoleDiff = realDiff / Math.sqrt(getGlobalSpeedFactor());\n  const fixedSpeedActive = EternityChallenge(12).isRunning;\n\n  if (!Enslaved.isReleaseTick && !fixedSpeedActive) {\n    let speedFactor;\n\n    if (options.blackHoleSpeedup === undefined) {\n      speedFactor = getGameSpeedupFactor();\n    } else {\n      // This is only called from simulateTime() and is calculated externally in order to avoid weirdness when game\n      // speed is directly nerfed\n      speedFactor = options.blackHoleSpeedup;\n    }\n\n    if (Enslaved.isStoringGameTime && !fixedSpeedActive) {\n      // These variables are the actual game speed used and the game speed unaffected by time storage, respectively\n      const reducedTimeFactor = getGameSpeedupFactor();\n      const totalTimeFactor = getGameSpeedupFactor([GAME_SPEED_EFFECT.FIXED_SPEED, GAME_SPEED_EFFECT.TIME_GLYPH, GAME_SPEED_EFFECT.BLACK_HOLE, GAME_SPEED_EFFECT.SINGULARITY_MILESTONE]);\n      const amplification = Ra.unlocks.improvedStoredTime.effects.gameTimeAmplification.effectOrDefault(1);\n      const beforeStore = player.celestials.enslaved.stored;\n      player.celestials.enslaved.stored = Math.clampMax(player.celestials.enslaved.stored + diff * (totalTimeFactor - reducedTimeFactor) * amplification, Enslaved.timeCap);\n      Enslaved.currentBlackHoleStoreAmountPerMs = (player.celestials.enslaved.stored - beforeStore) / diff;\n      speedFactor = reducedTimeFactor;\n    }\n\n    diff *= speedFactor;\n  } else if (fixedSpeedActive) {\n    diff *= getGameSpeedupFactor();\n    Enslaved.currentBlackHoleStoreAmountPerMs = 0;\n  }\n\n  player.celestials.ra.peakGamespeed = Math.max(player.celestials.ra.peakGamespeed, getGameSpeedupFactor());\n  Enslaved.isReleaseTick = false; // These need to all be done consecutively in order to minimize the chance of a reset occurring between real time\n  // updating and game time updating. This is only particularly noticeable when game speed is 1 and the player\n  // expects to see identical numbers. We also don't increment the timers if the game has been beaten (Achievement 188)\n\n  if (!Achievement(188).isUnlocked) {\n    player.records.realTimeDoomed += realDiff / getGlobalSpeedFactor();\n    player.records.realTimePlayed += realDiff / getGlobalSpeedFactor();\n    player.records.totalTimePlayed += diff;\n    player.records.thisInfinity.realTime += realDiff / getGlobalSpeedFactor();\n    player.records.thisInfinity.time += diff;\n    player.records.thisEternity.realTime += realDiff / getGlobalSpeedFactor();\n\n    if (Enslaved.isRunning && Enslaved.feltEternity && !EternityChallenge(12).isRunning) {\n      player.records.thisEternity.time += diff * (1 + Currency.eternities.value.clampMax(1e66).toNumber());\n    } else {\n      player.records.thisEternity.time += diff;\n    }\n\n    player.records.thisReality.realTime += realDiff / getGlobalSpeedFactor();\n    player.records.thisReality.time += diff;\n  }\n\n  DeltaTimeState.update(realDiff, diff);\n  updateNormalAndInfinityChallenges(diff); // IP generation is broken into a couple of places in gameLoop; changing that might change the\n  // behavior of eternity farming.\n\n  preProductionGenerateIP(diff);\n\n  if (!Pelle.isDoomed) {\n    passivePrestigeGen();\n  }\n\n  applyAutoprestige(realDiff / getGlobalSpeedFactor());\n  updateImaginaryMachines(realDiff);\n  const uncountabilityGain = AlchemyResource.uncountability.effectValue * Time.unscaledDeltaTime.totalSeconds;\n  Currency.realities.add(uncountabilityGain);\n  Currency.perkPoints.add(uncountabilityGain);\n  if (Perk.autocompleteEC1.canBeApplied) player.reality.lastAutoEC += realDiff;\n  EternityChallenge(12).tryFail();\n\n  Achievements._power.invalidate();\n\n  TimeDimensions.tick(diff);\n  InfinityDimensions.tick(diff);\n  AntimatterDimensions.tick(diff);\n  const gain = Math.clampMin(FreeTickspeed.fromShards(Currency.timeShards.value).newAmount - player.totalTickGained, 0);\n  player.totalTickGained += gain;\n  updatePrestigeRates();\n  tryCompleteInfinityChallenges();\n  EternityChallenges.autoComplete.tick();\n  replicantiLoop(diff);\n\n  if (PlayerProgress.dilationUnlocked()) {\n    Currency.dilatedTime.add(getDilationGainPerSecond().times(diff / 1000));\n  }\n\n  updateTachyonGalaxies();\n  Currency.timeTheorems.add(getTTPerSecond().times(diff / 1000));\n  InfinityDimensions.tryAutoUnlock();\n  BlackHoles.updatePhases(blackHoleDiff); // Unlocks dilation at a certain total TT count for free, but we add the cost first in order to make\n  // sure that TT count doesn't go negative and that we can actually buy it. This technically bumps the max theorem\n  // amount up as well, but at this point of the game 5k TT is insignificant to basically all other sources of TT.\n\n  if (Ra.unlocks.autoUnlockDilation.canBeApplied && Currency.timeTheorems.max.gte(TimeStudy.dilation.totalTimeTheoremRequirement) && !isInCelestialReality() && !Pelle.isDoomed) {\n    Currency.timeTheorems.add(TimeStudy.dilation.cost);\n    TimeStudy.dilation.purchase(true);\n  }\n\n  applyAutoUnlockPerks();\n  if (GlyphSelection.active) GlyphSelection.update(gainedGlyphLevel()); // There are some external checks which prevent excessive resource gain with Teresa-25; it may give TP outside of\n  // dilation, but the TP gain function is also coded to behave differently if it's active\n\n  const teresa1 = player.dilation.active && Ra.unlocks.autoTP.canBeApplied;\n  const teresa25 = !isInCelestialReality() && Ra.unlocks.unlockDilationStartingTP.canBeApplied;\n  if ((teresa1 || teresa25) && !Pelle.isDoomed) rewardTP();\n\n  if (Enslaved.canTickHintTimer) {\n    player.celestials.enslaved.hintUnlockProgress += Enslaved.isRunning ? realDiff : realDiff * 0.4;\n\n    if (player.celestials.enslaved.hintUnlockProgress >= TimeSpan.fromHours(5).totalMilliseconds) {\n      EnslavedProgress.hintsUnlocked.giveProgress();\n      Enslaved.quotes.hintUnlock.show();\n    }\n  }\n\n  laitelaRealityTick(realDiff / getGlobalSpeedFactor());\n  Achievements.autoAchieveUpdate(diff);\n  V.checkForUnlocks();\n  AutomatorBackend.update(realDiff / getGlobalSpeedFactor());\n  Pelle.gameLoop(realDiff);\n  GalaxyGenerator.loop(realDiff);\n  GameEnd.gameLoop(realDiff / getGlobalSpeedFactor());\n\n  if (!Enslaved.canAmplify) {\n    Enslaved.boostReality = false;\n  } // Stopping these checks after CREDITS_START reduces lag and allows for the glyph customization modal to appear\n\n\n  if (GameEnd.endState < END_STATE_MARKERS.CREDITS_START) {\n    if (Tabs.current.isPermanentlyHidden) {\n      const tab = Tabs.all.reverse().find(t => !t.isPermanentlyHidden && t.id !== 10);\n      if (tab) tab.show(true);else [...Tab.dimensions.subtabs].reverse().find(t => !t.isPermanentlyHidden).show(true);\n    }\n\n    if (Tabs.current.subtabs.find(t => t.isOpen).isPermanentlyHidden) {\n      [...Tab.dimensions.subtabs].reverse().find(t => !t.isPermanentlyHidden).show(true);\n    }\n  }\n\n  EventHub.dispatch(GAME_EVENT.GAME_TICK_AFTER);\n  GameUI.update();\n  player.lastUpdate = thisUpdate;\n  PerformanceStats.end(\"Game Update\");\n}\n\nfunction updatePrestigeRates() {\n  const currentIPmin = gainedInfinityPoints().dividedBy(Math.clampMin(0.0005, Time.thisInfinityRealTime.totalMinutes));\n\n  if (currentIPmin.gt(player.records.thisInfinity.bestIPmin) && Player.canCrunch) {\n    player.records.thisInfinity.bestIPmin = currentIPmin;\n    player.records.thisInfinity.bestIPminVal = gainedInfinityPoints();\n  }\n\n  const currentEPmin = gainedEternityPoints().dividedBy(Math.clampMin(0.0005, Time.thisEternityRealTime.totalMinutes));\n\n  if (currentEPmin.gt(player.records.thisEternity.bestEPmin) && Player.canEternity) {\n    player.records.thisEternity.bestEPmin = currentEPmin;\n    player.records.thisEternity.bestEPminVal = gainedEternityPoints();\n  }\n\n  const currentRSmin = Effarig.shardsGained / Math.clampMin(0.0005, Time.thisRealityRealTime.totalMinutes);\n\n  if (currentRSmin > player.records.thisReality.bestRSmin && isRealityAvailable()) {\n    player.records.thisReality.bestRSmin = currentRSmin;\n    player.records.thisReality.bestRSminVal = Effarig.shardsGained;\n  }\n}\n\nfunction passivePrestigeGen() {\n  let eternitiedGain = 0;\n\n  if (RealityUpgrade(14).isBought) {\n    eternitiedGain = DC.D1.timesEffectsOf(Achievement(113), RealityUpgrade(3), RealityUpgrade(14));\n    eternitiedGain = Decimal.times(eternitiedGain, getAdjustedGlyphEffect(\"timeetermult\"));\n    eternitiedGain = new Decimal(Time.deltaTime).times(Decimal.pow(eternitiedGain, AlchemyResource.eternity.effectValue));\n    player.reality.partEternitied = player.reality.partEternitied.plus(eternitiedGain);\n    Currency.eternities.add(player.reality.partEternitied.floor());\n    player.reality.partEternitied = player.reality.partEternitied.sub(player.reality.partEternitied.floor());\n  }\n\n  if (!EternityChallenge(4).isRunning) {\n    let infGen = DC.D0;\n\n    if (BreakInfinityUpgrade.infinitiedGen.isBought) {\n      // Multipliers are done this way to explicitly exclude ach87 and TS32\n      // In speed version we retain these two multiplers.\n      infGen = infGen.plus(0.5 * Time.deltaTimeMs / Math.clampMin(50, player.records.bestInfinity.time));\n      infGen = infGen.timesEffectsOf(TimeStudy(32), RealityUpgrade(5), RealityUpgrade(7), Achievement(164), Ra.unlocks.continuousTTBoost.effects.infinity);\n      infGen = infGen.times(getAdjustedGlyphEffect(\"infinityinfmult\"));\n    }\n\n    if (RealityUpgrade(11).isBought) {\n      infGen = infGen.plus(RealityUpgrade(11).effectValue.times(Time.deltaTime));\n    }\n\n    if (EffarigUnlock.eternity.isUnlocked) {\n      // We consider half of the eternities we gained above this tick\n      // to have been gained before the infinities, and thus not to\n      // count here. This gives us the desirable behavior that\n      // infinities and eternities gained overall will be the same\n      // for two ticks as for one tick of twice the length.\n      infGen = infGen.plus(gainedInfinities().times(Currency.eternities.value.minus(eternitiedGain.div(2).floor())).times(Time.deltaTime));\n    }\n\n    infGen = infGen.plus(player.partInfinitied);\n    Currency.infinities.add(infGen.floor());\n    player.partInfinitied = infGen.minus(infGen.floor()).toNumber();\n  }\n} // Applies all perks which automatically unlock things when passing certain thresholds, needs to be checked every tick\n\n\nfunction applyAutoUnlockPerks() {\n  if (!TimeDimension(8).isUnlocked && Perk.autounlockTD.canBeApplied) {\n    for (let dim = 5; dim <= 8; ++dim) TimeStudy.timeDimension(dim).purchase();\n  }\n\n  if (Perk.autounlockDilation3.canBeApplied) buyDilationUpgrade(DilationUpgrade.ttGenerator.id);\n  if (Perk.autounlockReality.canBeApplied) TimeStudy.reality.purchase(true);\n  applyEU2();\n}\n\nfunction laitelaRealityTick(realDiff) {\n  const laitelaInfo = player.celestials.laitela;\n  if (!Laitela.isRunning) return;\n\n  if (laitelaInfo.entropy >= 0) {\n    laitelaInfo.entropy += realDiff / 1000 * Laitela.entropyGainPerSecond;\n  } // Setting entropy to -1 on completion prevents the modal from showing up repeatedly\n\n\n  if (laitelaInfo.entropy >= 1) {\n    let completionText = `Lai'tela's Reality has been destabilized after ${Time.thisRealityRealTime.toStringShort()}.`;\n    laitelaInfo.entropy = -1;\n    const oldInfo = {\n      fastestCompletion: laitelaInfo.fastestCompletion,\n      difficultyTier: laitelaInfo.difficultyTier,\n      realityReward: Laitela.realityReward\n    };\n    laitelaInfo.thisCompletion = Time.thisRealityRealTime.totalSeconds;\n    laitelaInfo.fastestCompletion = Math.min(laitelaInfo.thisCompletion, laitelaInfo.fastestCompletion);\n    clearCelestialRuns();\n\n    if (Time.thisRealityRealTime.totalSeconds < 30) {\n      laitelaInfo.difficultyTier++;\n      laitelaInfo.fastestCompletion = 300;\n      completionText += laitelaBeatText(Laitela.maxAllowedDimension + 1);\n\n      for (const quote of Laitela.quotes.all) {\n        if (quote.requirement) {\n          quote.show();\n        }\n      }\n    }\n\n    if (Laitela.realityReward > oldInfo.realityReward) {\n      completionText += `<br><br>Dark Matter Multiplier: ${formatX(oldInfo.realityReward, 2, 2)}\n      âžœ ${formatX(Laitela.realityReward, 2, 2)}`;\n\n      if (oldInfo.fastestCompletion === 3600 || oldInfo.fastestCompletion === 300 && oldInfo.difficultyTier > 0) {\n        if (Time.thisRealityRealTime.totalSeconds < 30) {\n          // First attempt - destabilising\n          completionText += `<br>Best Completion Time: None âžœ Destabilized\n          <br>Highest Active Dimension: ${formatInt(8 - oldInfo.difficultyTier)} âžœ\n          ${formatInt(8 - laitelaInfo.difficultyTier)}`;\n        } else {\n          // First attempt - not destabilising\n          completionText += `<br>Best Completion Time: None âžœ\n            ${TimeSpan.fromSeconds(laitelaInfo.fastestCompletion).toStringShort()}\n            <br>Highest Active Dimension: ${formatInt(8 - laitelaInfo.difficultyTier)}`;\n        }\n      } else if (Time.thisRealityRealTime.totalSeconds < 30) {\n        // Second+ attempt - destabilising\n        completionText += `<br>Best Completion Time: ${TimeSpan.fromSeconds(oldInfo.fastestCompletion).toStringShort()}\n          âžœ Destabilized\n          <br>Highest Active Dimension: ${formatInt(8 - oldInfo.difficultyTier)} âžœ\n          ${formatInt(8 - laitelaInfo.difficultyTier)}`;\n      } else {\n        // Second+ attempt - not destabilising\n        completionText += `<br>Best Completion Time: ${TimeSpan.fromSeconds(oldInfo.fastestCompletion).toStringShort()}\n        âžœ ${TimeSpan.fromSeconds(laitelaInfo.fastestCompletion).toStringShort()}\n        <br>Highest Active Dimension: ${formatInt(8 - oldInfo.difficultyTier)}`;\n      }\n\n      player.records.bestReality.laitelaSet = Glyphs.copyForRecords(Glyphs.active.filter(g => g !== null));\n    } else {\n      completionText += ` You need to destabilize in faster than\n        ${TimeSpan.fromSeconds(laitelaInfo.fastestCompletion).toStringShort()} to improve your multiplier.`;\n    }\n\n    if (Laitela.isFullyDestabilized) SpeedrunMilestones(24).tryComplete();\n    Modal.message.show(completionText, {}, 2);\n  }\n}\n\nfunction laitelaBeatText(disabledDim) {\n  switch (disabledDim) {\n    case 1:\n      return `<br><br>Lai'tela's Reality will now completely disable production from all Dimensions.\n        The Reality can still be entered, but further destabilization is no longer possible.\n        For completely destabilizing the Reality, you also get an additional ${formatX(8)} to Dark Energy gain.`;\n\n    case 2:\n      return `<br><br>Lai'tela's Reality will now disable production from all 2nd Dimensions during\n      future runs, but the reward will be ${formatInt(100)} times stronger than before. Completely destabilizing\n      the Reality for the final Dimension will give you an additional ${formatX(8)} to Dark Energy gain.`;\n\n    case 3:\n      return `<br><br>Lai'tela's Reality will now disable production from all 3rd Dimensions during\n        future runs, but the reward will be ${formatInt(100)} times stronger than before.`;\n\n    case 8:\n      return `<br><br>Lai'tela's Reality will now disable production from all 8th Dimensions during\n        future runs, but the reward will be ${formatInt(100)} times stronger than before. This boost can be\n        repeated for each remaining Dimension by reaching destabilization within ${formatInt(30)} seconds again.`;\n\n    default:\n      return `<br><br>Lai'tela's Reality will now disable production from all\n        ${disabledDim}th Dimensions during future runs, but the reward will be\n        ${formatInt(100)} times stronger than before.`;\n  }\n} // This gives IP/EP/RM from the respective upgrades that reward the prestige currencies continuously\n\n\nfunction applyAutoprestige(diff) {\n  Currency.infinityPoints.add(TimeStudy(181).effectOrDefault(0));\n\n  if (TeresaUnlocks.epGen.canBeApplied) {\n    Currency.eternityPoints.add(player.records.thisEternity.bestEPmin.times(DC.D0_01).times(getGameSpeedupFactor() * diff / 1000).timesEffectOf(Ra.unlocks.continuousTTBoost.effects.autoPrestige));\n  }\n\n  if (InfinityUpgrade.ipGen.isCharged) {\n    const addedRM = MachineHandler.gainedRealityMachines.timesEffectsOf(InfinityUpgrade.ipGen.chargedEffect).times(diff / 1000);\n    Currency.realityMachines.add(addedRM);\n  }\n\n  if (PelleRifts.chaos.milestones[2].canBeApplied) {\n    Currency.eternityPoints.add(gainedEternityPoints().times(DC.D0_1).times(diff / 1000));\n  }\n}\n\nfunction updateImaginaryMachines(diff) {\n  MachineHandler.updateIMCap();\n  Currency.imaginaryMachines.add(MachineHandler.gainedImaginaryMachines(diff));\n}\n\nfunction updateTachyonGalaxies() {\n  const tachyonGalaxyMult = Effects.max(1, DilationUpgrade.doubleGalaxies);\n  const tachyonGalaxyThreshold = 1000;\n  const thresholdMult = getTachyonGalaxyMult();\n  player.dilation.baseTachyonGalaxies = Math.max(player.dilation.baseTachyonGalaxies, 1 + Math.floor(Decimal.log(Currency.dilatedTime.value.dividedBy(1000), thresholdMult)));\n  player.dilation.nextThreshold = DC.E3.times(new Decimal(thresholdMult).pow(player.dilation.baseTachyonGalaxies));\n  player.dilation.totalTachyonGalaxies = Math.min(player.dilation.baseTachyonGalaxies * tachyonGalaxyMult, tachyonGalaxyThreshold) + Math.max(player.dilation.baseTachyonGalaxies * tachyonGalaxyMult - tachyonGalaxyThreshold, 0) / tachyonGalaxyMult;\n  player.dilation.totalTachyonGalaxies *= DilationUpgrade.galaxyMultiplier.effectValue;\n}\n\nexport function getTTPerSecond() {\n  // All TT multipliers (note that this is equal to 1 pre-Ra)\n  let ttMult = Effects.product(Ra.unlocks.continuousTTBoost.effects.ttGen, Ra.unlocks.achievementTTMult, Achievement(137), Achievement(156));\n  if (GlyphAlteration.isAdded(\"dilation\")) ttMult *= getSecondaryGlyphEffect(\"dilationTTgen\"); // Glyph TT generation\n\n  const glyphTT = Teresa.isRunning || Enslaved.isRunning || Pelle.isDoomed ? 0 : getAdjustedGlyphEffect(\"dilationTTgen\") * ttMult; // Dilation TT generation\n\n  const dilationTT = DilationUpgrade.ttGenerator.isBought ? DilationUpgrade.ttGenerator.effectValue.times(Pelle.isDoomed ? 1 : ttMult) : DC.D0; // Lai'tela TT power\n\n  let finalTT = dilationTT.add(glyphTT);\n\n  if (finalTT.gt(1)) {\n    finalTT = finalTT.pow(SingularityMilestone.theoremPowerFromSingularities.effectOrDefault(1));\n  }\n\n  return finalTT;\n} // eslint-disable-next-line no-unused-vars\n\nfunction recursiveTimeOut(fn, iterations, endFn) {\n  fn(iterations);\n  if (iterations === 0) endFn();else setTimeout(() => recursiveTimeOut(fn, iterations - 1, endFn), 0);\n}\n\nfunction afterSimulation(seconds, playerBefore) {\n  if (seconds > 600) {\n    const playerAfter = deepmergeAll([{}, player]);\n    Modal.awayProgress.show({\n      playerBefore,\n      playerAfter,\n      seconds\n    });\n  }\n\n  GameUI.notify.showBlackHoles = true;\n}\n\nexport function simulateTime(seconds, real, fast) {\n  var _GameStorage$offlineT;\n\n  seconds *= getGlobalSpeedFactor(); // The game is simulated at a base 50ms update rate, with a maximum tick count based on the values of real and fast\n  // - Calling with real === true will always simulate at full accuracy with no tick count reduction unless it would\n  //   otherwise simulate with more ticks than offline progress would allow\n  // - Calling with fast === true will only simulate it with a max of 50 ticks\n  // - Otherwise, tick count will be limited to the offline tick count (which may be set externally during save import)\n  // Tick count is never *increased*, and only ever decreased if needed.\n\n  if (seconds < 0) return;\n  let ticks = Math.floor(seconds / getGlobalSpeedFactor() * 20);\n  GameUI.notify.showBlackHoles = false; // Limit the tick count (this also applies if the black hole is unlocked)\n\n  const maxTicks = GameStorage.maxOfflineTicks(1000 * seconds / getGlobalSpeedFactor(), (_GameStorage$offlineT = GameStorage.offlineTicks) !== null && _GameStorage$offlineT !== void 0 ? _GameStorage$offlineT : player.options.offlineTicks);\n\n  if (ticks > maxTicks && !fast) {\n    ticks = maxTicks;\n  } else if (ticks > 50 && !real && fast) {\n    ticks = 50;\n  }\n\n  const playerStart = deepmergeAll([{}, player]);\n  let totalGameTime;\n\n  if (BlackHoles.areUnlocked && !BlackHoles.arePaused) {\n    totalGameTime = BlackHoles.calculateGameTimeFromRealTime(seconds, BlackHoles.calculateSpeedups());\n  } else {\n    totalGameTime = getGameSpeedupFactor() * seconds;\n  }\n\n  const infinitiedMilestone = getInfinitiedMilestoneReward(totalGameTime * 1000);\n  const eternitiedMilestone = getEternitiedMilestoneReward(totalGameTime * 1000);\n\n  if (eternitiedMilestone.gt(0)) {\n    Currency.eternities.add(eternitiedMilestone);\n  } else if (infinitiedMilestone.gt(0)) {\n    Currency.infinities.add(infinitiedMilestone);\n  } else {\n    Currency.eternityPoints.add(getOfflineEPGain(seconds * 1000));\n  }\n\n  if (InfinityUpgrade.ipOffline.isBought && player.options.offlineProgress) {\n    Currency.infinityPoints.add(player.records.thisEternity.bestIPMsWithoutMaxAll.times(seconds * 1000 / 2));\n  }\n\n  EventHub.dispatch(GAME_EVENT.OFFLINE_CURRENCY_GAINED);\n  let remainingRealSeconds = seconds / getGlobalSpeedFactor(); // During async code the number of ticks remaining can go down suddenly\n  // from \"Speed up\" which means tick length needs to go up, and thus\n  // you can't just divide total time by total ticks to get tick length.\n  // For example, suppose you had 6000 offline ticks, and called \"Speed up\"\n  // 1000 ticks in, meaning that after \"Speed up\" there'd only be 1000 ticks more\n  // (so 1000 + 1000 = 2000 ticks total). Dividing total time by total ticks would\n  // use 1/6th of the total time before \"Speed up\" (1000 of 6000 ticks), and 1/2 after\n  // (1000 of 2000 ticks). Short of some sort of magic user prediction to figure out\n  // whether the user *will* press \"Speed up\" at some point, dividing remaining time\n  // by remaining ticks seems like the best thing to do.\n\n  let loopFn = i => {\n    const diff = remainingRealSeconds / i;\n    gameLoop(1000 * diff);\n    remainingRealSeconds -= diff;\n  }; // Simulation code which accounts for BH cycles (segments where a BH is active doesn't use diff since it splits\n  // up intervals based on real time instead in an effort to keep ticks all roughly equal in game time).\n  // Black hole auto-pausing is entirely handled by the black hole phase advancement code (for actually pausing)\n  // and calculateOfflineTick (for time calculation).\n\n\n  if (BlackHoles.areUnlocked && !BlackHoles.arePaused) {\n    loopFn = i => {\n      const [realTickTime, blackHoleSpeedup] = BlackHoles.calculateOfflineTick(remainingRealSeconds, i, 0.0001);\n      remainingRealSeconds -= realTickTime;\n      gameLoop(1000 * realTickTime, {\n        blackHoleSpeedup\n      });\n    };\n  } // We don't show the offline modal here or bother with async if doing a fast simulation\n\n\n  if (fast) {\n    // Fast simulations happen when simulating between 10 and 50 seconds of offline time.\n    // One easy way to get this is to autosave every 30 or 60 seconds, wait until the save timer\n    // in the bottom-left hits 15 seconds, and refresh (without saving directly beforehand).\n    GameIntervals.stop(); // Fast simulations are always 50 ticks. They're done in this weird countdown way because\n    // we want to be able to call the same function that we call when using async code (to avoid\n    // duplicating functions), and that function expects a parameter saying how many ticks are remaining.\n\n    for (let remaining = 50; remaining > 0; remaining--) {\n      loopFn(remaining);\n    }\n\n    GameStorage.postLoadStuff();\n    afterSimulation(seconds, playerStart);\n  } else {\n    const progress = {};\n    ui.view.modal.progressBar = {};\n    Async.run(loopFn, ticks, {\n      batchSize: 1,\n      maxTime: 60,\n      sleepTime: 1,\n      asyncEntry: doneSoFar => {\n        GameIntervals.stop();\n        ui.$viewModel.modal.progressBar = {\n          label: \"Offline Progress Simulation\",\n          info: () => `The game is being run at a lower accuracy in order to quickly calculate the resources you\n              gained while you were away. See the How To Play entry on \"Offline Progress\" for technical details. If\n              you are impatient and want to get back to the game sooner, you can click the \"Speed up\" button to\n              simulate the rest of the time with half as many ticks (down to a minimum of ${formatInt(500)} ticks\n              remaining). The \"SKIP\" button will instead use all the remaining offline time in ${formatInt(10)}\n              ticks.`,\n          progressName: \"Ticks\",\n          current: doneSoFar,\n          max: ticks,\n          startTime: Date.now(),\n          buttons: [{\n            text: \"Speed up\",\n            condition: (current, max) => max - current > 500,\n            click: () => {\n              const newRemaining = Math.clampMin(Math.floor(progress.remaining / 2), 500); // We subtract the number of ticks we skipped, which is progress.remaining - newRemaining.\n              // This, and the below similar code in \"SKIP\", are needed or the progress bar to be accurate\n              // (both with respect to the number of ticks it shows and with respect to how full it is).\n\n              progress.maxIter -= progress.remaining - newRemaining;\n              progress.remaining = newRemaining; // We update the progress bar max data (remaining will update automatically).\n\n              ui.$viewModel.modal.progressBar.max = progress.maxIter;\n            }\n          }, {\n            text: \"SKIP\",\n            condition: (current, max) => max - current > 10,\n            click: () => {\n              // We jump to 10 from the end (condition guarantees there are at least 10 left).\n              // We subtract the number of ticks we skipped, which is progress.remaining - 10.\n              progress.maxIter -= progress.remaining - 10;\n              progress.remaining = 10;\n            }\n          }]\n        };\n      },\n      asyncProgress: doneSoFar => {\n        ui.$viewModel.modal.progressBar.current = doneSoFar;\n      },\n      asyncExit: () => {\n        ui.$viewModel.modal.progressBar = undefined; // .postLoadStuff will restart GameIntervals\n\n        GameStorage.postLoadStuff();\n      },\n      then: () => {\n        afterSimulation(seconds, playerStart);\n      },\n      progress\n    });\n  }\n}\n\nwindow.onload = function () {\n  const supportedBrowser = browserCheck();\n  GameUI.initialized = supportedBrowser;\n  ui.view.initialized = supportedBrowser;\n  setTimeout(() => {\n    ElectronRuntime.updateZoom();\n    document.getElementById(\"loading\").style.display = \"none\";\n  }, 500);\n\n  if (!supportedBrowser) {\n    GameIntervals.stop();\n    document.getElementById(\"loading\").style.display = \"none\";\n    document.getElementById(\"browser-warning\").style.display = \"flex\";\n  }\n};\n\nwindow.onfocus = function () {\n  setShiftKey(false);\n};\n\nwindow.onblur = function () {\n  GameKeyboard.stopSpins();\n};\n\nexport function setShiftKey(isDown) {\n  ui.view.shiftDown = isDown;\n}\nexport function setHoldingR(x) {\n  Replicanti.galaxies.isPlayerHoldingR = x;\n}\nexport function browserCheck() {\n  return supportedBrowsers.test(navigator.userAgent);\n}\nexport function init() {\n  // eslint-disable-next-line no-console\n  console.log(\"ðŸŒŒ Antimatter Dimensions: Reality Update ðŸŒŒ\");\n\n  if (DEV) {\n    // eslint-disable-next-line no-console\n    console.log(\"ðŸ‘¨â€ðŸ’» Development Mode ðŸ‘©â€ðŸ’»\");\n  }\n\n  ElectronRuntime.initialize();\n  SteamRuntime.initialize();\n  Cloud.init();\n  GameStorage.load();\n  Tabs.all.find(t => t.config.id === player.options.lastOpenTab).show(true);\n  Payments.init();\n}\nwindow.tweenTime = 0;\nlet lastFrame;\n\nfunction animateTweens(time) {\n  requestAnimationFrame(animateTweens);\n\n  if (time === undefined || lastFrame === undefined) {\n    lastFrame = time;\n    return;\n  }\n\n  let delta = time - lastFrame;\n  lastFrame = time;\n\n  if (player.dilation.active) {\n    delta /= Pelle.isDoomed ? 1.5 : 10;\n  }\n\n  tweenTime += delta;\n  TWEEN.update(tweenTime);\n}\n\nanimateTweens();","map":{"version":3,"sources":["C:/Games/ADFasterer/ADfasterer/src/game.js"],"names":["TWEEN","ElectronRuntime","SteamRuntime","DC","deepmergeAll","DEV","SpeedrunMilestones","Cloud","supportedBrowsers","Payments","GlobalErrorHandler","handled","Error","cleanStart","playerInfinityUpgradesOnReset","infinityUpgrades","Set","breakInfinityUpgrades","PelleUpgrade","keepBreakInfinityUpgrades","canBeApplied","player","filter","u","has","keepInfinityUpgrades","infinityRebuyables","GameCache","tickSpeedMultDecrease","invalidate","dimensionMultDecrease","RealityUpgrade","isBought","EternityMilestone","keepBreakUpgrades","isReached","clear","Pelle","isDoomed","breakInfinity","Autobuyer","bigCrunch","hasMaxedInterval","InfinityChallenge","isRunning","autobuyer","Autobuyers","all","data","interval","undefined","maxIntervalForFree","Achievement","tryUnlock","break","TabNotification","ICUnlock","tryTrigger","EventHub","dispatch","GAME_EVENT","BREAK_INFINITY","FIX_INFINITY","GameUI","update","gainedInfinityPoints","div","Effects","min","TimeStudy","isDisabled","Decimal","pow10","records","thisInfinity","maxAM","log10","timesEffectsOf","PelleRifts","vacuum","times","specialGlyphEffect","infinity","floor","ip","Effarig","currentStage","EFFARIG_STAGES","ETERNITY","E200","totalIPMult","value","Teresa","pow","V","Laitela","dilatedValueOf","GlyphAlteration","isAdded","getSecondaryGlyphEffect","totalEPMult","time","timesEffectOf","milestones","getAdjustedGlyphEffect","ShopPurchase","EPPurchases","currentMult","EternityUpgrade","epMult","GlyphEffect","gainedEternityPoints","ep","D5","thisEternity","maxIP","plus","recursion","effectValue","toNumber","requiredIPForEP","epAmount","log","divide","clampMin","Number","MAX_VALUE","gainedGlyphLevel","glyphState","getGlyphLevelInputs","rawLevel","Math","isFinite","actualLevel","resetChallengeStuff","chall2Pow","chall3Pow","D0_01","Currency","matter","reset","chall8TotalSacrifice","D1","postC4Tier","ratePerMinute","amount","addInfinityTime","realTime","infinities","challenge","normal","current","recentInfinities","pop","unshift","getGlobalSpeedFactor","bestRunIPPM","resetInfinityRuns","Array","from","length","getInfinitiedMilestoneReward","ms","considerMilestoneReached","autoInfinitiesAvailable","bestInfinitiesPerMs","dividedBy","D0","addEternityTime","eternities","eternity","currEC","ec","EternityChallenge","challText","dilation","active","formatInt","completions","maxCompletions","gainedTP","getTachyonGain","recentEternities","averageRealTimePerEternity","resetEternityRuns","getEternitiedMilestoneReward","autoEternitiesAvailable","thisReality","bestEternitiesPerMs","isOfflineEPGainEnabled","options","offlineProgress","getOfflineEPGain","autoEP","bestEternity","bestEPminReality","TimeSpan","fromMilliseconds","totalMinutes","addRealityTime","rm","level","realities","ampFactor","projIM","reality","celestials","Enslaved","Ra","cel","displayName","shards","shardsGained","recentRealities","gainedInfinities","infGain","max","toDecimal","effects","infinitiesGain","unlocks","continuousTTBoost","powEffectOf","SingularityMilestone","infinitiedPow","updateRefresh","GameStorage","save","location","reload","GAME_SPEED_EFFECT","FIXED_SPEED","TIME_GLYPH","BLACK_HOLE","TIME_STORAGE","SINGULARITY_MILESTONE","NERFS","getGameSpeedupFactor","effectsToConsider","blackHolesActiveOverride","includes","factor","BlackHoles","areNegative","blackHoleNegative","arePaused","blackHole","list","isUnlocked","isActive","id","power","unpauseAccelerationFactor","VUnlocks","achievementBH","effectOrDefault","gamespeedFromSingularities","isStoringGameTime","storedTimeWeight","autoPulseTime","multiplier","nerfModifier","clampMax","Time","thisRealityRealTime","timeSpeedMult","clamp","getGameSpeedupForDisplay","speedFactor","isAutoReleasing","canRelease","autoReleaseSpeed","realTimeMechanics","realDiff","memoryTick","isStoringRealTime","AlchemyResource","momentum","ra","momentumTime","DarkMatterDimensions","tick","realTimePlayed","storeRealTime","gameLoop","passDiff","PerformanceStats","start","GAME_TICK_BEFORE","gamePaused","lastUpdate","Date","now","Speedrun","isPausedAtStart","GameEnd","creditsEverClosed","diff","thisUpdate","ignoreBackupTimer","backupTimer","hibernationCatchup","GameIntervals","stop","simulateTime","autoReleaseTick","useStoredTime","isReleaseTick","nextTickDiff","Tutorial","tutorialLoop","effarig","autoAdjustGlyphWeights","antimatterDimensionCommonMultiplier","antimatterDimensionFinalMultipliers","infinityDimensionCommonMultiplier","timeDimensionCommonMultiplier","blackHoleDiff","sqrt","fixedSpeedActive","blackHoleSpeedup","reducedTimeFactor","totalTimeFactor","amplification","improvedStoredTime","gameTimeAmplification","beforeStore","enslaved","stored","timeCap","currentBlackHoleStoreAmountPerMs","peakGamespeed","realTimeDoomed","totalTimePlayed","feltEternity","DeltaTimeState","updateNormalAndInfinityChallenges","preProductionGenerateIP","passivePrestigeGen","applyAutoprestige","updateImaginaryMachines","uncountabilityGain","uncountability","unscaledDeltaTime","totalSeconds","add","perkPoints","Perk","autocompleteEC1","lastAutoEC","tryFail","Achievements","_power","TimeDimensions","InfinityDimensions","AntimatterDimensions","gain","FreeTickspeed","fromShards","timeShards","newAmount","totalTickGained","updatePrestigeRates","tryCompleteInfinityChallenges","EternityChallenges","autoComplete","replicantiLoop","PlayerProgress","dilationUnlocked","dilatedTime","getDilationGainPerSecond","updateTachyonGalaxies","timeTheorems","getTTPerSecond","tryAutoUnlock","updatePhases","autoUnlockDilation","gte","totalTimeTheoremRequirement","isInCelestialReality","cost","purchase","applyAutoUnlockPerks","GlyphSelection","teresa1","autoTP","teresa25","unlockDilationStartingTP","rewardTP","canTickHintTimer","hintUnlockProgress","fromHours","totalMilliseconds","EnslavedProgress","hintsUnlocked","giveProgress","quotes","hintUnlock","show","laitelaRealityTick","autoAchieveUpdate","checkForUnlocks","AutomatorBackend","GalaxyGenerator","loop","canAmplify","boostReality","endState","END_STATE_MARKERS","CREDITS_START","Tabs","isPermanentlyHidden","tab","reverse","find","t","Tab","dimensions","subtabs","isOpen","GAME_TICK_AFTER","end","currentIPmin","thisInfinityRealTime","gt","bestIPmin","Player","canCrunch","bestIPminVal","currentEPmin","thisEternityRealTime","bestEPmin","canEternity","bestEPminVal","currentRSmin","bestRSmin","isRealityAvailable","bestRSminVal","eternitiedGain","deltaTime","partEternitied","sub","infGen","BreakInfinityUpgrade","infinitiedGen","deltaTimeMs","bestInfinity","EffarigUnlock","minus","partInfinitied","TimeDimension","autounlockTD","dim","timeDimension","autounlockDilation3","buyDilationUpgrade","DilationUpgrade","ttGenerator","autounlockReality","applyEU2","laitelaInfo","laitela","entropy","entropyGainPerSecond","completionText","toStringShort","oldInfo","fastestCompletion","difficultyTier","realityReward","thisCompletion","clearCelestialRuns","laitelaBeatText","maxAllowedDimension","quote","requirement","formatX","fromSeconds","bestReality","laitelaSet","Glyphs","copyForRecords","g","isFullyDestabilized","tryComplete","Modal","message","disabledDim","infinityPoints","TeresaUnlocks","epGen","eternityPoints","autoPrestige","InfinityUpgrade","ipGen","isCharged","addedRM","MachineHandler","gainedRealityMachines","chargedEffect","realityMachines","chaos","D0_1","updateIMCap","imaginaryMachines","gainedImaginaryMachines","tachyonGalaxyMult","doubleGalaxies","tachyonGalaxyThreshold","thresholdMult","getTachyonGalaxyMult","baseTachyonGalaxies","nextThreshold","E3","totalTachyonGalaxies","galaxyMultiplier","ttMult","product","ttGen","achievementTTMult","glyphTT","dilationTT","finalTT","theoremPowerFromSingularities","recursiveTimeOut","fn","iterations","endFn","setTimeout","afterSimulation","seconds","playerBefore","playerAfter","awayProgress","notify","showBlackHoles","real","fast","ticks","maxTicks","maxOfflineTicks","offlineTicks","playerStart","totalGameTime","areUnlocked","calculateGameTimeFromRealTime","calculateSpeedups","infinitiedMilestone","eternitiedMilestone","ipOffline","bestIPMsWithoutMaxAll","OFFLINE_CURRENCY_GAINED","remainingRealSeconds","loopFn","i","realTickTime","calculateOfflineTick","remaining","postLoadStuff","progress","ui","view","modal","progressBar","Async","run","batchSize","maxTime","sleepTime","asyncEntry","doneSoFar","$viewModel","label","info","progressName","startTime","buttons","text","condition","click","newRemaining","maxIter","asyncProgress","asyncExit","then","window","onload","supportedBrowser","browserCheck","initialized","updateZoom","document","getElementById","style","display","onfocus","setShiftKey","onblur","GameKeyboard","stopSpins","isDown","shiftDown","setHoldingR","x","Replicanti","galaxies","isPlayerHoldingR","test","navigator","userAgent","init","console","initialize","load","config","lastOpenTab","tweenTime","lastFrame","animateTweens","requestAnimationFrame","delta"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,UAAlB;AAEA,SAASC,eAAT,EAA0BC,YAA1B,QAA8C,SAA9C;AAEA,SAASC,EAAT,QAAmB,kBAAnB;AACA,SAASC,YAAT,QAA6B,qBAA7B;AACA,SAASC,GAAT,QAAoB,OAApB;AACA,SAASC,kBAAT,QAAmC,iBAAnC;AACA,SAASC,KAAT,QAAsB,gBAAtB;AACA,SAASC,iBAAT,QAAkC,sBAAlC;AAEA,OAAOC,QAAP,MAAqB,iBAArB;;AAEA,IAAIC,kBAAkB,CAACC,OAAvB,EAAgC;AAC9B,QAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AACD;;AACDF,kBAAkB,CAACG,UAAnB,GAAgC,IAAhC;AAEA,OAAO,SAASC,6BAAT,GAAyC;AAE9C,QAAMC,gBAAgB,GAAG,IAAIC,GAAJ,CACvB,CAAC,UAAD,EAAa,SAAb,EAAwB,WAAxB,EACE,YADF,EACgB,YADhB,EAC8B,cAD9B,EAEE,QAFF,EAEY,QAFZ,EAEsB,QAFtB,EAEgC,WAFhC,EAGE,YAHF,EAGgB,YAHhB,EAG8B,QAH9B,EAIE,YAJF,EAIgB,aAJhB,EAI+B,iBAJ/B,EAKE,WALF,CADuB,CAAzB;AASA,QAAMC,qBAAqB,GAAG,IAAID,GAAJ,CAC5B,CAAC,UAAD,EAAa,SAAb,EAAwB,WAAxB,EACE,YADF,EACgB,YADhB,EAC8B,cAD9B,EAEE,QAFF,EAEY,QAFZ,EAEsB,QAFtB,EAEgC,WAFhC,EAGE,YAHF,EAGgB,YAHhB,EAG8B,QAH9B,EAIE,YAJF,EAIgB,aAJhB,EAI+B,iBAJ/B,EAKE,WALF,EAKe,aALf,EAK8B,YAL9B,EAME,eANF,EAMmB,iBANnB,EAMsC,gBANtC,EAOE,sBAPF,EAO0B,kBAP1B,EAO8C,qBAP9C,EAQE,WARF,CAD4B,CAA9B;;AAYA,MAAIE,YAAY,CAACC,yBAAb,CAAuCC,YAA3C,EAAyD;AACvDC,IAAAA,MAAM,CAACN,gBAAP,GAA0B,IAAIC,GAAJ,CAAQ,CAAC,GAAGK,MAAM,CAACN,gBAAX,EAA6BO,MAA7B,CAAoCC,CAAC,IAAIN,qBAAqB,CAACO,GAAtB,CAA0BD,CAA1B,CAAzC,CAAR,CAA1B;AACA;AACD;;AAED,MAAIL,YAAY,CAACO,oBAAb,CAAkCL,YAAtC,EAAoD;AAClDC,IAAAA,MAAM,CAACN,gBAAP,GAA0B,IAAIC,GAAJ,CAAQ,CAAC,GAAGK,MAAM,CAACN,gBAAX,EAA6BO,MAA7B,CAAoCC,CAAC,IAAIR,gBAAgB,CAACS,GAAjB,CAAqBD,CAArB,CAAzC,CAAR,CAA1B;AACAF,IAAAA,MAAM,CAACK,kBAAP,GAA4B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA5B;AACAC,IAAAA,SAAS,CAACC,qBAAV,CAAgCC,UAAhC;AACAF,IAAAA,SAAS,CAACG,qBAAV,CAAgCD,UAAhC;AACA;AACD;;AAED,MAAIE,cAAc,CAAC,EAAD,CAAd,CAAmBC,QAAnB,IAA+BC,iBAAiB,CAACC,iBAAlB,CAAoCC,SAAvE,EAAkF;AAChFd,IAAAA,MAAM,CAACN,gBAAP,GAA0BE,qBAA1B;AACAI,IAAAA,MAAM,CAACK,kBAAP,GAA4B,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,CAA5B;AACD,GAHD,MAGO,IAAIO,iBAAiB,CAACR,oBAAlB,CAAuCU,SAA3C,EAAsD;AAC3Dd,IAAAA,MAAM,CAACN,gBAAP,GAA0BA,gBAA1B;AACAM,IAAAA,MAAM,CAACK,kBAAP,GAA4B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA5B;AACD,GAHM,MAGA;AACLL,IAAAA,MAAM,CAACN,gBAAP,CAAwBqB,KAAxB;AACAf,IAAAA,MAAM,CAACK,kBAAP,GAA4B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA5B;AACD;;AAED,MAAIW,KAAK,CAACC,QAAV,EAAoB;AAClBjB,IAAAA,MAAM,CAACN,gBAAP,CAAwBqB,KAAxB;AACAf,IAAAA,MAAM,CAACK,kBAAP,GAA4B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA5B;AACD;;AAEDC,EAAAA,SAAS,CAACC,qBAAV,CAAgCC,UAAhC;AACAF,EAAAA,SAAS,CAACG,qBAAV,CAAgCD,UAAhC;AACD;AAED,OAAO,SAASU,aAAT,GAAyB;AAC9B,MAAI,CAACC,SAAS,CAACC,SAAV,CAAoBC,gBAAzB,EAA2C;AAC3C,MAAIC,iBAAiB,CAACC,SAAtB,EAAiC;;AACjC,OAAK,MAAMC,SAAX,IAAwBC,UAAU,CAACC,GAAnC,EAAwC;AACtC,QAAIF,SAAS,CAACG,IAAV,CAAeC,QAAf,KAA4BC,SAAhC,EAA2CL,SAAS,CAACM,kBAAV;AAC5C,GAL6B,CAM9B;;;AACAC,EAAAA,WAAW,CAAC,EAAD,CAAX,CAAgBC,SAAhB;AACAhC,EAAAA,MAAM,CAACiC,KAAP,GAAe,CAACjC,MAAM,CAACiC,KAAvB;AACAC,EAAAA,eAAe,CAACC,QAAhB,CAAyBC,UAAzB;AACAC,EAAAA,QAAQ,CAACC,QAAT,CAAkBtC,MAAM,CAACiC,KAAP,GAAeM,UAAU,CAACC,cAA1B,GAA2CD,UAAU,CAACE,YAAxE;AACAC,EAAAA,MAAM,CAACC,MAAP;AACD;AAED,OAAO,SAASC,oBAAT,GAAgC;AACrC,QAAMC,GAAG,GAAGC,OAAO,CAACC,GAAR,CACV,GADU,EAEVhB,WAAW,CAAC,GAAD,CAFD,EAGViB,SAAS,CAAC,GAAD,CAHC,CAAZ;;AAKA,MAAIhC,KAAK,CAACiC,UAAN,CAAiB,SAAjB,CAAJ,EAAiC;AAC/B,WAAOC,OAAO,CAACC,KAAR,CAAcnD,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4BC,KAA5B,CAAkCC,KAAlC,KAA4CV,GAA5C,GAAkD,IAAhE,EACJW,cADI,CACWC,UAAU,CAACC,MADtB,EAEJC,KAFI,CAEE3C,KAAK,CAAC4C,kBAAN,CAAyBC,QAF3B,EAGJC,KAHI,EAAP;AAID;;AACD,MAAIC,EAAE,GAAG/D,MAAM,CAACiC,KAAP,GACLiB,OAAO,CAACC,KAAR,CAAcnD,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4BC,KAA5B,CAAkCC,KAAlC,KAA4CV,GAA5C,GAAkD,IAAhE,CADK,GAEL,IAAIK,OAAJ,CAAY,MAAML,GAAlB,CAFJ;;AAGA,MAAImB,OAAO,CAACzC,SAAR,IAAqByC,OAAO,CAACC,YAAR,KAAyBC,cAAc,CAACC,QAAjE,EAA2E;AACzEJ,IAAAA,EAAE,GAAGA,EAAE,CAAChB,GAAH,CAAOjE,EAAE,CAACsF,IAAV,CAAL;AACD;;AACDL,EAAAA,EAAE,GAAGA,EAAE,CAACJ,KAAH,CAASrD,SAAS,CAAC+D,WAAV,CAAsBC,KAA/B,CAAL;;AACA,MAAIC,MAAM,CAAChD,SAAX,EAAsB;AACpBwC,IAAAA,EAAE,GAAGA,EAAE,CAACS,GAAH,CAAO,IAAP,CAAL;AACD,GAFD,MAEO,IAAIC,CAAC,CAAClD,SAAN,EAAiB;AACtBwC,IAAAA,EAAE,GAAGA,EAAE,CAACS,GAAH,CAAO,GAAP,CAAL;AACD,GAFM,MAEA,IAAIE,OAAO,CAACnD,SAAZ,EAAuB;AAC5BwC,IAAAA,EAAE,GAAGY,cAAc,CAACZ,EAAD,CAAnB;AACD;;AACD,MAAIa,eAAe,CAACC,OAAhB,CAAwB,UAAxB,CAAJ,EAAyC;AACvCd,IAAAA,EAAE,GAAGA,EAAE,CAACS,GAAH,CAAOM,uBAAuB,CAAC,YAAD,CAA9B,CAAL;AACD;;AAED,SAAOf,EAAE,CAACD,KAAH,EAAP;AACD;;AAED,SAASiB,WAAT,GAAuB;AACrB,SAAO/D,KAAK,CAACiC,UAAN,CAAiB,SAAjB,IACHjC,KAAK,CAAC4C,kBAAN,CAAyBoB,IAAzB,CAA8BC,aAA9B,CAA4CxB,UAAU,CAACC,MAAX,CAAkBwB,UAAlB,CAA6B,CAA7B,CAA5C,CADG,GAEHC,sBAAsB,CAAC,UAAD,CAAtB,CACCxB,KADD,CACOyB,YAAY,CAACC,WAAb,CAAyBC,WADhC,EAEC9B,cAFD,CAGE+B,eAAe,CAACC,MAHlB,EAIExC,SAAS,CAAC,EAAD,CAJX,EAKEA,SAAS,CAAC,GAAD,CALX,EAMEA,SAAS,CAAC,GAAD,CANX,EAOEA,SAAS,CAAC,GAAD,CAPX,EAQEtC,cAAc,CAAC,EAAD,CARhB,EASE+E,WAAW,CAACD,MATd,CAFJ;AAaD;;AAED,OAAO,SAASE,oBAAT,GAAgC;AACrC,MAAIC,EAAE,GAAG7G,EAAE,CAAC8G,EAAH,CAAMpB,GAAN,CAAUxE,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4BC,KAA5B,CAAkCC,IAAlC,CACjBnD,oBAAoB,EADH,EACOW,KADP,MACkB,MAAME,UAAU,CAACuC,SAAX,CAAqBC,WAArB,CAAiCC,QAAjC,EADxB,IACuE,GADjF,EACsFvC,KADtF,CAC4FoB,WAAW,EADvG,CAAT;;AAGA,MAAIR,MAAM,CAAChD,SAAX,EAAsB;AACpBoE,IAAAA,EAAE,GAAGA,EAAE,CAACnB,GAAH,CAAO,IAAP,CAAL;AACD,GAFD,MAEO,IAAIC,CAAC,CAAClD,SAAN,EAAiB;AACtBoE,IAAAA,EAAE,GAAGA,EAAE,CAACnB,GAAH,CAAO,GAAP,CAAL;AACD,GAFM,MAEA,IAAIE,OAAO,CAACnD,SAAZ,EAAuB;AAC5BoE,IAAAA,EAAE,GAAGhB,cAAc,CAACgB,EAAD,CAAnB;AACD;;AACD,MAAIf,eAAe,CAACC,OAAhB,CAAwB,MAAxB,CAAJ,EAAqC;AACnCc,IAAAA,EAAE,GAAGA,EAAE,CAACnB,GAAH,CAAOM,uBAAuB,CAAC,QAAD,CAA9B,CAAL;AACD;;AAED,SAAOa,EAAE,CAAC7B,KAAH,EAAP;AACD;AAED,OAAO,SAASqC,eAAT,CAAyBC,QAAzB,EAAmC;AACxC,SAAOlD,OAAO,CAACC,KAAR,CAAc,OAAOD,OAAO,CAACmD,GAAR,CAAYnD,OAAO,CAACoD,MAAR,CAAeF,QAAf,EAAyBrB,WAAW,EAApC,CAAZ,EAAqD,CAArD,IAA0D,GAAjE,CAAd,EACJwB,QADI,CACKC,MAAM,CAACC,SADZ,CAAP;AAED;AAED,OAAO,SAASC,gBAAT,GAA4B;AACjC,QAAMC,UAAU,GAAGC,mBAAmB,EAAtC;AACA,MAAIC,QAAQ,GAAGC,IAAI,CAAChD,KAAL,CAAW6C,UAAU,CAACE,QAAtB,CAAf;AACA,MAAI,CAACE,QAAQ,CAACF,QAAD,CAAb,EAAyBA,QAAQ,GAAG,CAAX;AACzB,MAAIG,WAAW,GAAGF,IAAI,CAAChD,KAAL,CAAW6C,UAAU,CAACK,WAAtB,CAAlB;AACA,MAAI,CAACD,QAAQ,CAACC,WAAD,CAAb,EAA4BA,WAAW,GAAG,CAAd;AAC5B,SAAO;AACLH,IAAAA,QADK;AAELG,IAAAA;AAFK,GAAP;AAID;AAED,OAAO,SAASC,mBAAT,GAA+B;AACpCjH,EAAAA,MAAM,CAACkH,SAAP,GAAmB,CAAnB;AACAlH,EAAAA,MAAM,CAACmH,SAAP,GAAmBrI,EAAE,CAACsI,KAAtB;AACAC,EAAAA,QAAQ,CAACC,MAAT,CAAgBC,KAAhB;AACAvH,EAAAA,MAAM,CAACwH,oBAAP,GAA8B1I,EAAE,CAAC2I,EAAjC;AACAzH,EAAAA,MAAM,CAAC0H,UAAP,GAAoB,CAApB;AACD;AAED,OAAO,SAASC,aAAT,CAAuBC,MAAvB,EAA+B5C,IAA/B,EAAqC;AAC1C,SAAO9B,OAAO,CAACoD,MAAR,CAAesB,MAAf,EAAuB5C,IAAI,IAAI,KAAK,IAAT,CAA3B,CAAP;AACD,C,CAED;;AACA,OAAO,SAAS6C,eAAT,CAAyB7C,IAAzB,EAA+B8C,QAA/B,EAAyC/D,EAAzC,EAA6CgE,UAA7C,EAAyD;AAC9D,MAAIC,SAAS,GAAG,EAAhB;AACA,MAAIhI,MAAM,CAACgI,SAAP,CAAiBC,MAAjB,CAAwBC,OAA5B,EAAqCF,SAAS,GAAI,oBAAmBhI,MAAM,CAACgI,SAAP,CAAiBC,MAAjB,CAAwBC,OAAQ,EAAhE;AACrC,MAAIlI,MAAM,CAACgI,SAAP,CAAiBnE,QAAjB,CAA0BqE,OAA9B,EAAuCF,SAAS,GAAI,sBAAqBhI,MAAM,CAACgI,SAAP,CAAiBnE,QAAjB,CAA0BqE,OAAQ,EAApE;AACvClI,EAAAA,MAAM,CAACoD,OAAP,CAAe+E,gBAAf,CAAgCC,GAAhC;AACApI,EAAAA,MAAM,CAACoD,OAAP,CAAe+E,gBAAf,CAAgCE,OAAhC,CAAwC,CAACrD,IAAI,GAAGsD,oBAAoB,EAA5B,EAAgCR,QAAhC,EAA0C/D,EAA1C,EAA8CgE,UAA9C,EAA0DC,SAA1D,CAAxC;AACA1H,EAAAA,SAAS,CAACiI,WAAV,CAAsB/H,UAAtB;AACD;AAED,OAAO,SAASgI,iBAAT,GAA6B;AAClCxI,EAAAA,MAAM,CAACoD,OAAP,CAAe+E,gBAAf,GAAkCM,KAAK,CAACC,IAAN,CAChC;AAAEC,IAAAA,MAAM,EAAE;AAAV,GADgC,EAEhC,MAAM,CAACnC,MAAM,CAACC,SAAR,EAAmBD,MAAM,CAACC,SAA1B,EAAqC3H,EAAE,CAAC2I,EAAxC,EAA4C3I,EAAE,CAAC2I,EAA/C,EAAmD,EAAnD,CAF0B,CAAlC;AAIAnH,EAAAA,SAAS,CAACiI,WAAV,CAAsB/H,UAAtB;AACD,C,CAED;AACA;;AACA,OAAO,SAASoI,4BAAT,CAAsCC,EAAtC,EAA0CC,wBAA1C,EAAoE;AACzE,SAAO3H,SAAS,CAACC,SAAV,CAAoB2H,uBAApB,CAA4CD,wBAA5C,IACH5F,OAAO,CAACY,KAAR,CAAc9D,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4BmD,mBAA5B,CAAgDrF,KAAhD,CAAsDkF,EAAtD,EAA0DI,SAA1D,CAAoE,CAApE,CAAd,CADG,GAEHnK,EAAE,CAACoK,EAFP;AAGD,C,CAED;;AACA,OAAO,SAASC,eAAT,CAAyBnE,IAAzB,EAA+B8C,QAA/B,EAAyCnC,EAAzC,EAA6CyD,UAA7C,EAAyD;AAC9D,MAAIpB,SAAS,GAAG,EAAhB;;AACA,MAAIhI,MAAM,CAACgI,SAAP,CAAiBqB,QAAjB,CAA0BnB,OAA9B,EAAuC;AACrC,UAAMoB,MAAM,GAAGtJ,MAAM,CAACgI,SAAP,CAAiBqB,QAAjB,CAA0BnB,OAAzC;AACA,UAAMqB,EAAE,GAAGC,iBAAiB,CAACF,MAAD,CAA5B;AACA,UAAMG,SAAS,GAAGzJ,MAAM,CAAC0J,QAAP,CAAgBC,MAAhB,GAAyB,YAAzB,GAAwC,oBAA1D;AACA3B,IAAAA,SAAS,GAAI,GAAEyB,SAAU,IAAGH,MAAO,KAAIM,SAAS,CAACL,EAAE,CAACM,WAAJ,CAAiB,IAAGD,SAAS,CAACL,EAAE,CAACO,cAAJ,CAAoB,GAAjG;AACD,GALD,MAKO,IAAI9J,MAAM,CAAC0J,QAAP,CAAgBC,MAApB,EAA4B3B,SAAS,GAAG,eAAZ,CAP2B,CAQ9D;;;AACA,QAAM+B,QAAQ,GAAG/J,MAAM,CAAC0J,QAAP,CAAgBC,MAAhB,GAAyBK,cAAc,EAAvC,GAA4ClL,EAAE,CAACoK,EAAhE;AACAlJ,EAAAA,MAAM,CAACoD,OAAP,CAAe6G,gBAAf,CAAgC7B,GAAhC;AACApI,EAAAA,MAAM,CAACoD,OAAP,CAAe6G,gBAAf,CAAgC5B,OAAhC,CAAwC,CAACrD,IAAI,GAAGsD,oBAAoB,EAA5B,EAAgCR,QAAhC,EAA0CnC,EAA1C,EAA8CyD,UAA9C,EAA0DpB,SAA1D,EAAqE+B,QAArE,CAAxC;AACAzJ,EAAAA,SAAS,CAAC4J,0BAAV,CAAqC1J,UAArC;AACD;AAED,OAAO,SAAS2J,iBAAT,GAA6B;AAClCnK,EAAAA,MAAM,CAACoD,OAAP,CAAe6G,gBAAf,GAAkCxB,KAAK,CAACC,IAAN,CAChC;AAAEC,IAAAA,MAAM,EAAE;AAAV,GADgC,EAEhC,MAAM,CAACnC,MAAM,CAACC,SAAR,EAAmBD,MAAM,CAACC,SAA1B,EAAqC3H,EAAE,CAAC2I,EAAxC,EAA4C3I,EAAE,CAAC2I,EAA/C,EAAmD,EAAnD,EAAuD3I,EAAE,CAACoK,EAA1D,CAF0B,CAAlC;AAIA5I,EAAAA,SAAS,CAAC4J,0BAAV,CAAqC1J,UAArC;AACD,C,CAED;AACA;;AACA,OAAO,SAAS4J,4BAAT,CAAsCvB,EAAtC,EAA0CC,wBAA1C,EAAoE;AACzE,SAAO3H,SAAS,CAACkI,QAAV,CAAmBgB,uBAAnB,CAA2CvB,wBAA3C,IACH5F,OAAO,CAACY,KAAR,CAAc9D,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2BC,mBAA3B,CAA+C5G,KAA/C,CAAqDkF,EAArD,EAAyDI,SAAzD,CAAmE,CAAnE,CAAd,CADG,GAEHnK,EAAE,CAACoK,EAFP;AAGD;;AAED,SAASsB,sBAAT,GAAkC;AAChC,SAAOxK,MAAM,CAACyK,OAAP,CAAeC,eAAf,IAAkC,CAACvJ,SAAS,CAACC,SAAV,CAAoB2H,uBAApB,EAAnC,IACL,CAAC5H,SAAS,CAACkI,QAAV,CAAmBgB,uBAAnB,EADH;AAED;;AAED,OAAO,SAASM,gBAAT,CAA0B9B,EAA1B,EAA8B;AACnC,MAAI,CAACjI,iBAAiB,CAACgK,MAAlB,CAAyB9J,SAA1B,IAAuC,CAAC0J,sBAAsB,EAAlE,EAAsE,OAAO1L,EAAE,CAACoK,EAAV;AACtE,SAAOlJ,MAAM,CAACoD,OAAP,CAAeyH,YAAf,CAA4BC,gBAA5B,CAA6CnH,KAA7C,CAAmDoH,QAAQ,CAACC,gBAAT,CAA0BnC,EAA1B,EAA8BoC,YAA9B,GAA6C,CAAhG,CAAP;AACD,C,CAED;AACA;AACA;;AACA,OAAO,SAASC,cAAT,CAAwBlG,IAAxB,EAA8B8C,QAA9B,EAAwCqD,EAAxC,EAA4CC,KAA5C,EAAmDC,SAAnD,EAA8DC,SAA9D,EAAyEC,MAAzE,EAAiF;AACtF,MAAIC,OAAO,GAAG,EAAd;AACA,QAAMC,UAAU,GAAG,CAAClH,MAAD,EAASP,OAAT,EAAkB0H,QAAlB,EAA4BjH,CAA5B,EAA+BkH,EAA/B,EAAmCjH,OAAnC,CAAnB;;AACA,OAAK,MAAMkH,GAAX,IAAkBH,UAAlB,EAA8B;AAC5B,QAAIG,GAAG,CAACrK,SAAR,EAAmBiK,OAAO,GAAGI,GAAG,CAACC,WAAd;AACpB;;AACD,QAAMC,MAAM,GAAG9H,OAAO,CAAC+H,YAAvB;AACA/L,EAAAA,MAAM,CAACoD,OAAP,CAAe4I,eAAf,CAA+B5D,GAA/B;AACApI,EAAAA,MAAM,CAACoD,OAAP,CAAe4I,eAAf,CAA+B3D,OAA/B,CAAuC,CAACrD,IAAI,GAAGsD,oBAAoB,EAA5B,EAAgCR,QAAhC,EAA0CqD,EAAE,CAACxH,KAAH,CAAS2H,SAAT,CAA1C,EACrCD,SADqC,EAC1BG,OAD0B,EACjBJ,KADiB,EACVU,MAAM,GAAGR,SADC,EACUC,MADV,CAAvC;AAED;AAED,OAAO,SAASU,gBAAT,GAA4B;AACjC,MAAIzC,iBAAiB,CAAC,CAAD,CAAjB,CAAqBjI,SAArB,IAAkCP,KAAK,CAACiC,UAAN,CAAiB,iBAAjB,CAAtC,EAA2E;AACzE,WAAOnE,EAAE,CAAC2I,EAAV;AACD;;AACD,MAAIyE,OAAO,GAAGpJ,OAAO,CAACqJ,GAAR,CACZ,CADY,EAEZpK,WAAW,CAAC,EAAD,CAFC,EAGZqK,SAHY,EAAd;AAKAF,EAAAA,OAAO,GAAGA,OAAO,CAAC1I,cAAR,CACRR,SAAS,CAAC,EAAD,CADD,EAERtC,cAAc,CAAC,CAAD,CAFN,EAGRA,cAAc,CAAC,CAAD,CAHN,EAIRqB,WAAW,CAAC,GAAD,CAAX,CAAiBsK,OAAjB,CAAyBC,cAJjB,EAKRvK,WAAW,CAAC,GAAD,CALH,EAMR4J,EAAE,CAACY,OAAH,CAAWC,iBAAX,CAA6BH,OAA7B,CAAqCxI,QAN7B,CAAV;AAQAqI,EAAAA,OAAO,GAAGA,OAAO,CAACvI,KAAR,CAAcwB,sBAAsB,CAAC,iBAAD,CAApC,CAAV;AACA+G,EAAAA,OAAO,GAAGA,OAAO,CAACO,WAAR,CAAoBC,oBAAoB,CAACC,aAAzC,CAAV;AACA,SAAOT,OAAP;AACD;AAED,OAAO,SAASU,aAAT,GAAyB;AAC9BC,EAAAA,WAAW,CAACC,IAAZ;AACAC,EAAAA,QAAQ,CAACC,MAAT,CAAgB,IAAhB;AACD;AAED,OAAO,MAAMC,iBAAiB,GAAG;AAC/BC,EAAAA,WAAW,EAAE,CADkB;AAE/BC,EAAAA,UAAU,EAAE,CAFmB;AAG/BC,EAAAA,UAAU,EAAE,CAHmB;AAI/BC,EAAAA,YAAY,EAAE,CAJiB;AAK/BC,EAAAA,qBAAqB,EAAE,CALQ;AAM/BC,EAAAA,KAAK,EAAE;AANwB,CAA1B;AASP;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASC,oBAAT,CAA8BC,iBAA9B,EAAiDC,wBAAjD,EAA2E;AAChF,MAAIrB,OAAJ;;AACA,MAAIoB,iBAAiB,KAAK5L,SAA1B,EAAqC;AACnCwK,IAAAA,OAAO,GAAG,CAACY,iBAAiB,CAACC,WAAnB,EAAgCD,iBAAiB,CAACE,UAAlD,EAA8DF,iBAAiB,CAACG,UAAhF,EACRH,iBAAiB,CAACI,YADV,EACwBJ,iBAAiB,CAACK,qBAD1C,EACiEL,iBAAiB,CAACM,KADnF,CAAV;AAED,GAHD,MAGO;AACLlB,IAAAA,OAAO,GAAGoB,iBAAV;AACD;;AAED,MAAIpB,OAAO,CAACsB,QAAR,CAAiBV,iBAAiB,CAACC,WAAnC,CAAJ,EAAqD;AACnD,QAAI1D,iBAAiB,CAAC,EAAD,CAAjB,CAAsBjI,SAA1B,EAAqC;AACnC,aAAO,IAAI,IAAX;AACD;AACF;;AAED,MAAIqM,MAAM,GAAG,CAAb;;AACA,MAAIvB,OAAO,CAACsB,QAAR,CAAiBV,iBAAiB,CAACG,UAAnC,CAAJ,EAAoD;AAClD,QAAIS,UAAU,CAACC,WAAf,EAA4B;AAC1BF,MAAAA,MAAM,IAAI5N,MAAM,CAAC+N,iBAAjB;AACD,KAFD,MAEO,IAAI,CAACF,UAAU,CAACG,SAAhB,EAA2B;AAChC,WAAK,MAAMC,SAAX,IAAwBJ,UAAU,CAACK,IAAnC,EAAyC;AACvC,YAAI,CAACD,SAAS,CAACE,UAAf,EAA2B;AAC3B,cAAMC,QAAQ,GAAGV,wBAAwB,KAAK7L,SAA7B,GACboM,SAAS,CAACG,QADG,GAEbH,SAAS,CAACI,EAAV,IAAgBX,wBAFpB;AAGA,YAAI,CAACU,QAAL,EAAe;AACfR,QAAAA,MAAM,IAAI9G,IAAI,CAACtC,GAAL,CAASyJ,SAAS,CAACK,KAAnB,EAA0BT,UAAU,CAACU,yBAArC,CAAV;AACAX,QAAAA,MAAM,IAAIY,QAAQ,CAACC,aAAT,CAAuBC,eAAvB,CAAuC,CAAvC,CAAV;AACD;AACF;AACF;;AAED,MAAIrC,OAAO,CAACsB,QAAR,CAAiBV,iBAAiB,CAACK,qBAAnC,CAAJ,EAA+D;AAC7DM,IAAAA,MAAM,IAAIlB,oBAAoB,CAACiC,0BAArB,CAAgDD,eAAhD,CAAgE,CAAhE,CAAV;AACD;;AAED,MAAIrC,OAAO,CAACsB,QAAR,CAAiBV,iBAAiB,CAACE,UAAnC,CAAJ,EAAoD;AAClDS,IAAAA,MAAM,IAAIzI,sBAAsB,CAAC,WAAD,CAAhC;AACAyI,IAAAA,MAAM,GAAG9G,IAAI,CAACtC,GAAL,CAASoJ,MAAT,EAAiBzI,sBAAsB,CAAC,kBAAD,CAAvC,CAAT;AACD;;AAED,MAAIuG,QAAQ,CAACkD,iBAAT,IAA8BvC,OAAO,CAACsB,QAAR,CAAiBV,iBAAiB,CAACI,YAAnC,CAAlC,EAAoF;AAClF,UAAMwB,gBAAgB,GAAGlD,EAAE,CAACY,OAAH,CAAWuC,aAAX,CAAyB/O,YAAzB,GAAwC,IAAxC,GAA+C,CAAxE;AACA6N,IAAAA,MAAM,GAAGA,MAAM,IAAI,IAAIiB,gBAAR,CAAN,GAAkCA,gBAA3C;AACD,GA5C+E,CA8ChF;AACA;;;AACA,MAAIxC,OAAO,CAACsB,QAAR,CAAiBV,iBAAiB,CAACM,KAAnC,CAAJ,EAA+C;AAC7C,QAAIvJ,OAAO,CAACzC,SAAZ,EAAuB;AACrBqM,MAAAA,MAAM,GAAG5J,OAAO,CAAC+K,UAAR,CAAmBnB,MAAnB,EAA2B1H,QAA3B,EAAT;AACD,KAFD,MAEO,IAAIxB,OAAO,CAACnD,SAAZ,EAAuB;AAC5B,YAAMyN,YAAY,GAAGlI,IAAI,CAACmI,QAAL,CAAcC,IAAI,CAACC,mBAAL,CAAyBlE,YAAzB,GAAwC,EAAtD,EAA0D,CAA1D,CAArB;AACA2C,MAAAA,MAAM,GAAG9G,IAAI,CAACtC,GAAL,CAASoJ,MAAT,EAAiBoB,YAAjB,CAAT;AACD;AACF;;AAGDpB,EAAAA,MAAM,IAAI/N,YAAY,CAACuP,aAAb,CAA2BnJ,WAA3B,CAAuCC,QAAvC,EAAV,CA1DgF,CA4DhF;AACA;;AACA0H,EAAAA,MAAM,GAAG9G,IAAI,CAACuI,KAAL,CAAWzB,MAAX,EAAmB,MAAnB,EAA2B,KAA3B,CAAT;AAEA,SAAOA,MAAP;AACD;AAED,OAAO,SAAS0B,wBAAT,GAAoC;AACzC,QAAMC,WAAW,GAAG/B,oBAAoB,EAAxC;;AACA,MACE9B,QAAQ,CAAC8D,eAAT,IACA9D,QAAQ,CAAC+D,UAAT,CAAoB,IAApB,CADA,IAEA,CAAC5B,UAAU,CAACC,WAFZ,IAGA,CAAC9M,KAAK,CAACiC,UAAN,CAAiB,WAAjB,CAJH,EAKE;AACA,WAAO6D,IAAI,CAACqF,GAAL,CAAST,QAAQ,CAACgE,gBAAlB,EAAoCH,WAApC,CAAP;AACD;;AACD,SAAOA,WAAP;AACD,C,CAED;AACA;;AACA,OAAO,SAASI,iBAAT,CAA2BC,QAA3B,EAAqC;AAE1C;AAEA;AACA;AACAjE,EAAAA,EAAE,CAACkE,UAAH,CAAcD,QAAQ,GAAG9I,IAAI,CAACtC,GAAL,CAAS8D,oBAAoB,EAA7B,EAAgC,IAAE,CAAlC,CAAzB,EAA+D,CAACoD,QAAQ,CAACoE,iBAAzE;;AACA,MAAIC,eAAe,CAACC,QAAhB,CAAyB7B,UAA7B,EAAyC;AACvCnO,IAAAA,MAAM,CAACyL,UAAP,CAAkBwE,EAAlB,CAAqBC,YAArB,IAAqCN,QAAQ,GAAG7N,WAAW,CAAC,GAAD,CAAX,CAAiB2M,eAAjB,CAAiC,CAAjC,CAAhD;AACD;;AAEDyB,EAAAA,oBAAoB,CAACC,IAArB,CAA0BR,QAAQ,GAAG9I,IAAI,CAACtC,GAAL,CAAS8D,oBAAoB,EAA7B,EAAgC,IAAE,CAAlC,CAArC,EAX0C,CAa1C;;AACA,MAAIoD,QAAQ,CAACoE,iBAAb,EAAgC;AAE9B;AACAF,IAAAA,QAAQ,IAAItH,oBAAoB,EAAhC;AAEAtI,IAAAA,MAAM,CAACoD,OAAP,CAAeiN,cAAf,IAAiCT,QAAjC;AACA5P,IAAAA,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4ByE,QAA5B,IAAwC8H,QAAxC;AACA5P,IAAAA,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4BiC,QAA5B,IAAwC8H,QAAxC;AACA5P,IAAAA,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2BxC,QAA3B,IAAuC8H,QAAvC;AACAlE,IAAAA,QAAQ,CAAC4E,aAAT,GAT8B,CAU9B;AACA;;AACA7O,IAAAA,UAAU,CAAC2O,IAAX;AACA1N,IAAAA,MAAM,CAACC,MAAP;AACA,WAAO,IAAP;AACD;;AACD,SAAO,KAAP;AACD,C,CAED;AACA;AACA;AACA;;AACA,OAAO,SAAS4N,QAAT,CAAkBC,QAAlB,EAA4B/F,OAAO,GAAG,EAAtC,EAA0C;AAE/CgG,EAAAA,gBAAgB,CAACC,KAAjB,CAAuB,YAAvB;AACAD,EAAAA,gBAAgB,CAACC,KAAjB,CAAuB,aAAvB;AAEArO,EAAAA,QAAQ,CAACC,QAAT,CAAkBC,UAAU,CAACoO,gBAA7B,EAL+C,CAO/C;AACA;;AACA,MAAI3Q,MAAM,CAACyK,OAAP,CAAemG,UAAnB,EAA+B5Q,MAAM,CAAC6Q,UAAP,GAAoBC,IAAI,CAACC,GAAL,EAApB,CATgB,CAW/C;AACA;AACA;;AACA,MAAIC,QAAQ,CAACC,eAAT,MAA8BC,OAAO,CAACC,iBAAtC,IAA2DnR,MAAM,CAACyK,OAAP,CAAemG,UAA9E,EAA0F;AACxFlO,IAAAA,MAAM,CAACC,MAAP;AACA;AACD;;AAED,MAAIyO,IAAI,GAAGZ,QAAX;AACA,QAAMa,UAAU,GAAGP,IAAI,CAACC,GAAL,EAAnB;AACA,QAAMnB,QAAQ,GAAG,CAACwB,IAAI,KAAKvP,SAAT,GACdiF,IAAI,CAACuI,KAAL,CAAWgC,UAAU,GAAGrR,MAAM,CAAC6Q,UAA/B,EAA2C,CAA3C,EAA8C,MAA9C,CADc,GAEdO,IAFa,IAEL9I,oBAAoB,EAFhC;AAGA,MAAI,CAACuE,WAAW,CAACyE,iBAAjB,EAAoCtR,MAAM,CAACuR,WAAP,IAAsB3B,QAAQ,GAAGtH,oBAAoB,EAArD,CAxBW,CA0B/C;AACA;AACA;AACA;AACA;AACA;;AACA,MAAItI,MAAM,CAACyK,OAAP,CAAe+G,kBAAf,IAAqChB,QAAQ,KAAK3O,SAAlD,IAA+D+N,QAAQ,GAAG,MAAMtH,oBAAoB,EAAxG,EAA4G;AAC1GmJ,IAAAA,aAAa,CAAClB,QAAd,CAAuBmB,IAAvB;AACAC,IAAAA,YAAY,CAAC/B,QAAQ,GAAG,IAAX,GAAkBtH,oBAAoB,EAAvC,EAA2C,IAA3C,CAAZ;AACAqH,IAAAA,iBAAiB,CAACC,QAAD,CAAjB;AACA;AACD,GArC8C,CAuC/C;;;AACA,MAAID,iBAAiB,CAACC,QAAD,CAArB,EAAiC,OAxCc,CA0C/C;;AACA,MAAIlE,QAAQ,CAAC8D,eAAb,EAA8B;AAC5B9D,IAAAA,QAAQ,CAACkG,eAAT;AACD;;AACD,MAAIlG,QAAQ,CAACkG,eAAT,IAA4B,CAAhC,EAAmC;AACjClG,IAAAA,QAAQ,CAACkG,eAAT,GAA2B,CAA3B;AACAlG,IAAAA,QAAQ,CAACmG,aAAT,CAAuB,IAAvB;AACAnG,IAAAA,QAAQ,CAACoG,aAAT,GAAyB,IAAzB;AACD,GAJD,MAIO,IAAI,CAACpG,QAAQ,CAACoG,aAAd,EAA6B;AAClCpG,IAAAA,QAAQ,CAACqG,YAAT,GAAwBnC,QAAxB;AACD;;AACD,MAAIwB,IAAI,KAAKvP,SAAb,EAAwB;AACtBuP,IAAAA,IAAI,GAAG1F,QAAQ,CAACqG,YAAhB;AACD,GAFD,MAGKX,IAAI,IAAI9I,oBAAoB,EAA5B;;AAEL7G,EAAAA,UAAU,CAAC2O,IAAX;AACA4B,EAAAA,QAAQ,CAACC,YAAT;;AAEA,MAAIlQ,WAAW,CAAC,GAAD,CAAX,CAAiBoM,UAAjB,IAA+BnO,MAAM,CAACyL,UAAP,CAAkByG,OAAlB,CAA0BC,sBAA7D,EAAqF;AACnFA,IAAAA,sBAAsB;AACvB,GA/D8C,CAiE/C;AACA;;;AACA7R,EAAAA,SAAS,CAAC8R,mCAAV,CAA8C5R,UAA9C;AACAF,EAAAA,SAAS,CAAC+R,mCAAV,CAA8C7R,UAA9C;AACAF,EAAAA,SAAS,CAACgS,iCAAV,CAA4C9R,UAA5C;AACAF,EAAAA,SAAS,CAACiS,6BAAV,CAAwC/R,UAAxC;AACAF,EAAAA,SAAS,CAAC+D,WAAV,CAAsB7D,UAAtB;AAEA,QAAMgS,aAAa,GAAG5C,QAAQ,GAAG9I,IAAI,CAAC2L,IAAL,CAAUnK,oBAAoB,EAA9B,CAAjC;AACA,QAAMoK,gBAAgB,GAAGlJ,iBAAiB,CAAC,EAAD,CAAjB,CAAsBjI,SAA/C;;AACA,MAAI,CAACmK,QAAQ,CAACoG,aAAV,IAA2B,CAACY,gBAAhC,EAAkD;AAChD,QAAInD,WAAJ;;AACA,QAAI9E,OAAO,CAACkI,gBAAR,KAA6B9Q,SAAjC,EAA4C;AAC1C0N,MAAAA,WAAW,GAAG/B,oBAAoB,EAAlC;AACD,KAFD,MAEO;AACL;AACA;AACA+B,MAAAA,WAAW,GAAG9E,OAAO,CAACkI,gBAAtB;AACD;;AAED,QAAIjH,QAAQ,CAACkD,iBAAT,IAA8B,CAAC8D,gBAAnC,EAAqD;AACnD;AACA,YAAME,iBAAiB,GAAGpF,oBAAoB,EAA9C;AACA,YAAMqF,eAAe,GAAGrF,oBAAoB,CAAC,CAACP,iBAAiB,CAACC,WAAnB,EAAgCD,iBAAiB,CAACE,UAAlD,EAC3CF,iBAAiB,CAACG,UADyB,EACbH,iBAAiB,CAACK,qBADL,CAAD,CAA5C;AAEA,YAAMwF,aAAa,GAAGnH,EAAE,CAACY,OAAH,CAAWwG,kBAAX,CAA8B1G,OAA9B,CAAsC2G,qBAAtC,CAA4DtE,eAA5D,CAA4E,CAA5E,CAAtB;AACA,YAAMuE,WAAW,GAAGjT,MAAM,CAACyL,UAAP,CAAkByH,QAAlB,CAA2BC,MAA/C;AACAnT,MAAAA,MAAM,CAACyL,UAAP,CAAkByH,QAAlB,CAA2BC,MAA3B,GAAoCrM,IAAI,CAACmI,QAAL,CAAcjP,MAAM,CAACyL,UAAP,CAAkByH,QAAlB,CAA2BC,MAA3B,GAChD/B,IAAI,IAAIyB,eAAe,GAAGD,iBAAtB,CAAJ,GAA+CE,aADb,EAC4BpH,QAAQ,CAAC0H,OADrC,CAApC;AAEA1H,MAAAA,QAAQ,CAAC2H,gCAAT,GAA4C,CAACrT,MAAM,CAACyL,UAAP,CAAkByH,QAAlB,CAA2BC,MAA3B,GAAoCF,WAArC,IAAoD7B,IAAhG;AACA7B,MAAAA,WAAW,GAAGqD,iBAAd;AACD;;AACDxB,IAAAA,IAAI,IAAI7B,WAAR;AACD,GAvBD,MAuBO,IAAImD,gBAAJ,EAAsB;AAC3BtB,IAAAA,IAAI,IAAI5D,oBAAoB,EAA5B;AACA9B,IAAAA,QAAQ,CAAC2H,gCAAT,GAA4C,CAA5C;AACD;;AACDrT,EAAAA,MAAM,CAACyL,UAAP,CAAkBwE,EAAlB,CAAqBqD,aAArB,GAAqCxM,IAAI,CAACqF,GAAL,CAASnM,MAAM,CAACyL,UAAP,CAAkBwE,EAAlB,CAAqBqD,aAA9B,EAA6C9F,oBAAoB,EAAjE,CAArC;AACA9B,EAAAA,QAAQ,CAACoG,aAAT,GAAyB,KAAzB,CAvG+C,CAyG/C;AACA;AACA;;AACA,MAAI,CAAC/P,WAAW,CAAC,GAAD,CAAX,CAAiBoM,UAAtB,EAAkC;AAChCnO,IAAAA,MAAM,CAACoD,OAAP,CAAemQ,cAAf,IAAiC3D,QAAQ,GAAGtH,oBAAoB,EAAhE;AACAtI,IAAAA,MAAM,CAACoD,OAAP,CAAeiN,cAAf,IAAiCT,QAAQ,GAAGtH,oBAAoB,EAAhE;AACAtI,IAAAA,MAAM,CAACoD,OAAP,CAAeoQ,eAAf,IAAkCpC,IAAlC;AACApR,IAAAA,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4ByE,QAA5B,IAAwC8H,QAAQ,GAAGtH,oBAAoB,EAAvE;AACAtI,IAAAA,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4B2B,IAA5B,IAAoCoM,IAApC;AACApR,IAAAA,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4BiC,QAA5B,IAAwC8H,QAAQ,GAAGtH,oBAAoB,EAAvE;;AACA,QAAIoD,QAAQ,CAACnK,SAAT,IAAsBmK,QAAQ,CAAC+H,YAA/B,IAA+C,CAACjK,iBAAiB,CAAC,EAAD,CAAjB,CAAsBjI,SAA1E,EAAqF;AACnFvB,MAAAA,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4Bb,IAA5B,IAAoCoM,IAAI,IAAI,IAAI/J,QAAQ,CAAC+B,UAAT,CAAoB9E,KAApB,CAA0B2K,QAA1B,CAAmC,IAAnC,EAAyC/I,QAAzC,EAAR,CAAxC;AACD,KAFD,MAEO;AACLlG,MAAAA,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4Bb,IAA5B,IAAoCoM,IAApC;AACD;;AACDpR,IAAAA,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2BxC,QAA3B,IAAuC8H,QAAQ,GAAGtH,oBAAoB,EAAtE;AACAtI,IAAAA,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2BtF,IAA3B,IAAmCoM,IAAnC;AACD;;AAEDsC,EAAAA,cAAc,CAAC/Q,MAAf,CAAsBiN,QAAtB,EAAgCwB,IAAhC;AAEAuC,EAAAA,iCAAiC,CAACvC,IAAD,CAAjC,CA9H+C,CAgI/C;AACA;;AACAwC,EAAAA,uBAAuB,CAACxC,IAAD,CAAvB;;AAEA,MAAI,CAACpQ,KAAK,CAACC,QAAX,EAAqB;AACnB4S,IAAAA,kBAAkB;AACnB;;AAGDC,EAAAA,iBAAiB,CAAClE,QAAQ,GAAGtH,oBAAoB,EAAhC,CAAjB;AACAyL,EAAAA,uBAAuB,CAACnE,QAAD,CAAvB;AAEA,QAAMoE,kBAAkB,GAAGjE,eAAe,CAACkE,cAAhB,CAA+BhO,WAA/B,GAA6CiJ,IAAI,CAACgF,iBAAL,CAAuBC,YAA/F;AACA9M,EAAAA,QAAQ,CAACgE,SAAT,CAAmB+I,GAAnB,CAAuBJ,kBAAvB;AACA3M,EAAAA,QAAQ,CAACgN,UAAT,CAAoBD,GAApB,CAAwBJ,kBAAxB;AAEA,MAAIM,IAAI,CAACC,eAAL,CAAqBxU,YAAzB,EAAuCC,MAAM,CAACwL,OAAP,CAAegJ,UAAf,IAA6B5E,QAA7B;AAEvCpG,EAAAA,iBAAiB,CAAC,EAAD,CAAjB,CAAsBiL,OAAtB;;AACAC,EAAAA,YAAY,CAACC,MAAb,CAAoBnU,UAApB;;AAEAoU,EAAAA,cAAc,CAACxE,IAAf,CAAoBgB,IAApB;AACAyD,EAAAA,kBAAkB,CAACzE,IAAnB,CAAwBgB,IAAxB;AACA0D,EAAAA,oBAAoB,CAAC1E,IAArB,CAA0BgB,IAA1B;AAEA,QAAM2D,IAAI,GAAGjO,IAAI,CAACP,QAAL,CAAcyO,aAAa,CAACC,UAAd,CAAyB5N,QAAQ,CAAC6N,UAAT,CAAoB5Q,KAA7C,EAAoD6Q,SAApD,GAAgEnV,MAAM,CAACoV,eAArF,EAAsG,CAAtG,CAAb;AACApV,EAAAA,MAAM,CAACoV,eAAP,IAA0BL,IAA1B;AAEAM,EAAAA,mBAAmB;AACnBC,EAAAA,6BAA6B;AAE7BC,EAAAA,kBAAkB,CAACC,YAAnB,CAAgCpF,IAAhC;AAEAqF,EAAAA,cAAc,CAACrE,IAAD,CAAd;;AAEA,MAAIsE,cAAc,CAACC,gBAAf,EAAJ,EAAuC;AACrCtO,IAAAA,QAAQ,CAACuO,WAAT,CAAqBxB,GAArB,CAAyByB,wBAAwB,GAAGlS,KAA3B,CAAiCyN,IAAI,GAAG,IAAxC,CAAzB;AACD;;AAED0E,EAAAA,qBAAqB;AACrBzO,EAAAA,QAAQ,CAAC0O,YAAT,CAAsB3B,GAAtB,CAA0B4B,cAAc,GAAGrS,KAAjB,CAAuByN,IAAI,GAAG,IAA9B,CAA1B;AACAyD,EAAAA,kBAAkB,CAACoB,aAAnB;AAEApI,EAAAA,UAAU,CAACqI,YAAX,CAAwB1D,aAAxB,EA3K+C,CA6K/C;AACA;AACA;;AACA,MAAI7G,EAAE,CAACY,OAAH,CAAW4J,kBAAX,CAA8BpW,YAA9B,IACFsH,QAAQ,CAAC0O,YAAT,CAAsB5J,GAAtB,CAA0BiK,GAA1B,CAA8BpT,SAAS,CAAC0G,QAAV,CAAmB2M,2BAAjD,CADE,IAEF,CAACC,oBAAoB,EAFnB,IAGF,CAACtV,KAAK,CAACC,QAHT,EAGmB;AACjBoG,IAAAA,QAAQ,CAAC0O,YAAT,CAAsB3B,GAAtB,CAA0BpR,SAAS,CAAC0G,QAAV,CAAmB6M,IAA7C;AACAvT,IAAAA,SAAS,CAAC0G,QAAV,CAAmB8M,QAAnB,CAA4B,IAA5B;AACD;;AAEDC,EAAAA,oBAAoB;AACpB,MAAIC,cAAc,CAAC/M,MAAnB,EAA2B+M,cAAc,CAAC/T,MAAf,CAAsB+D,gBAAgB,EAAtC,EAzLoB,CA2L/C;AACA;;AACA,QAAMiQ,OAAO,GAAG3W,MAAM,CAAC0J,QAAP,CAAgBC,MAAhB,IAA0BgC,EAAE,CAACY,OAAH,CAAWqK,MAAX,CAAkB7W,YAA5D;AACA,QAAM8W,QAAQ,GAAG,CAACP,oBAAoB,EAArB,IAA2B3K,EAAE,CAACY,OAAH,CAAWuK,wBAAX,CAAoC/W,YAAhF;AACA,MAAI,CAAC4W,OAAO,IAAIE,QAAZ,KAAyB,CAAC7V,KAAK,CAACC,QAApC,EAA8C8V,QAAQ;;AAEtD,MAAIrL,QAAQ,CAACsL,gBAAb,EAA+B;AAC7BhX,IAAAA,MAAM,CAACyL,UAAP,CAAkByH,QAAlB,CAA2B+D,kBAA3B,IAAiDvL,QAAQ,CAACnK,SAAT,GAAqBqO,QAArB,GAAiCA,QAAQ,GAAG,GAA7F;;AACA,QAAI5P,MAAM,CAACyL,UAAP,CAAkByH,QAAlB,CAA2B+D,kBAA3B,IAAiDlM,QAAQ,CAACmM,SAAT,CAAmB,CAAnB,EAAsBC,iBAA3E,EAA8F;AAC5FC,MAAAA,gBAAgB,CAACC,aAAjB,CAA+BC,YAA/B;AACA5L,MAAAA,QAAQ,CAAC6L,MAAT,CAAgBC,UAAhB,CAA2BC,IAA3B;AACD;AACF;;AAEDC,EAAAA,kBAAkB,CAAC9H,QAAQ,GAAGtH,oBAAoB,EAAhC,CAAlB;AACAoM,EAAAA,YAAY,CAACiD,iBAAb,CAA+BvG,IAA/B;AACA3M,EAAAA,CAAC,CAACmT,eAAF;AACAC,EAAAA,gBAAgB,CAAClV,MAAjB,CAAwBiN,QAAQ,GAAGtH,oBAAoB,EAAvD;AACAtH,EAAAA,KAAK,CAACuP,QAAN,CAAeX,QAAf;AACAkI,EAAAA,eAAe,CAACC,IAAhB,CAAqBnI,QAArB;AACAsB,EAAAA,OAAO,CAACX,QAAR,CAAiBX,QAAQ,GAAGtH,oBAAoB,EAAhD;;AAEA,MAAI,CAACoD,QAAQ,CAACsM,UAAd,EAA0B;AACxBtM,IAAAA,QAAQ,CAACuM,YAAT,GAAwB,KAAxB;AACD,GAnN8C,CAqN/C;;;AACA,MAAI/G,OAAO,CAACgH,QAAR,GAAmBC,iBAAiB,CAACC,aAAzC,EAAwD;AACtD,QAAIC,IAAI,CAACnQ,OAAL,CAAaoQ,mBAAjB,EAAsC;AACpC,YAAMC,GAAG,GAAGF,IAAI,CAAC3W,GAAL,CAAS8W,OAAT,GAAmBC,IAAnB,CAAwBC,CAAC,IAAI,CAACA,CAAC,CAACJ,mBAAH,IAA0BI,CAAC,CAACrK,EAAF,KAAS,EAAhE,CAAZ;AACA,UAAIkK,GAAJ,EAASA,GAAG,CAACd,IAAJ,CAAS,IAAT,EAAT,KACK,CAAC,GAAGkB,GAAG,CAACC,UAAJ,CAAeC,OAAnB,EAA4BL,OAA5B,GAAsCC,IAAtC,CAA2CC,CAAC,IAAI,CAACA,CAAC,CAACJ,mBAAnD,EAAwEb,IAAxE,CAA6E,IAA7E;AACN;;AAED,QAAIY,IAAI,CAACnQ,OAAL,CAAa2Q,OAAb,CAAqBJ,IAArB,CAA0BC,CAAC,IAAIA,CAAC,CAACI,MAAjC,EAAyCR,mBAA7C,EAAkE;AAChE,OAAC,GAAGK,GAAG,CAACC,UAAJ,CAAeC,OAAnB,EAA4BL,OAA5B,GAAsCC,IAAtC,CAA2CC,CAAC,IAAI,CAACA,CAAC,CAACJ,mBAAnD,EAAwEb,IAAxE,CAA6E,IAA7E;AACD;AACF;;AAEDpV,EAAAA,QAAQ,CAACC,QAAT,CAAkBC,UAAU,CAACwW,eAA7B;AACArW,EAAAA,MAAM,CAACC,MAAP;AACA3C,EAAAA,MAAM,CAAC6Q,UAAP,GAAoBQ,UAApB;AACAZ,EAAAA,gBAAgB,CAACuI,GAAjB,CAAqB,aAArB;AACD;;AAED,SAAS3D,mBAAT,GAA+B;AAC7B,QAAM4D,YAAY,GAAGrW,oBAAoB,GAAGqG,SAAvB,CAAiCnC,IAAI,CAACP,QAAL,CAAc,MAAd,EAAsB2I,IAAI,CAACgK,oBAAL,CAA0BjO,YAAhD,CAAjC,CAArB;;AACA,MAAIgO,YAAY,CAACE,EAAb,CAAgBnZ,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4B+V,SAA5C,KAA0DC,MAAM,CAACC,SAArE,EAAgF;AAC9EtZ,IAAAA,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4B+V,SAA5B,GAAwCH,YAAxC;AACAjZ,IAAAA,MAAM,CAACoD,OAAP,CAAeC,YAAf,CAA4BkW,YAA5B,GAA2C3W,oBAAoB,EAA/D;AACD;;AAED,QAAM4W,YAAY,GAAG9T,oBAAoB,GAAGuD,SAAvB,CAAiCnC,IAAI,CAACP,QAAL,CAAc,MAAd,EAAsB2I,IAAI,CAACuK,oBAAL,CAA0BxO,YAAhD,CAAjC,CAArB;;AACA,MAAIuO,YAAY,CAACL,EAAb,CAAgBnZ,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4B6T,SAA5C,KAA0DL,MAAM,CAACM,WAArE,EAAkF;AAChF3Z,IAAAA,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4B6T,SAA5B,GAAwCF,YAAxC;AACAxZ,IAAAA,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4B+T,YAA5B,GAA2ClU,oBAAoB,EAA/D;AACD;;AAED,QAAMmU,YAAY,GAAG7V,OAAO,CAAC+H,YAAR,GAAuBjF,IAAI,CAACP,QAAL,CAAc,MAAd,EAAsB2I,IAAI,CAACC,mBAAL,CAAyBlE,YAA/C,CAA5C;;AACA,MAAI4O,YAAY,GAAG7Z,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2BwP,SAA1C,IAAuDC,kBAAkB,EAA7E,EAAiF;AAC/E/Z,IAAAA,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2BwP,SAA3B,GAAuCD,YAAvC;AACA7Z,IAAAA,MAAM,CAACoD,OAAP,CAAekH,WAAf,CAA2B0P,YAA3B,GAA0ChW,OAAO,CAAC+H,YAAlD;AACD;AACF;;AAED,SAAS8H,kBAAT,GAA8B;AAC5B,MAAIoG,cAAc,GAAG,CAArB;;AACA,MAAIvZ,cAAc,CAAC,EAAD,CAAd,CAAmBC,QAAvB,EAAiC;AAC/BsZ,IAAAA,cAAc,GAAGnb,EAAE,CAAC2I,EAAH,CAAMjE,cAAN,CACfzB,WAAW,CAAC,GAAD,CADI,EAEfrB,cAAc,CAAC,CAAD,CAFC,EAGfA,cAAc,CAAC,EAAD,CAHC,CAAjB;AAKAuZ,IAAAA,cAAc,GAAG/W,OAAO,CAACS,KAAR,CAAcsW,cAAd,EAA8B9U,sBAAsB,CAAC,cAAD,CAApD,CAAjB;AACA8U,IAAAA,cAAc,GAAG,IAAI/W,OAAJ,CAAYgM,IAAI,CAACgL,SAAjB,EAA4BvW,KAA5B,CACfT,OAAO,CAACsB,GAAR,CAAYyV,cAAZ,EAA4BlK,eAAe,CAAC1G,QAAhB,CAAyBpD,WAArD,CADe,CAAjB;AAEAjG,IAAAA,MAAM,CAACwL,OAAP,CAAe2O,cAAf,GAAgCna,MAAM,CAACwL,OAAP,CAAe2O,cAAf,CAA8BpU,IAA9B,CAAmCkU,cAAnC,CAAhC;AACA5S,IAAAA,QAAQ,CAAC+B,UAAT,CAAoBgL,GAApB,CAAwBpU,MAAM,CAACwL,OAAP,CAAe2O,cAAf,CAA8BrW,KAA9B,EAAxB;AACA9D,IAAAA,MAAM,CAACwL,OAAP,CAAe2O,cAAf,GAAgCna,MAAM,CAACwL,OAAP,CAAe2O,cAAf,CAA8BC,GAA9B,CAAkCpa,MAAM,CAACwL,OAAP,CAAe2O,cAAf,CAA8BrW,KAA9B,EAAlC,CAAhC;AACD;;AAED,MAAI,CAAC0F,iBAAiB,CAAC,CAAD,CAAjB,CAAqBjI,SAA1B,EAAqC;AACnC,QAAI8Y,MAAM,GAAGvb,EAAE,CAACoK,EAAhB;;AACA,QAAIoR,oBAAoB,CAACC,aAArB,CAAmC5Z,QAAvC,EAAiD;AAC/C;AACA;AACA0Z,MAAAA,MAAM,GAAGA,MAAM,CAACtU,IAAP,CAAY,MAAMmJ,IAAI,CAACsL,WAAX,GAAyB1T,IAAI,CAACP,QAAL,CAAc,EAAd,EAAkBvG,MAAM,CAACoD,OAAP,CAAeqX,YAAf,CAA4BzV,IAA9C,CAArC,CAAT;AACAqV,MAAAA,MAAM,GAAGA,MAAM,CAAC7W,cAAP,CACPR,SAAS,CAAC,EAAD,CADF,EAEPtC,cAAc,CAAC,CAAD,CAFP,EAGPA,cAAc,CAAC,CAAD,CAHP,EAIPqB,WAAW,CAAC,GAAD,CAJJ,EAKP4J,EAAE,CAACY,OAAH,CAAWC,iBAAX,CAA6BH,OAA7B,CAAqCxI,QAL9B,CAAT;AAOAwW,MAAAA,MAAM,GAAGA,MAAM,CAAC1W,KAAP,CAAawB,sBAAsB,CAAC,iBAAD,CAAnC,CAAT;AACD;;AACD,QAAIzE,cAAc,CAAC,EAAD,CAAd,CAAmBC,QAAvB,EAAiC;AAC/B0Z,MAAAA,MAAM,GAAGA,MAAM,CAACtU,IAAP,CAAYrF,cAAc,CAAC,EAAD,CAAd,CAAmBuF,WAAnB,CAA+BtC,KAA/B,CAAqCuL,IAAI,CAACgL,SAA1C,CAAZ,CAAT;AACD;;AACD,QAAIQ,aAAa,CAACrR,QAAd,CAAuB8E,UAA3B,EAAuC;AACrC;AACA;AACA;AACA;AACA;AACAkM,MAAAA,MAAM,GAAGA,MAAM,CAACtU,IAAP,CAAYkG,gBAAgB,GAAGtI,KAAnB,CACnB0D,QAAQ,CAAC+B,UAAT,CAAoB9E,KAApB,CAA0BqW,KAA1B,CAAgCV,cAAc,CAACpX,GAAf,CAAmB,CAAnB,EAAsBiB,KAAtB,EAAhC,CADmB,EAC6CH,KAD7C,CACmDuL,IAAI,CAACgL,SADxD,CAAZ,CAAT;AAED;;AACDG,IAAAA,MAAM,GAAGA,MAAM,CAACtU,IAAP,CAAY/F,MAAM,CAAC4a,cAAnB,CAAT;AACAvT,IAAAA,QAAQ,CAACU,UAAT,CAAoBqM,GAApB,CAAwBiG,MAAM,CAACvW,KAAP,EAAxB;AACA9D,IAAAA,MAAM,CAAC4a,cAAP,GAAwBP,MAAM,CAACM,KAAP,CAAaN,MAAM,CAACvW,KAAP,EAAb,EAA6BoC,QAA7B,EAAxB;AACD;AACF,C,CAED;;;AACA,SAASuQ,oBAAT,GAAgC;AAC9B,MAAI,CAACoE,aAAa,CAAC,CAAD,CAAb,CAAiB1M,UAAlB,IAAgCmG,IAAI,CAACwG,YAAL,CAAkB/a,YAAtD,EAAoE;AAClE,SAAK,IAAIgb,GAAG,GAAG,CAAf,EAAkBA,GAAG,IAAI,CAAzB,EAA4B,EAAEA,GAA9B,EAAmC/X,SAAS,CAACgY,aAAV,CAAwBD,GAAxB,EAA6BvE,QAA7B;AACpC;;AACD,MAAIlC,IAAI,CAAC2G,mBAAL,CAAyBlb,YAA7B,EAA2Cmb,kBAAkB,CAACC,eAAe,CAACC,WAAhB,CAA4B/M,EAA7B,CAAlB;AAC3C,MAAIiG,IAAI,CAAC+G,iBAAL,CAAuBtb,YAA3B,EAAyCiD,SAAS,CAACwI,OAAV,CAAkBgL,QAAlB,CAA2B,IAA3B;AACzC8E,EAAAA,QAAQ;AACT;;AAED,SAAS5D,kBAAT,CAA4B9H,QAA5B,EAAsC;AACpC,QAAM2L,WAAW,GAAGvb,MAAM,CAACyL,UAAP,CAAkB+P,OAAtC;AACA,MAAI,CAAC9W,OAAO,CAACnD,SAAb,EAAwB;;AACxB,MAAIga,WAAW,CAACE,OAAZ,IAAuB,CAA3B,EAA8B;AAC5BF,IAAAA,WAAW,CAACE,OAAZ,IAAwB7L,QAAQ,GAAG,IAAZ,GAAoBlL,OAAO,CAACgX,oBAAnD;AACD,GALmC,CAOpC;;;AACA,MAAIH,WAAW,CAACE,OAAZ,IAAuB,CAA3B,EAA8B;AAC5B,QAAIE,cAAc,GAAI,kDAAiDzM,IAAI,CAACC,mBAAL,CAAyByM,aAAzB,EAAyC,GAAhH;AACAL,IAAAA,WAAW,CAACE,OAAZ,GAAsB,CAAC,CAAvB;AACA,UAAMI,OAAO,GAAG;AACdC,MAAAA,iBAAiB,EAAEP,WAAW,CAACO,iBADjB;AAEdC,MAAAA,cAAc,EAAER,WAAW,CAACQ,cAFd;AAGdC,MAAAA,aAAa,EAAEtX,OAAO,CAACsX;AAHT,KAAhB;AAKAT,IAAAA,WAAW,CAACU,cAAZ,GAA6B/M,IAAI,CAACC,mBAAL,CAAyBgF,YAAtD;AACAoH,IAAAA,WAAW,CAACO,iBAAZ,GAAgChV,IAAI,CAAC/D,GAAL,CAASwY,WAAW,CAACU,cAArB,EAAqCV,WAAW,CAACO,iBAAjD,CAAhC;AACAI,IAAAA,kBAAkB;;AAClB,QAAIhN,IAAI,CAACC,mBAAL,CAAyBgF,YAAzB,GAAwC,EAA5C,EAAgD;AAC9CoH,MAAAA,WAAW,CAACQ,cAAZ;AACAR,MAAAA,WAAW,CAACO,iBAAZ,GAAgC,GAAhC;AACAH,MAAAA,cAAc,IAAIQ,eAAe,CAACzX,OAAO,CAAC0X,mBAAR,GAA8B,CAA/B,CAAjC;;AACA,WAAK,MAAMC,KAAX,IAAoB3X,OAAO,CAAC6S,MAAR,CAAe7V,GAAnC,EAAwC;AACtC,YAAI2a,KAAK,CAACC,WAAV,EAAuB;AACrBD,UAAAA,KAAK,CAAC5E,IAAN;AACD;AACF;AACF;;AACD,QAAI/S,OAAO,CAACsX,aAAR,GAAwBH,OAAO,CAACG,aAApC,EAAmD;AACjDL,MAAAA,cAAc,IAAK,mCAAkCY,OAAO,CAACV,OAAO,CAACG,aAAT,EAAwB,CAAxB,EAA2B,CAA3B,CAA8B;AAChG,UAAUO,OAAO,CAAC7X,OAAO,CAACsX,aAAT,EAAwB,CAAxB,EAA2B,CAA3B,CAA8B,EADzC;;AAEA,UAAIH,OAAO,CAACC,iBAAR,KAA8B,IAA9B,IAAsCD,OAAO,CAACC,iBAAR,KAA8B,GAA9B,IAAqCD,OAAO,CAACE,cAAR,GAAyB,CAAxG,EAA2G;AACzG,YAAI7M,IAAI,CAACC,mBAAL,CAAyBgF,YAAzB,GAAwC,EAA5C,EAAgD;AAC9C;AACAwH,UAAAA,cAAc,IAAK;AAC7B,0CAA0C/R,SAAS,CAAC,IAAIiS,OAAO,CAACE,cAAb,CAA6B;AAChF,YAAYnS,SAAS,CAAC,IAAI2R,WAAW,CAACQ,cAAjB,CAAiC,EAF5C;AAGD,SALD,MAKO;AACL;AACAJ,UAAAA,cAAc,IAAK;AAC7B,cAAc5Q,QAAQ,CAACyR,WAAT,CAAqBjB,WAAW,CAACO,iBAAjC,EAAoDF,aAApD,EAAoE;AAClF,4CAA4ChS,SAAS,CAAC,IAAI2R,WAAW,CAACQ,cAAjB,CAAiC,EAF5E;AAGD;AACF,OAZD,MAYO,IAAI7M,IAAI,CAACC,mBAAL,CAAyBgF,YAAzB,GAAwC,EAA5C,EAAgD;AACrD;AACAwH,QAAAA,cAAc,IAAK,6BAA4B5Q,QAAQ,CAACyR,WAAT,CAAqBX,OAAO,CAACC,iBAA7B,EAAgDF,aAAhD,EAAgE;AACvH;AACA,0CAA0ChS,SAAS,CAAC,IAAIiS,OAAO,CAACE,cAAb,CAA6B;AAChF,YAAYnS,SAAS,CAAC,IAAI2R,WAAW,CAACQ,cAAjB,CAAiC,EAH9C;AAID,OANM,MAMA;AACL;AACAJ,QAAAA,cAAc,IAAK,6BAA4B5Q,QAAQ,CAACyR,WAAT,CAAqBX,OAAO,CAACC,iBAA7B,EAAgDF,aAAhD,EAAgE;AACvH,YAAY7Q,QAAQ,CAACyR,WAAT,CAAqBjB,WAAW,CAACO,iBAAjC,EAAoDF,aAApD,EAAoE;AAChF,wCAAwChS,SAAS,CAAC,IAAIiS,OAAO,CAACE,cAAb,CAA6B,EAFtE;AAGD;;AACD/b,MAAAA,MAAM,CAACoD,OAAP,CAAeqZ,WAAf,CAA2BC,UAA3B,GAAwCC,MAAM,CAACC,cAAP,CAAsBD,MAAM,CAAChT,MAAP,CAAc1J,MAAd,CAAqB4c,CAAC,IAAIA,CAAC,KAAK,IAAhC,CAAtB,CAAxC;AACD,KA5BD,MA4BO;AACLlB,MAAAA,cAAc,IAAK;AACzB,UAAU5Q,QAAQ,CAACyR,WAAT,CAAqBjB,WAAW,CAACO,iBAAjC,EAAoDF,aAApD,EAAoE,8BADxE;AAED;;AACD,QAAIlX,OAAO,CAACoY,mBAAZ,EAAiC7d,kBAAkB,CAAC,EAAD,CAAlB,CAAuB8d,WAAvB;AACjCC,IAAAA,KAAK,CAACC,OAAN,CAAcxF,IAAd,CAAmBkE,cAAnB,EAAmC,EAAnC,EAAuC,CAAvC;AACD;AACF;;AAED,SAASQ,eAAT,CAAyBe,WAAzB,EAAsC;AACpC,UAAQA,WAAR;AACE,SAAK,CAAL;AAAQ,aAAQ;AACpB;AACA,+EAA+EX,OAAO,CAAC,CAAD,CAAI,uBAF9E;;AAGR,SAAK,CAAL;AAAQ,aAAQ;AACpB,4CAA4C3S,SAAS,CAAC,GAAD,CAAM;AAC3D,wEAAwE2S,OAAO,CAAC,CAAD,CAAI,uBAFvE;;AAGR,SAAK,CAAL;AAAQ,aAAQ;AACpB,8CAA8C3S,SAAS,CAAC,GAAD,CAAM,8BADjD;;AAER,SAAK,CAAL;AAAQ,aAAQ;AACpB,8CAA8CA,SAAS,CAAC,GAAD,CAAM;AAC7D,mFAAmFA,SAAS,CAAC,EAAD,CAAK,iBAFrF;;AAGR;AAAS,aAAQ;AACrB,UAAUsT,WAAY;AACtB,UAAUtT,SAAS,CAAC,GAAD,CAAM,8BAFZ;AAZX;AAgBD,C,CAED;;;AACA,SAASkK,iBAAT,CAA2B1C,IAA3B,EAAiC;AAC/B/J,EAAAA,QAAQ,CAAC8V,cAAT,CAAwB/I,GAAxB,CAA4BpR,SAAS,CAAC,GAAD,CAAT,CAAe0L,eAAf,CAA+B,CAA/B,CAA5B;;AAEA,MAAI0O,aAAa,CAACC,KAAd,CAAoBtd,YAAxB,EAAsC;AACpCsH,IAAAA,QAAQ,CAACiW,cAAT,CAAwBlJ,GAAxB,CAA4BpU,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4B6T,SAA5B,CAAsC/V,KAAtC,CAA4C7E,EAAE,CAACsI,KAA/C,EACzBzD,KADyB,CACnB6J,oBAAoB,KAAK4D,IAAzB,GAAgC,IADb,EACmBnM,aADnB,CACiC0G,EAAE,CAACY,OAAH,CAAWC,iBAAX,CAA6BH,OAA7B,CAAqCkR,YADtE,CAA5B;AAED;;AAED,MAAIC,eAAe,CAACC,KAAhB,CAAsBC,SAA1B,EAAqC;AACnC,UAAMC,OAAO,GAAGC,cAAc,CAACC,qBAAf,CACbra,cADa,CACEga,eAAe,CAACC,KAAhB,CAAsBK,aADxB,EAEbna,KAFa,CAEPyN,IAAI,GAAG,IAFA,CAAhB;AAGA/J,IAAAA,QAAQ,CAAC0W,eAAT,CAAyB3J,GAAzB,CAA6BuJ,OAA7B;AACD;;AAED,MAAIla,UAAU,CAACua,KAAX,CAAiB9Y,UAAjB,CAA4B,CAA5B,EAA+BnF,YAAnC,EAAiD;AAC/CsH,IAAAA,QAAQ,CAACiW,cAAT,CAAwBlJ,GAAxB,CAA4B1O,oBAAoB,GAAG/B,KAAvB,CAA6B7E,EAAE,CAACmf,IAAhC,EAAsCta,KAAtC,CAA4CyN,IAAI,GAAG,IAAnD,CAA5B;AACD;AACF;;AAED,SAAS2C,uBAAT,CAAiC3C,IAAjC,EAAuC;AACrCwM,EAAAA,cAAc,CAACM,WAAf;AACA7W,EAAAA,QAAQ,CAAC8W,iBAAT,CAA2B/J,GAA3B,CAA+BwJ,cAAc,CAACQ,uBAAf,CAAuChN,IAAvC,CAA/B;AACD;;AAED,SAAS0E,qBAAT,GAAiC;AAC/B,QAAMuI,iBAAiB,GAAGvb,OAAO,CAACqJ,GAAR,CAAY,CAAZ,EAAegP,eAAe,CAACmD,cAA/B,CAA1B;AACA,QAAMC,sBAAsB,GAAG,IAA/B;AACA,QAAMC,aAAa,GAAGC,oBAAoB,EAA1C;AACAze,EAAAA,MAAM,CAAC0J,QAAP,CAAgBgV,mBAAhB,GAAsC5X,IAAI,CAACqF,GAAL,CAASnM,MAAM,CAAC0J,QAAP,CAAgBgV,mBAAzB,EACpC,IAAI5X,IAAI,CAAChD,KAAL,CAAWZ,OAAO,CAACmD,GAAR,CAAYgB,QAAQ,CAACuO,WAAT,CAAqBtR,KAArB,CAA2B2E,SAA3B,CAAqC,IAArC,CAAZ,EAAwDuV,aAAxD,CAAX,CADgC,CAAtC;AAEAxe,EAAAA,MAAM,CAAC0J,QAAP,CAAgBiV,aAAhB,GAAgC7f,EAAE,CAAC8f,EAAH,CAAMjb,KAAN,CAAY,IAAIT,OAAJ,CAAYsb,aAAZ,EACzCha,GADyC,CACrCxE,MAAM,CAAC0J,QAAP,CAAgBgV,mBADqB,CAAZ,CAAhC;AAEA1e,EAAAA,MAAM,CAAC0J,QAAP,CAAgBmV,oBAAhB,GACE/X,IAAI,CAAC/D,GAAL,CAAS/C,MAAM,CAAC0J,QAAP,CAAgBgV,mBAAhB,GAAsCL,iBAA/C,EAAkEE,sBAAlE,IACAzX,IAAI,CAACqF,GAAL,CAASnM,MAAM,CAAC0J,QAAP,CAAgBgV,mBAAhB,GAAsCL,iBAAtC,GAA0DE,sBAAnE,EAA2F,CAA3F,IAAgGF,iBAFlG;AAIAre,EAAAA,MAAM,CAAC0J,QAAP,CAAgBmV,oBAAhB,IAAwC1D,eAAe,CAAC2D,gBAAhB,CAAiC7Y,WAAzE;AACD;;AAED,OAAO,SAAS+P,cAAT,GAA0B;AAC/B;AACA,MAAI+I,MAAM,GAAGjc,OAAO,CAACkc,OAAR,CACXrT,EAAE,CAACY,OAAH,CAAWC,iBAAX,CAA6BH,OAA7B,CAAqC4S,KAD1B,EAEXtT,EAAE,CAACY,OAAH,CAAW2S,iBAFA,EAGXnd,WAAW,CAAC,GAAD,CAHA,EAIXA,WAAW,CAAC,GAAD,CAJA,CAAb;AAMA,MAAI6C,eAAe,CAACC,OAAhB,CAAwB,UAAxB,CAAJ,EAAyCka,MAAM,IAAIja,uBAAuB,CAAC,eAAD,CAAjC,CARV,CAU/B;;AACA,QAAMqa,OAAO,GAAG5a,MAAM,CAAChD,SAAP,IAAoBmK,QAAQ,CAACnK,SAA7B,IAA0CP,KAAK,CAACC,QAAhD,GACZ,CADY,GAEZkE,sBAAsB,CAAC,eAAD,CAAtB,GAA0C4Z,MAF9C,CAX+B,CAe/B;;AACA,QAAMK,UAAU,GAAGjE,eAAe,CAACC,WAAhB,CAA4Bza,QAA5B,GACfwa,eAAe,CAACC,WAAhB,CAA4BnV,WAA5B,CAAwCtC,KAAxC,CAA8C3C,KAAK,CAACC,QAAN,GAAiB,CAAjB,GAAqB8d,MAAnE,CADe,GAEfjgB,EAAE,CAACoK,EAFP,CAhB+B,CAoB/B;;AACA,MAAImW,OAAO,GAAGD,UAAU,CAAChL,GAAX,CAAe+K,OAAf,CAAd;;AACA,MAAIE,OAAO,CAAClG,EAAR,CAAW,CAAX,CAAJ,EAAmB;AACjBkG,IAAAA,OAAO,GAAGA,OAAO,CAAC7a,GAAR,CAAYkI,oBAAoB,CAAC4S,6BAArB,CAAmD5Q,eAAnD,CAAmE,CAAnE,CAAZ,CAAV;AACD;;AAED,SAAO2Q,OAAP;AACD,C,CAED;;AACA,SAASE,gBAAT,CAA0BC,EAA1B,EAA8BC,UAA9B,EAA0CC,KAA1C,EAAiD;AAC/CF,EAAAA,EAAE,CAACC,UAAD,CAAF;AACA,MAAIA,UAAU,KAAK,CAAnB,EAAsBC,KAAK,GAA3B,KACKC,UAAU,CAAC,MAAMJ,gBAAgB,CAACC,EAAD,EAAKC,UAAU,GAAG,CAAlB,EAAqBC,KAArB,CAAvB,EAAoD,CAApD,CAAV;AACN;;AAED,SAASE,eAAT,CAAyBC,OAAzB,EAAkCC,YAAlC,EAAgD;AAC9C,MAAID,OAAO,GAAG,GAAd,EAAmB;AACjB,UAAME,WAAW,GAAGhhB,YAAY,CAAC,CAAC,EAAD,EAAKiB,MAAL,CAAD,CAAhC;AACAgd,IAAAA,KAAK,CAACgD,YAAN,CAAmBvI,IAAnB,CAAwB;AAAEqI,MAAAA,YAAF;AAAgBC,MAAAA,WAAhB;AAA6BF,MAAAA;AAA7B,KAAxB;AACD;;AAEDnd,EAAAA,MAAM,CAACud,MAAP,CAAcC,cAAd,GAA+B,IAA/B;AACD;;AAED,OAAO,SAASvO,YAAT,CAAsBkO,OAAtB,EAA+BM,IAA/B,EAAqCC,IAArC,EAA2C;AAAA;;AAChDP,EAAAA,OAAO,IAAIvX,oBAAoB,EAA/B,CADgD,CAEhD;AACA;AACA;AACA;AACA;AACA;;AACA,MAAIuX,OAAO,GAAG,CAAd,EAAiB;AACjB,MAAIQ,KAAK,GAAGvZ,IAAI,CAAChD,KAAL,CAAW+b,OAAO,GAAGvX,oBAAoB,EAA9B,GAAmC,EAA9C,CAAZ;AACA5F,EAAAA,MAAM,CAACud,MAAP,CAAcC,cAAd,GAA+B,KAA/B,CAVgD,CAYhD;;AACA,QAAMI,QAAQ,GAAGzT,WAAW,CAAC0T,eAAZ,CAA4B,OAAOV,OAAP,GAAiBvX,oBAAoB,EAAjE,2BAAqEuE,WAAW,CAAC2T,YAAjF,yEAAiGxgB,MAAM,CAACyK,OAAP,CAAe+V,YAAhH,CAAjB;;AACA,MAAIH,KAAK,GAAGC,QAAR,IAAoB,CAACF,IAAzB,EAA+B;AAC7BC,IAAAA,KAAK,GAAGC,QAAR;AACD,GAFD,MAEO,IAAID,KAAK,GAAG,EAAR,IAAc,CAACF,IAAf,IAAuBC,IAA3B,EAAiC;AACtCC,IAAAA,KAAK,GAAG,EAAR;AACD;;AAED,QAAMI,WAAW,GAAG1hB,YAAY,CAAC,CAAC,EAAD,EAAKiB,MAAL,CAAD,CAAhC;AAEA,MAAI0gB,aAAJ;;AAEA,MAAI7S,UAAU,CAAC8S,WAAX,IAA0B,CAAC9S,UAAU,CAACG,SAA1C,EAAqD;AACnD0S,IAAAA,aAAa,GAAG7S,UAAU,CAAC+S,6BAAX,CAAyCf,OAAzC,EAAkDhS,UAAU,CAACgT,iBAAX,EAAlD,CAAhB;AACD,GAFD,MAEO;AACLH,IAAAA,aAAa,GAAGlT,oBAAoB,KAAKqS,OAAzC;AACD;;AAED,QAAMiB,mBAAmB,GAAGlY,4BAA4B,CAAC8X,aAAa,GAAG,IAAjB,CAAxD;AACA,QAAMK,mBAAmB,GAAG3W,4BAA4B,CAACsW,aAAa,GAAG,IAAjB,CAAxD;;AAEA,MAAIK,mBAAmB,CAAC5H,EAApB,CAAuB,CAAvB,CAAJ,EAA+B;AAC7B9R,IAAAA,QAAQ,CAAC+B,UAAT,CAAoBgL,GAApB,CAAwB2M,mBAAxB;AACD,GAFD,MAEO,IAAID,mBAAmB,CAAC3H,EAApB,CAAuB,CAAvB,CAAJ,EAA+B;AACpC9R,IAAAA,QAAQ,CAACU,UAAT,CAAoBqM,GAApB,CAAwB0M,mBAAxB;AACD,GAFM,MAEA;AACLzZ,IAAAA,QAAQ,CAACiW,cAAT,CAAwBlJ,GAAxB,CAA4BzJ,gBAAgB,CAACkV,OAAO,GAAG,IAAX,CAA5C;AACD;;AAED,MAAIrC,eAAe,CAACwD,SAAhB,CAA0BrgB,QAA1B,IAAsCX,MAAM,CAACyK,OAAP,CAAeC,eAAzD,EAA0E;AACxErD,IAAAA,QAAQ,CAAC8V,cAAT,CAAwB/I,GAAxB,CAA4BpU,MAAM,CAACoD,OAAP,CAAeyC,YAAf,CAA4Bob,qBAA5B,CAAkDtd,KAAlD,CAAwDkc,OAAO,GAAG,IAAV,GAAiB,CAAzE,CAA5B;AACD;;AAEDxd,EAAAA,QAAQ,CAACC,QAAT,CAAkBC,UAAU,CAAC2e,uBAA7B;AAEA,MAAIC,oBAAoB,GAAGtB,OAAO,GAAGvX,oBAAoB,EAAzD,CA/CgD,CAgDhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,MAAI8Y,MAAM,GAAGC,CAAC,IAAI;AAChB,UAAMjQ,IAAI,GAAG+P,oBAAoB,GAAGE,CAApC;AACA9Q,IAAAA,QAAQ,CAAC,OAAOa,IAAR,CAAR;AACA+P,IAAAA,oBAAoB,IAAI/P,IAAxB;AACD,GAJD,CA1DgD,CAgEhD;AACA;AACA;AACA;;;AACA,MAAIvD,UAAU,CAAC8S,WAAX,IAA0B,CAAC9S,UAAU,CAACG,SAA1C,EAAqD;AACnDoT,IAAAA,MAAM,GAAGC,CAAC,IAAI;AACZ,YAAM,CAACC,YAAD,EAAe3O,gBAAf,IAAmC9E,UAAU,CAAC0T,oBAAX,CAAgCJ,oBAAhC,EACvCE,CADuC,EACpC,MADoC,CAAzC;AAEAF,MAAAA,oBAAoB,IAAIG,YAAxB;AACA/Q,MAAAA,QAAQ,CAAC,OAAO+Q,YAAR,EAAsB;AAAE3O,QAAAA;AAAF,OAAtB,CAAR;AACD,KALD;AAMD,GA3E+C,CA6EhD;;;AACA,MAAIyN,IAAJ,EAAU;AACR;AACA;AACA;AACA3O,IAAAA,aAAa,CAACC,IAAd,GAJQ,CAKR;AACA;AACA;;AACA,SAAK,IAAI8P,SAAS,GAAG,EAArB,EAAyBA,SAAS,GAAG,CAArC,EAAwCA,SAAS,EAAjD,EAAqD;AACnDJ,MAAAA,MAAM,CAACI,SAAD,CAAN;AACD;;AACD3U,IAAAA,WAAW,CAAC4U,aAAZ;AACA7B,IAAAA,eAAe,CAACC,OAAD,EAAUY,WAAV,CAAf;AACD,GAbD,MAaO;AACL,UAAMiB,QAAQ,GAAG,EAAjB;AACAC,IAAAA,EAAE,CAACC,IAAH,CAAQC,KAAR,CAAcC,WAAd,GAA4B,EAA5B;AACAC,IAAAA,KAAK,CAACC,GAAN,CAAUZ,MAAV,EACEf,KADF,EAEE;AACE4B,MAAAA,SAAS,EAAE,CADb;AAEEC,MAAAA,OAAO,EAAE,EAFX;AAGEC,MAAAA,SAAS,EAAE,CAHb;AAIEC,MAAAA,UAAU,EAAEC,SAAS,IAAI;AACvB5Q,QAAAA,aAAa,CAACC,IAAd;AACAiQ,QAAAA,EAAE,CAACW,UAAH,CAAcT,KAAd,CAAoBC,WAApB,GAAkC;AAChCS,UAAAA,KAAK,EAAE,6BADyB;AAEhCC,UAAAA,IAAI,EAAE,MAAO;AACzB;AACA;AACA,4FAA4F5Y,SAAS,CAAC,GAAD,CAAM;AAC3G,iGAAiGA,SAAS,CAAC,EAAD,CAAK;AAC/G,qBAP4C;AAQhC6Y,UAAAA,YAAY,EAAE,OARkB;AAShCva,UAAAA,OAAO,EAAEma,SATuB;AAUhClW,UAAAA,GAAG,EAAEkU,KAV2B;AAWhCqC,UAAAA,SAAS,EAAE5R,IAAI,CAACC,GAAL,EAXqB;AAYhC4R,UAAAA,OAAO,EAAE,CAAC;AACRC,YAAAA,IAAI,EAAE,UADE;AAERC,YAAAA,SAAS,EAAE,CAAC3a,OAAD,EAAUiE,GAAV,KAAkBA,GAAG,GAAGjE,OAAN,GAAgB,GAFrC;AAGR4a,YAAAA,KAAK,EAAE,MAAM;AACX,oBAAMC,YAAY,GAAGjc,IAAI,CAACP,QAAL,CAAcO,IAAI,CAAChD,KAAL,CAAW4d,QAAQ,CAACF,SAAT,GAAqB,CAAhC,CAAd,EAAkD,GAAlD,CAArB,CADW,CAEX;AACA;AACA;;AACAE,cAAAA,QAAQ,CAACsB,OAAT,IAAoBtB,QAAQ,CAACF,SAAT,GAAqBuB,YAAzC;AACArB,cAAAA,QAAQ,CAACF,SAAT,GAAqBuB,YAArB,CANW,CAOX;;AACApB,cAAAA,EAAE,CAACW,UAAH,CAAcT,KAAd,CAAoBC,WAApB,CAAgC3V,GAAhC,GAAsCuV,QAAQ,CAACsB,OAA/C;AACD;AAZO,WAAD,EAcT;AACEJ,YAAAA,IAAI,EAAE,MADR;AAEEC,YAAAA,SAAS,EAAE,CAAC3a,OAAD,EAAUiE,GAAV,KAAkBA,GAAG,GAAGjE,OAAN,GAAgB,EAF/C;AAGE4a,YAAAA,KAAK,EAAE,MAAM;AACX;AACA;AACApB,cAAAA,QAAQ,CAACsB,OAAT,IAAoBtB,QAAQ,CAACF,SAAT,GAAqB,EAAzC;AACAE,cAAAA,QAAQ,CAACF,SAAT,GAAqB,EAArB;AACD;AARH,WAdS;AAZuB,SAAlC;AAqCD,OA3CH;AA4CEyB,MAAAA,aAAa,EAAEZ,SAAS,IAAI;AAC1BV,QAAAA,EAAE,CAACW,UAAH,CAAcT,KAAd,CAAoBC,WAApB,CAAgC5Z,OAAhC,GAA0Cma,SAA1C;AACD,OA9CH;AA+CEa,MAAAA,SAAS,EAAE,MAAM;AACfvB,QAAAA,EAAE,CAACW,UAAH,CAAcT,KAAd,CAAoBC,WAApB,GAAkCjgB,SAAlC,CADe,CAEf;;AACAgL,QAAAA,WAAW,CAAC4U,aAAZ;AACD,OAnDH;AAoDE0B,MAAAA,IAAI,EAAE,MAAM;AACVvD,QAAAA,eAAe,CAACC,OAAD,EAAUY,WAAV,CAAf;AACD,OAtDH;AAuDEiB,MAAAA;AAvDF,KAFF;AA2DD;AACF;;AAED0B,MAAM,CAACC,MAAP,GAAgB,YAAW;AACzB,QAAMC,gBAAgB,GAAGC,YAAY,EAArC;AACA7gB,EAAAA,MAAM,CAAC8gB,WAAP,GAAqBF,gBAArB;AACA3B,EAAAA,EAAE,CAACC,IAAH,CAAQ4B,WAAR,GAAsBF,gBAAtB;AACA3D,EAAAA,UAAU,CAAC,MAAM;AACf/gB,IAAAA,eAAe,CAAC6kB,UAAhB;AACAC,IAAAA,QAAQ,CAACC,cAAT,CAAwB,SAAxB,EAAmCC,KAAnC,CAAyCC,OAAzC,GAAmD,MAAnD;AACD,GAHS,EAGP,GAHO,CAAV;;AAIA,MAAI,CAACP,gBAAL,EAAuB;AACrB7R,IAAAA,aAAa,CAACC,IAAd;AACAgS,IAAAA,QAAQ,CAACC,cAAT,CAAwB,SAAxB,EAAmCC,KAAnC,CAAyCC,OAAzC,GAAmD,MAAnD;AACAH,IAAAA,QAAQ,CAACC,cAAT,CAAwB,iBAAxB,EAA2CC,KAA3C,CAAiDC,OAAjD,GAA2D,MAA3D;AACD;AACF,CAbD;;AAeAT,MAAM,CAACU,OAAP,GAAiB,YAAW;AAC1BC,EAAAA,WAAW,CAAC,KAAD,CAAX;AACD,CAFD;;AAIAX,MAAM,CAACY,MAAP,GAAgB,YAAW;AACzBC,EAAAA,YAAY,CAACC,SAAb;AACD,CAFD;;AAIA,OAAO,SAASH,WAAT,CAAqBI,MAArB,EAA6B;AAClCxC,EAAAA,EAAE,CAACC,IAAH,CAAQwC,SAAR,GAAoBD,MAApB;AACD;AAED,OAAO,SAASE,WAAT,CAAqBC,CAArB,EAAwB;AAC7BC,EAAAA,UAAU,CAACC,QAAX,CAAoBC,gBAApB,GAAuCH,CAAvC;AACD;AAED,OAAO,SAASf,YAAT,GAAwB;AAC7B,SAAOpkB,iBAAiB,CAACulB,IAAlB,CAAuBC,SAAS,CAACC,SAAjC,CAAP;AACD;AAED,OAAO,SAASC,IAAT,GAAgB;AACrB;AACAC,EAAAA,OAAO,CAACze,GAAR,CAAY,6CAAZ;;AACA,MAAIrH,GAAJ,EAAS;AACP;AACA8lB,IAAAA,OAAO,CAACze,GAAR,CAAY,8BAAZ;AACD;;AACDzH,EAAAA,eAAe,CAACmmB,UAAhB;AACAlmB,EAAAA,YAAY,CAACkmB,UAAb;AACA7lB,EAAAA,KAAK,CAAC2lB,IAAN;AACAhY,EAAAA,WAAW,CAACmY,IAAZ;AACA3M,EAAAA,IAAI,CAAC3W,GAAL,CAAS+W,IAAT,CAAcC,CAAC,IAAIA,CAAC,CAACuM,MAAF,CAAS5W,EAAT,KAAgBrO,MAAM,CAACyK,OAAP,CAAeya,WAAlD,EAA+DzN,IAA/D,CAAoE,IAApE;AACArY,EAAAA,QAAQ,CAACylB,IAAT;AACD;AAEDzB,MAAM,CAAC+B,SAAP,GAAmB,CAAnB;AACA,IAAIC,SAAJ;;AACA,SAASC,aAAT,CAAuBrgB,IAAvB,EAA6B;AAC3BsgB,EAAAA,qBAAqB,CAACD,aAAD,CAArB;;AACA,MAAIrgB,IAAI,KAAKnD,SAAT,IAAsBujB,SAAS,KAAKvjB,SAAxC,EAAmD;AACjDujB,IAAAA,SAAS,GAAGpgB,IAAZ;AACA;AACD;;AACD,MAAIugB,KAAK,GAAGvgB,IAAI,GAAGogB,SAAnB;AACAA,EAAAA,SAAS,GAAGpgB,IAAZ;;AACA,MAAIhF,MAAM,CAAC0J,QAAP,CAAgBC,MAApB,EAA4B;AAC1B4b,IAAAA,KAAK,IAAIvkB,KAAK,CAACC,QAAN,GAAiB,GAAjB,GAAuB,EAAhC;AACD;;AACDkkB,EAAAA,SAAS,IAAII,KAAb;AACA5mB,EAAAA,KAAK,CAACgE,MAAN,CAAawiB,SAAb;AACD;;AAEDE,aAAa","sourcesContent":["import TWEEN from \"tween.js\";\r\n\r\nimport { ElectronRuntime, SteamRuntime } from \"@/steam\";\r\n\r\nimport { DC } from \"./core/constants\";\r\nimport { deepmergeAll } from \"@/utility/deepmerge\";\r\nimport { DEV } from \"@/env\";\r\nimport { SpeedrunMilestones } from \"./core/speedrun\";\r\nimport { Cloud } from \"./core/storage\";\r\nimport { supportedBrowsers } from \"./supported-browsers\";\r\n\r\nimport Payments from \"./core/payments\";\r\n\r\nif (GlobalErrorHandler.handled) {\r\n  throw new Error(\"Initialization failed\");\r\n}\r\nGlobalErrorHandler.cleanStart = true;\r\n\r\nexport function playerInfinityUpgradesOnReset() {\r\n\r\n  const infinityUpgrades = new Set(\r\n    [\"timeMult\", \"dimMult\", \"timeMult2\",\r\n      \"skipReset1\", \"skipReset2\", \"unspentBonus\",\r\n      \"27Mult\", \"18Mult\", \"36Mult\", \"resetMult\",\r\n      \"skipReset3\", \"passiveGen\", \"45Mult\",\r\n      \"resetBoost\", \"galaxyBoost\", \"skipResetGalaxy\",\r\n      \"ipOffline\"]\r\n  );\r\n\r\n  const breakInfinityUpgrades = new Set(\r\n    [\"timeMult\", \"dimMult\", \"timeMult2\",\r\n      \"skipReset1\", \"skipReset2\", \"unspentBonus\",\r\n      \"27Mult\", \"18Mult\", \"36Mult\", \"resetMult\",\r\n      \"skipReset3\", \"passiveGen\", \"45Mult\",\r\n      \"resetBoost\", \"galaxyBoost\", \"skipResetGalaxy\",\r\n      \"totalMult\", \"currentMult\", \"postGalaxy\",\r\n      \"challengeMult\", \"achievementMult\", \"infinitiedMult\",\r\n      \"infinitiedGeneration\", \"autoBuyerUpgrade\", \"autobuyMaxDimboosts\",\r\n      \"ipOffline\"]\r\n  );\r\n\r\n  if (PelleUpgrade.keepBreakInfinityUpgrades.canBeApplied) {\r\n    player.infinityUpgrades = new Set([...player.infinityUpgrades].filter(u => breakInfinityUpgrades.has(u)));\r\n    return;\r\n  }\r\n\r\n  if (PelleUpgrade.keepInfinityUpgrades.canBeApplied) {\r\n    player.infinityUpgrades = new Set([...player.infinityUpgrades].filter(u => infinityUpgrades.has(u)));\r\n    player.infinityRebuyables = [0, 0, 0];\r\n    GameCache.tickSpeedMultDecrease.invalidate();\r\n    GameCache.dimensionMultDecrease.invalidate();\r\n    return;\r\n  }\r\n\r\n  if (RealityUpgrade(10).isBought || EternityMilestone.keepBreakUpgrades.isReached) {\r\n    player.infinityUpgrades = breakInfinityUpgrades;\r\n    player.infinityRebuyables = [8, 7, 10];\r\n  } else if (EternityMilestone.keepInfinityUpgrades.isReached) {\r\n    player.infinityUpgrades = infinityUpgrades;\r\n    player.infinityRebuyables = [0, 0, 0];\r\n  } else {\r\n    player.infinityUpgrades.clear();\r\n    player.infinityRebuyables = [0, 0, 0];\r\n  }\r\n\r\n  if (Pelle.isDoomed) {\r\n    player.infinityUpgrades.clear();\r\n    player.infinityRebuyables = [0, 0, 0];\r\n  }\r\n\r\n  GameCache.tickSpeedMultDecrease.invalidate();\r\n  GameCache.dimensionMultDecrease.invalidate();\r\n}\r\n\r\nexport function breakInfinity() {\r\n  if (!Autobuyer.bigCrunch.hasMaxedInterval) return;\r\n  if (InfinityChallenge.isRunning) return;\r\n  for (const autobuyer of Autobuyers.all) {\r\n    if (autobuyer.data.interval !== undefined) autobuyer.maxIntervalForFree();\r\n  }\r\n  // There's a potential migration edge case involving already-maxed autobuyers; this should give the achievement\r\n  Achievement(61).tryUnlock();\r\n  player.break = !player.break;\r\n  TabNotification.ICUnlock.tryTrigger();\r\n  EventHub.dispatch(player.break ? GAME_EVENT.BREAK_INFINITY : GAME_EVENT.FIX_INFINITY);\r\n  GameUI.update();\r\n}\r\n\r\nexport function gainedInfinityPoints() {\r\n  const div = Effects.min(\r\n    308,\r\n    Achievement(103),\r\n    TimeStudy(111)\r\n  );\r\n  if (Pelle.isDisabled(\"IPMults\")) {\r\n    return Decimal.pow10(player.records.thisInfinity.maxAM.log10() / div - 0.75)\r\n      .timesEffectsOf(PelleRifts.vacuum)\r\n      .times(Pelle.specialGlyphEffect.infinity)\r\n      .floor();\r\n  }\r\n  let ip = player.break\r\n    ? Decimal.pow10(player.records.thisInfinity.maxAM.log10() / div - 0.75)\r\n    : new Decimal(308 / div);\r\n  if (Effarig.isRunning && Effarig.currentStage === EFFARIG_STAGES.ETERNITY) {\r\n    ip = ip.min(DC.E200);\r\n  }\r\n  ip = ip.times(GameCache.totalIPMult.value);\r\n  if (Teresa.isRunning) {\r\n    ip = ip.pow(0.55);\r\n  } else if (V.isRunning) {\r\n    ip = ip.pow(0.5);\r\n  } else if (Laitela.isRunning) {\r\n    ip = dilatedValueOf(ip);\r\n  }\r\n  if (GlyphAlteration.isAdded(\"infinity\")) {\r\n    ip = ip.pow(getSecondaryGlyphEffect(\"infinityIP\"));\r\n  }\r\n\r\n  return ip.floor();\r\n}\r\n\r\nfunction totalEPMult() {\r\n  return Pelle.isDisabled(\"EPMults\")\r\n    ? Pelle.specialGlyphEffect.time.timesEffectOf(PelleRifts.vacuum.milestones[2])\r\n    : getAdjustedGlyphEffect(\"cursedEP\")\r\n      .times(ShopPurchase.EPPurchases.currentMult)\r\n      .timesEffectsOf(\r\n        EternityUpgrade.epMult,\r\n        TimeStudy(61),\r\n        TimeStudy(122),\r\n        TimeStudy(121),\r\n        TimeStudy(123),\r\n        RealityUpgrade(12),\r\n        GlyphEffect.epMult\r\n      );\r\n}\r\n\r\nexport function gainedEternityPoints() {\r\n  let ep = DC.D5.pow(player.records.thisEternity.maxIP.plus(\r\n    gainedInfinityPoints()).log10() / (308 - PelleRifts.recursion.effectValue.toNumber()) - 0.7).times(totalEPMult());\r\n\r\n  if (Teresa.isRunning) {\r\n    ep = ep.pow(0.55);\r\n  } else if (V.isRunning) {\r\n    ep = ep.pow(0.5);\r\n  } else if (Laitela.isRunning) {\r\n    ep = dilatedValueOf(ep);\r\n  }\r\n  if (GlyphAlteration.isAdded(\"time\")) {\r\n    ep = ep.pow(getSecondaryGlyphEffect(\"timeEP\"));\r\n  }\r\n\r\n  return ep.floor();\r\n}\r\n\r\nexport function requiredIPForEP(epAmount) {\r\n  return Decimal.pow10(308 * (Decimal.log(Decimal.divide(epAmount, totalEPMult()), 5) + 0.7))\r\n    .clampMin(Number.MAX_VALUE);\r\n}\r\n\r\nexport function gainedGlyphLevel() {\r\n  const glyphState = getGlyphLevelInputs();\r\n  let rawLevel = Math.floor(glyphState.rawLevel);\r\n  if (!isFinite(rawLevel)) rawLevel = 0;\r\n  let actualLevel = Math.floor(glyphState.actualLevel);\r\n  if (!isFinite(actualLevel)) actualLevel = 0;\r\n  return {\r\n    rawLevel,\r\n    actualLevel\r\n  };\r\n}\r\n\r\nexport function resetChallengeStuff() {\r\n  player.chall2Pow = 1;\r\n  player.chall3Pow = DC.D0_01;\r\n  Currency.matter.reset();\r\n  player.chall8TotalSacrifice = DC.D1;\r\n  player.postC4Tier = 1;\r\n}\r\n\r\nexport function ratePerMinute(amount, time) {\r\n  return Decimal.divide(amount, time / (60 * 1000));\r\n}\r\n\r\n// eslint-disable-next-line max-params\r\nexport function addInfinityTime(time, realTime, ip, infinities) {\r\n  let challenge = \"\";\r\n  if (player.challenge.normal.current) challenge = `Normal Challenge ${player.challenge.normal.current}`;\r\n  if (player.challenge.infinity.current) challenge = `Infinity Challenge ${player.challenge.infinity.current}`;\r\n  player.records.recentInfinities.pop();\r\n  player.records.recentInfinities.unshift([time / getGlobalSpeedFactor(), realTime, ip, infinities, challenge]);\r\n  GameCache.bestRunIPPM.invalidate();\r\n}\r\n\r\nexport function resetInfinityRuns() {\r\n  player.records.recentInfinities = Array.from(\r\n    { length: 10 },\r\n    () => [Number.MAX_VALUE, Number.MAX_VALUE, DC.D1, DC.D1, \"\"]\r\n  );\r\n  GameCache.bestRunIPPM.invalidate();\r\n}\r\n\r\n// Player gains 50% of infinities they would get based on their best infinities/hour crunch if they have the\r\n// milestone and turned on infinity autobuyer with 1 minute or less per crunch\r\nexport function getInfinitiedMilestoneReward(ms, considerMilestoneReached) {\r\n  return Autobuyer.bigCrunch.autoInfinitiesAvailable(considerMilestoneReached)\r\n    ? Decimal.floor(player.records.thisEternity.bestInfinitiesPerMs.times(ms).dividedBy(2))\r\n    : DC.D0;\r\n}\r\n\r\n// eslint-disable-next-line max-params\r\nexport function addEternityTime(time, realTime, ep, eternities) {\r\n  let challenge = \"\";\r\n  if (player.challenge.eternity.current) {\r\n    const currEC = player.challenge.eternity.current;\r\n    const ec = EternityChallenge(currEC);\r\n    const challText = player.dilation.active ? \"Dilated EC\" : \"Eternity Challenge\";\r\n    challenge = `${challText} ${currEC} (${formatInt(ec.completions)}/${formatInt(ec.maxCompletions)})`;\r\n  } else if (player.dilation.active) challenge = \"Time Dilation\";\r\n  // If we call this function outside of dilation, it uses the existing AM and produces an erroneous number\r\n  const gainedTP = player.dilation.active ? getTachyonGain() : DC.D0;\r\n  player.records.recentEternities.pop();\r\n  player.records.recentEternities.unshift([time / getGlobalSpeedFactor(), realTime, ep, eternities, challenge, gainedTP]);\r\n  GameCache.averageRealTimePerEternity.invalidate();\r\n}\r\n\r\nexport function resetEternityRuns() {\r\n  player.records.recentEternities = Array.from(\r\n    { length: 10 },\r\n    () => [Number.MAX_VALUE, Number.MAX_VALUE, DC.D1, DC.D1, \"\", DC.D0]\r\n  );\r\n  GameCache.averageRealTimePerEternity.invalidate();\r\n}\r\n\r\n// Player gains 50% of the eternities they would get if they continuously repeated their fastest eternity, if they\r\n// have the auto-eternity milestone and turned on eternity autobuyer with 0 EP\r\nexport function getEternitiedMilestoneReward(ms, considerMilestoneReached) {\r\n  return Autobuyer.eternity.autoEternitiesAvailable(considerMilestoneReached)\r\n    ? Decimal.floor(player.records.thisReality.bestEternitiesPerMs.times(ms).dividedBy(2))\r\n    : DC.D0;\r\n}\r\n\r\nfunction isOfflineEPGainEnabled() {\r\n  return player.options.offlineProgress && !Autobuyer.bigCrunch.autoInfinitiesAvailable() &&\r\n    !Autobuyer.eternity.autoEternitiesAvailable();\r\n}\r\n\r\nexport function getOfflineEPGain(ms) {\r\n  if (!EternityMilestone.autoEP.isReached || !isOfflineEPGainEnabled()) return DC.D0;\r\n  return player.records.bestEternity.bestEPminReality.times(TimeSpan.fromMilliseconds(ms).totalMinutes / 4);\r\n}\r\n\r\n// Note: realities and ampFactor must be distinct because there are a few things farther up which only multiply\r\n// reality count and none of the other things\r\n// eslint-disable-next-line max-params\r\nexport function addRealityTime(time, realTime, rm, level, realities, ampFactor, projIM) {\r\n  let reality = \"\";\r\n  const celestials = [Teresa, Effarig, Enslaved, V, Ra, Laitela];\r\n  for (const cel of celestials) {\r\n    if (cel.isRunning) reality = cel.displayName;\r\n  }\r\n  const shards = Effarig.shardsGained;\r\n  player.records.recentRealities.pop();\r\n  player.records.recentRealities.unshift([time / getGlobalSpeedFactor(), realTime, rm.times(ampFactor),\r\n    realities, reality, level, shards * ampFactor, projIM]);\r\n}\r\n\r\nexport function gainedInfinities() {\r\n  if (EternityChallenge(4).isRunning || Pelle.isDisabled(\"InfinitiedMults\")) {\r\n    return DC.D1;\r\n  }\r\n  let infGain = Effects.max(\r\n    1,\r\n    Achievement(87)\r\n  ).toDecimal();\r\n\r\n  infGain = infGain.timesEffectsOf(\r\n    TimeStudy(32),\r\n    RealityUpgrade(5),\r\n    RealityUpgrade(7),\r\n    Achievement(131).effects.infinitiesGain,\r\n    Achievement(164),\r\n    Ra.unlocks.continuousTTBoost.effects.infinity\r\n  );\r\n  infGain = infGain.times(getAdjustedGlyphEffect(\"infinityinfmult\"));\r\n  infGain = infGain.powEffectOf(SingularityMilestone.infinitiedPow);\r\n  return infGain;\r\n}\r\n\r\nexport function updateRefresh() {\r\n  GameStorage.save();\r\n  location.reload(true);\r\n}\r\n\r\nexport const GAME_SPEED_EFFECT = {\r\n  FIXED_SPEED: 1,\r\n  TIME_GLYPH: 2,\r\n  BLACK_HOLE: 3,\r\n  TIME_STORAGE: 4,\r\n  SINGULARITY_MILESTONE: 5,\r\n  NERFS: 6\r\n};\r\n\r\n/**\r\n  * @param {number[]?} effectsToConsider A list of various game speed changing effects to apply when calculating\r\n  *   the game speed.  If left undefined, all effects will be applied.\r\n  * @param {number?} blackHolesActiveOverride A numerical value which forces all black holes up to its specified index\r\n  *   to be active for the purposes of game speed calculation. This is only used during offline black hole stuff.\r\n  */\r\nexport function getGameSpeedupFactor(effectsToConsider, blackHolesActiveOverride) {\r\n  let effects;\r\n  if (effectsToConsider === undefined) {\r\n    effects = [GAME_SPEED_EFFECT.FIXED_SPEED, GAME_SPEED_EFFECT.TIME_GLYPH, GAME_SPEED_EFFECT.BLACK_HOLE,\r\n      GAME_SPEED_EFFECT.TIME_STORAGE, GAME_SPEED_EFFECT.SINGULARITY_MILESTONE, GAME_SPEED_EFFECT.NERFS];\r\n  } else {\r\n    effects = effectsToConsider;\r\n  }\r\n\r\n  if (effects.includes(GAME_SPEED_EFFECT.FIXED_SPEED)) {\r\n    if (EternityChallenge(12).isRunning) {\r\n      return 1 / 1000;\r\n    }\r\n  }\r\n\r\n  let factor = 1;\r\n  if (effects.includes(GAME_SPEED_EFFECT.BLACK_HOLE)) {\r\n    if (BlackHoles.areNegative) {\r\n      factor *= player.blackHoleNegative;\r\n    } else if (!BlackHoles.arePaused) {\r\n      for (const blackHole of BlackHoles.list) {\r\n        if (!blackHole.isUnlocked) break;\r\n        const isActive = blackHolesActiveOverride === undefined\r\n          ? blackHole.isActive\r\n          : blackHole.id <= blackHolesActiveOverride;\r\n        if (!isActive) break;\r\n        factor *= Math.pow(blackHole.power, BlackHoles.unpauseAccelerationFactor);\r\n        factor *= VUnlocks.achievementBH.effectOrDefault(1);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (effects.includes(GAME_SPEED_EFFECT.SINGULARITY_MILESTONE)) {\r\n    factor *= SingularityMilestone.gamespeedFromSingularities.effectOrDefault(1);\r\n  }\r\n\r\n  if (effects.includes(GAME_SPEED_EFFECT.TIME_GLYPH)) {\r\n    factor *= getAdjustedGlyphEffect(\"timespeed\");\r\n    factor = Math.pow(factor, getAdjustedGlyphEffect(\"effarigblackhole\"));\r\n  }\r\n\r\n  if (Enslaved.isStoringGameTime && effects.includes(GAME_SPEED_EFFECT.TIME_STORAGE)) {\r\n    const storedTimeWeight = Ra.unlocks.autoPulseTime.canBeApplied ? 0.99 : 1;\r\n    factor = factor * (1 - storedTimeWeight) + storedTimeWeight;\r\n  }\r\n\r\n  // These effects should always be active, but need to be disabled during offline black hole simulations because\r\n  // otherwise it gets applied twice\r\n  if (effects.includes(GAME_SPEED_EFFECT.NERFS)) {\r\n    if (Effarig.isRunning) {\r\n      factor = Effarig.multiplier(factor).toNumber();\r\n    } else if (Laitela.isRunning) {\r\n      const nerfModifier = Math.clampMax(Time.thisRealityRealTime.totalMinutes / 10, 1);\r\n      factor = Math.pow(factor, nerfModifier);\r\n    }\r\n  }\r\n\r\n\r\n  factor *= PelleUpgrade.timeSpeedMult.effectValue.toNumber();\r\n\r\n  // 1e-300 is now possible with max inverted BH, going below it would be possible with\r\n  // an effarig glyph.\r\n  factor = Math.clamp(factor, 1e-300, 1e300);\r\n\r\n  return factor;\r\n}\r\n\r\nexport function getGameSpeedupForDisplay() {\r\n  const speedFactor = getGameSpeedupFactor();\r\n  if (\r\n    Enslaved.isAutoReleasing &&\r\n    Enslaved.canRelease(true) &&\r\n    !BlackHoles.areNegative &&\r\n    !Pelle.isDisabled(\"blackhole\")\r\n  ) {\r\n    return Math.max(Enslaved.autoReleaseSpeed, speedFactor);\r\n  }\r\n  return speedFactor;\r\n}\r\n\r\n// Separated out for organization; however this is also used in more than one spot in gameLoop() as well. Returns\r\n// true if the rest of the game loop should be skipped\r\nexport function realTimeMechanics(realDiff) {\r\n\r\n  // realDiff have calculated getGlobalSpeedFactor() effect.\r\n\r\n  // Ra memory generation bypasses stored real time, but memory chunk generation is disabled when storing real time.\r\n  // This is in order to prevent players from using time inside of Ra's reality for amplification as well\r\n  Ra.memoryTick(realDiff / Math.pow(getGlobalSpeedFactor(),1/2), !Enslaved.isStoringRealTime);\r\n  if (AlchemyResource.momentum.isUnlocked) {\r\n    player.celestials.ra.momentumTime += realDiff * Achievement(175).effectOrDefault(1);\r\n  }\r\n\r\n  DarkMatterDimensions.tick(realDiff / Math.pow(getGlobalSpeedFactor(),1/2));\r\n\r\n  // When storing real time, skip everything else having to do with production once stats are updated\r\n  if (Enslaved.isStoringRealTime) {\r\n\r\n    // Time recording should not be speeded up by getGlobalSpeedFactor().\r\n    realDiff /= getGlobalSpeedFactor();\r\n\r\n    player.records.realTimePlayed += realDiff;\r\n    player.records.thisInfinity.realTime += realDiff;\r\n    player.records.thisEternity.realTime += realDiff;\r\n    player.records.thisReality.realTime += realDiff;\r\n    Enslaved.storeRealTime();\r\n    // Most autobuyers will only tick usefully on the very first tick, but this needs to be here in order to allow\r\n    // the autobuyers unaffected by time storage to tick as well\r\n    Autobuyers.tick();\r\n    GameUI.update();\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n// \"passDiff\" is in ms. It is only unspecified when it's being called normally and not due to simulating time, in which\r\n// case it uses the gap between now and the last time the function was called (capped at a day). This is on average\r\n// equal to the update rate, but may be much larger if the game was unfocused or the device went to sleep for some time.\r\n// eslint-disable-next-line complexity\r\nexport function gameLoop(passDiff, options = {}) {\r\n\r\n  PerformanceStats.start(\"Frame Time\");\r\n  PerformanceStats.start(\"Game Update\");\r\n\r\n  EventHub.dispatch(GAME_EVENT.GAME_TICK_BEFORE);\r\n\r\n  // When you have offline progress on and game paused, and just get back from offline, and resume the game, the game\r\n  // treats all prievous time offline and simulates them. This is unintended so here is a fix.\r\n  if (player.options.gamePaused) player.lastUpdate = Date.now();\r\n\r\n  // In certain cases we want to allow the player to interact with the game's settings and tabs, but prevent any actual\r\n  // resource generation from happening - in these cases, we have to make sure this all comes before the hibernation\r\n  // check or else it'll attempt to run the game anyway\r\n  if (Speedrun.isPausedAtStart() || GameEnd.creditsEverClosed || player.options.gamePaused) {\r\n    GameUI.update();\r\n    return;\r\n  }\r\n\r\n  let diff = passDiff;\r\n  const thisUpdate = Date.now();\r\n  const realDiff = (diff === undefined\r\n    ? Math.clamp(thisUpdate - player.lastUpdate, 1, 8.64e7)\r\n    : diff) * getGlobalSpeedFactor();\r\n  if (!GameStorage.ignoreBackupTimer) player.backupTimer += realDiff / getGlobalSpeedFactor();\r\n\r\n  // For single ticks longer than a minute from the GameInterval loop, we assume that the device has gone to sleep or\r\n  // hibernation - in those cases we stop the interval and simulate time instead. The gameLoop interval automatically\r\n  // restarts itself at the end of the simulateTime call. This will not trigger for an unfocused game, as this seems to\r\n  // result in a ~1 second tick rate for browsers.\r\n  // Note that we have to explicitly call all the real-time mechanics with the existing value of realDiff, because\r\n  // simply letting it run through simulateTime seems to result in it using zero\r\n  if (player.options.hibernationCatchup && passDiff === undefined && realDiff > 6e4 * getGlobalSpeedFactor()) {\r\n    GameIntervals.gameLoop.stop();\r\n    simulateTime(realDiff / 1000 / getGlobalSpeedFactor(), true);\r\n    realTimeMechanics(realDiff);\r\n    return;\r\n  }\r\n\r\n  // Run all the functions which only depend on real time and not game time, skipping the rest of the loop if needed\r\n  if (realTimeMechanics(realDiff)) return;\r\n\r\n  // Ra-Nameless auto-release stored time (once every 5 ticks)\r\n  if (Enslaved.isAutoReleasing) {\r\n    Enslaved.autoReleaseTick++;\r\n  }\r\n  if (Enslaved.autoReleaseTick >= 5) {\r\n    Enslaved.autoReleaseTick = 0;\r\n    Enslaved.useStoredTime(true);\r\n    Enslaved.isReleaseTick = true;\r\n  } else if (!Enslaved.isReleaseTick) {\r\n    Enslaved.nextTickDiff = realDiff;\r\n  }\r\n  if (diff === undefined) {\r\n    diff = Enslaved.nextTickDiff;\r\n  }\r\n  else diff *= getGlobalSpeedFactor();\r\n\r\n  Autobuyers.tick();\r\n  Tutorial.tutorialLoop();\r\n\r\n  if (Achievement(165).isUnlocked && player.celestials.effarig.autoAdjustGlyphWeights) {\r\n    autoAdjustGlyphWeights();\r\n  }\r\n\r\n  // We do these after autobuyers, since it's possible something there might\r\n  // change a multiplier.\r\n  GameCache.antimatterDimensionCommonMultiplier.invalidate();\r\n  GameCache.antimatterDimensionFinalMultipliers.invalidate();\r\n  GameCache.infinityDimensionCommonMultiplier.invalidate();\r\n  GameCache.timeDimensionCommonMultiplier.invalidate();\r\n  GameCache.totalIPMult.invalidate();\r\n\r\n  const blackHoleDiff = realDiff / Math.sqrt(getGlobalSpeedFactor());\r\n  const fixedSpeedActive = EternityChallenge(12).isRunning;\r\n  if (!Enslaved.isReleaseTick && !fixedSpeedActive) {\r\n    let speedFactor;\r\n    if (options.blackHoleSpeedup === undefined) {\r\n      speedFactor = getGameSpeedupFactor();\r\n    } else {\r\n      // This is only called from simulateTime() and is calculated externally in order to avoid weirdness when game\r\n      // speed is directly nerfed\r\n      speedFactor = options.blackHoleSpeedup;\r\n    }\r\n\r\n    if (Enslaved.isStoringGameTime && !fixedSpeedActive) {\r\n      // These variables are the actual game speed used and the game speed unaffected by time storage, respectively\r\n      const reducedTimeFactor = getGameSpeedupFactor();\r\n      const totalTimeFactor = getGameSpeedupFactor([GAME_SPEED_EFFECT.FIXED_SPEED, GAME_SPEED_EFFECT.TIME_GLYPH,\r\n        GAME_SPEED_EFFECT.BLACK_HOLE, GAME_SPEED_EFFECT.SINGULARITY_MILESTONE]);\r\n      const amplification = Ra.unlocks.improvedStoredTime.effects.gameTimeAmplification.effectOrDefault(1);\r\n      const beforeStore = player.celestials.enslaved.stored;\r\n      player.celestials.enslaved.stored = Math.clampMax(player.celestials.enslaved.stored +\r\n        diff * (totalTimeFactor - reducedTimeFactor) * amplification, Enslaved.timeCap);\r\n      Enslaved.currentBlackHoleStoreAmountPerMs = (player.celestials.enslaved.stored - beforeStore) / diff;\r\n      speedFactor = reducedTimeFactor;\r\n    }\r\n    diff *= speedFactor;\r\n  } else if (fixedSpeedActive) {\r\n    diff *= getGameSpeedupFactor();\r\n    Enslaved.currentBlackHoleStoreAmountPerMs = 0;\r\n  }\r\n  player.celestials.ra.peakGamespeed = Math.max(player.celestials.ra.peakGamespeed, getGameSpeedupFactor());\r\n  Enslaved.isReleaseTick = false;\r\n\r\n  // These need to all be done consecutively in order to minimize the chance of a reset occurring between real time\r\n  // updating and game time updating. This is only particularly noticeable when game speed is 1 and the player\r\n  // expects to see identical numbers. We also don't increment the timers if the game has been beaten (Achievement 188)\r\n  if (!Achievement(188).isUnlocked) {\r\n    player.records.realTimeDoomed += realDiff / getGlobalSpeedFactor();\r\n    player.records.realTimePlayed += realDiff / getGlobalSpeedFactor();\r\n    player.records.totalTimePlayed += diff;\r\n    player.records.thisInfinity.realTime += realDiff / getGlobalSpeedFactor();\r\n    player.records.thisInfinity.time += diff;\r\n    player.records.thisEternity.realTime += realDiff / getGlobalSpeedFactor();\r\n    if (Enslaved.isRunning && Enslaved.feltEternity && !EternityChallenge(12).isRunning) {\r\n      player.records.thisEternity.time += diff * (1 + Currency.eternities.value.clampMax(1e66).toNumber());\r\n    } else {\r\n      player.records.thisEternity.time += diff;\r\n    }\r\n    player.records.thisReality.realTime += realDiff / getGlobalSpeedFactor();\r\n    player.records.thisReality.time += diff;\r\n  }\r\n\r\n  DeltaTimeState.update(realDiff, diff);\r\n\r\n  updateNormalAndInfinityChallenges(diff);\r\n\r\n  // IP generation is broken into a couple of places in gameLoop; changing that might change the\r\n  // behavior of eternity farming.\r\n  preProductionGenerateIP(diff);\r\n\r\n  if (!Pelle.isDoomed) {\r\n    passivePrestigeGen();\r\n  }\r\n\r\n\r\n  applyAutoprestige(realDiff / getGlobalSpeedFactor());\r\n  updateImaginaryMachines(realDiff);\r\n\r\n  const uncountabilityGain = AlchemyResource.uncountability.effectValue * Time.unscaledDeltaTime.totalSeconds;\r\n  Currency.realities.add(uncountabilityGain);\r\n  Currency.perkPoints.add(uncountabilityGain);\r\n\r\n  if (Perk.autocompleteEC1.canBeApplied) player.reality.lastAutoEC += realDiff;\r\n\r\n  EternityChallenge(12).tryFail();\r\n  Achievements._power.invalidate();\r\n\r\n  TimeDimensions.tick(diff);\r\n  InfinityDimensions.tick(diff);\r\n  AntimatterDimensions.tick(diff);\r\n\r\n  const gain = Math.clampMin(FreeTickspeed.fromShards(Currency.timeShards.value).newAmount - player.totalTickGained, 0);\r\n  player.totalTickGained += gain;\r\n\r\n  updatePrestigeRates();\r\n  tryCompleteInfinityChallenges();\r\n\r\n  EternityChallenges.autoComplete.tick();\r\n\r\n  replicantiLoop(diff);\r\n\r\n  if (PlayerProgress.dilationUnlocked()) {\r\n    Currency.dilatedTime.add(getDilationGainPerSecond().times(diff / 1000));\r\n  }\r\n\r\n  updateTachyonGalaxies();\r\n  Currency.timeTheorems.add(getTTPerSecond().times(diff / 1000));\r\n  InfinityDimensions.tryAutoUnlock();\r\n\r\n  BlackHoles.updatePhases(blackHoleDiff);\r\n\r\n  // Unlocks dilation at a certain total TT count for free, but we add the cost first in order to make\r\n  // sure that TT count doesn't go negative and that we can actually buy it. This technically bumps the max theorem\r\n  // amount up as well, but at this point of the game 5k TT is insignificant to basically all other sources of TT.\r\n  if (Ra.unlocks.autoUnlockDilation.canBeApplied &&\r\n    Currency.timeTheorems.max.gte(TimeStudy.dilation.totalTimeTheoremRequirement) &&\r\n    !isInCelestialReality() &&\r\n    !Pelle.isDoomed) {\r\n    Currency.timeTheorems.add(TimeStudy.dilation.cost);\r\n    TimeStudy.dilation.purchase(true);\r\n  }\r\n\r\n  applyAutoUnlockPerks();\r\n  if (GlyphSelection.active) GlyphSelection.update(gainedGlyphLevel());\r\n\r\n  // There are some external checks which prevent excessive resource gain with Teresa-25; it may give TP outside of\r\n  // dilation, but the TP gain function is also coded to behave differently if it's active\r\n  const teresa1 = player.dilation.active && Ra.unlocks.autoTP.canBeApplied;\r\n  const teresa25 = !isInCelestialReality() && Ra.unlocks.unlockDilationStartingTP.canBeApplied;\r\n  if ((teresa1 || teresa25) && !Pelle.isDoomed) rewardTP();\r\n\r\n  if (Enslaved.canTickHintTimer) {\r\n    player.celestials.enslaved.hintUnlockProgress += Enslaved.isRunning ? realDiff : (realDiff * 0.4);\r\n    if (player.celestials.enslaved.hintUnlockProgress >= TimeSpan.fromHours(5).totalMilliseconds) {\r\n      EnslavedProgress.hintsUnlocked.giveProgress();\r\n      Enslaved.quotes.hintUnlock.show();\r\n    }\r\n  }\r\n\r\n  laitelaRealityTick(realDiff / getGlobalSpeedFactor());\r\n  Achievements.autoAchieveUpdate(diff);\r\n  V.checkForUnlocks();\r\n  AutomatorBackend.update(realDiff / getGlobalSpeedFactor());\r\n  Pelle.gameLoop(realDiff);\r\n  GalaxyGenerator.loop(realDiff);\r\n  GameEnd.gameLoop(realDiff / getGlobalSpeedFactor());\r\n\r\n  if (!Enslaved.canAmplify) {\r\n    Enslaved.boostReality = false;\r\n  }\r\n\r\n  // Stopping these checks after CREDITS_START reduces lag and allows for the glyph customization modal to appear\r\n  if (GameEnd.endState < END_STATE_MARKERS.CREDITS_START) {\r\n    if (Tabs.current.isPermanentlyHidden) {\r\n      const tab = Tabs.all.reverse().find(t => !t.isPermanentlyHidden && t.id !== 10);\r\n      if (tab) tab.show(true);\r\n      else [...Tab.dimensions.subtabs].reverse().find(t => !t.isPermanentlyHidden).show(true);\r\n    }\r\n\r\n    if (Tabs.current.subtabs.find(t => t.isOpen).isPermanentlyHidden) {\r\n      [...Tab.dimensions.subtabs].reverse().find(t => !t.isPermanentlyHidden).show(true);\r\n    }\r\n  }\r\n\r\n  EventHub.dispatch(GAME_EVENT.GAME_TICK_AFTER);\r\n  GameUI.update();\r\n  player.lastUpdate = thisUpdate;\r\n  PerformanceStats.end(\"Game Update\");\r\n}\r\n\r\nfunction updatePrestigeRates() {\r\n  const currentIPmin = gainedInfinityPoints().dividedBy(Math.clampMin(0.0005, Time.thisInfinityRealTime.totalMinutes));\r\n  if (currentIPmin.gt(player.records.thisInfinity.bestIPmin) && Player.canCrunch) {\r\n    player.records.thisInfinity.bestIPmin = currentIPmin;\r\n    player.records.thisInfinity.bestIPminVal = gainedInfinityPoints();\r\n  }\r\n\r\n  const currentEPmin = gainedEternityPoints().dividedBy(Math.clampMin(0.0005, Time.thisEternityRealTime.totalMinutes));\r\n  if (currentEPmin.gt(player.records.thisEternity.bestEPmin) && Player.canEternity) {\r\n    player.records.thisEternity.bestEPmin = currentEPmin;\r\n    player.records.thisEternity.bestEPminVal = gainedEternityPoints();\r\n  }\r\n\r\n  const currentRSmin = Effarig.shardsGained / Math.clampMin(0.0005, Time.thisRealityRealTime.totalMinutes);\r\n  if (currentRSmin > player.records.thisReality.bestRSmin && isRealityAvailable()) {\r\n    player.records.thisReality.bestRSmin = currentRSmin;\r\n    player.records.thisReality.bestRSminVal = Effarig.shardsGained;\r\n  }\r\n}\r\n\r\nfunction passivePrestigeGen() {\r\n  let eternitiedGain = 0;\r\n  if (RealityUpgrade(14).isBought) {\r\n    eternitiedGain = DC.D1.timesEffectsOf(\r\n      Achievement(113),\r\n      RealityUpgrade(3),\r\n      RealityUpgrade(14)\r\n    );\r\n    eternitiedGain = Decimal.times(eternitiedGain, getAdjustedGlyphEffect(\"timeetermult\"));\r\n    eternitiedGain = new Decimal(Time.deltaTime).times(\r\n      Decimal.pow(eternitiedGain, AlchemyResource.eternity.effectValue));\r\n    player.reality.partEternitied = player.reality.partEternitied.plus(eternitiedGain);\r\n    Currency.eternities.add(player.reality.partEternitied.floor());\r\n    player.reality.partEternitied = player.reality.partEternitied.sub(player.reality.partEternitied.floor());\r\n  }\r\n\r\n  if (!EternityChallenge(4).isRunning) {\r\n    let infGen = DC.D0;\r\n    if (BreakInfinityUpgrade.infinitiedGen.isBought) {\r\n      // Multipliers are done this way to explicitly exclude ach87 and TS32\r\n      // In speed version we retain these two multiplers.\r\n      infGen = infGen.plus(0.5 * Time.deltaTimeMs / Math.clampMin(50, player.records.bestInfinity.time));\r\n      infGen = infGen.timesEffectsOf(\r\n        TimeStudy(32),\r\n        RealityUpgrade(5),\r\n        RealityUpgrade(7),\r\n        Achievement(164),\r\n        Ra.unlocks.continuousTTBoost.effects.infinity\r\n      );\r\n      infGen = infGen.times(getAdjustedGlyphEffect(\"infinityinfmult\"));\r\n    }\r\n    if (RealityUpgrade(11).isBought) {\r\n      infGen = infGen.plus(RealityUpgrade(11).effectValue.times(Time.deltaTime));\r\n    }\r\n    if (EffarigUnlock.eternity.isUnlocked) {\r\n      // We consider half of the eternities we gained above this tick\r\n      // to have been gained before the infinities, and thus not to\r\n      // count here. This gives us the desirable behavior that\r\n      // infinities and eternities gained overall will be the same\r\n      // for two ticks as for one tick of twice the length.\r\n      infGen = infGen.plus(gainedInfinities().times(\r\n        Currency.eternities.value.minus(eternitiedGain.div(2).floor())).times(Time.deltaTime));\r\n    }\r\n    infGen = infGen.plus(player.partInfinitied);\r\n    Currency.infinities.add(infGen.floor());\r\n    player.partInfinitied = infGen.minus(infGen.floor()).toNumber();\r\n  }\r\n}\r\n\r\n// Applies all perks which automatically unlock things when passing certain thresholds, needs to be checked every tick\r\nfunction applyAutoUnlockPerks() {\r\n  if (!TimeDimension(8).isUnlocked && Perk.autounlockTD.canBeApplied) {\r\n    for (let dim = 5; dim <= 8; ++dim) TimeStudy.timeDimension(dim).purchase();\r\n  }\r\n  if (Perk.autounlockDilation3.canBeApplied) buyDilationUpgrade(DilationUpgrade.ttGenerator.id);\r\n  if (Perk.autounlockReality.canBeApplied) TimeStudy.reality.purchase(true);\r\n  applyEU2();\r\n}\r\n\r\nfunction laitelaRealityTick(realDiff) {\r\n  const laitelaInfo = player.celestials.laitela;\r\n  if (!Laitela.isRunning) return;\r\n  if (laitelaInfo.entropy >= 0) {\r\n    laitelaInfo.entropy += (realDiff / 1000) * Laitela.entropyGainPerSecond;\r\n  }\r\n\r\n  // Setting entropy to -1 on completion prevents the modal from showing up repeatedly\r\n  if (laitelaInfo.entropy >= 1) {\r\n    let completionText = `Lai'tela's Reality has been destabilized after ${Time.thisRealityRealTime.toStringShort()}.`;\r\n    laitelaInfo.entropy = -1;\r\n    const oldInfo = {\r\n      fastestCompletion: laitelaInfo.fastestCompletion,\r\n      difficultyTier: laitelaInfo.difficultyTier,\r\n      realityReward: Laitela.realityReward\r\n    };\r\n    laitelaInfo.thisCompletion = Time.thisRealityRealTime.totalSeconds;\r\n    laitelaInfo.fastestCompletion = Math.min(laitelaInfo.thisCompletion, laitelaInfo.fastestCompletion);\r\n    clearCelestialRuns();\r\n    if (Time.thisRealityRealTime.totalSeconds < 30) {\r\n      laitelaInfo.difficultyTier++;\r\n      laitelaInfo.fastestCompletion = 300;\r\n      completionText += laitelaBeatText(Laitela.maxAllowedDimension + 1);\r\n      for (const quote of Laitela.quotes.all) {\r\n        if (quote.requirement) {\r\n          quote.show();\r\n        }\r\n      }\r\n    }\r\n    if (Laitela.realityReward > oldInfo.realityReward) {\r\n      completionText += `<br><br>Dark Matter Multiplier: ${formatX(oldInfo.realityReward, 2, 2)}\r\n      âžœ ${formatX(Laitela.realityReward, 2, 2)}`;\r\n      if (oldInfo.fastestCompletion === 3600 || oldInfo.fastestCompletion === 300 && oldInfo.difficultyTier > 0) {\r\n        if (Time.thisRealityRealTime.totalSeconds < 30) {\r\n          // First attempt - destabilising\r\n          completionText += `<br>Best Completion Time: None âžœ Destabilized\r\n          <br>Highest Active Dimension: ${formatInt(8 - oldInfo.difficultyTier)} âžœ\r\n          ${formatInt(8 - laitelaInfo.difficultyTier)}`;\r\n        } else {\r\n          // First attempt - not destabilising\r\n          completionText += `<br>Best Completion Time: None âžœ\r\n            ${TimeSpan.fromSeconds(laitelaInfo.fastestCompletion).toStringShort()}\r\n            <br>Highest Active Dimension: ${formatInt(8 - laitelaInfo.difficultyTier)}`;\r\n        }\r\n      } else if (Time.thisRealityRealTime.totalSeconds < 30) {\r\n        // Second+ attempt - destabilising\r\n        completionText += `<br>Best Completion Time: ${TimeSpan.fromSeconds(oldInfo.fastestCompletion).toStringShort()}\r\n          âžœ Destabilized\r\n          <br>Highest Active Dimension: ${formatInt(8 - oldInfo.difficultyTier)} âžœ\r\n          ${formatInt(8 - laitelaInfo.difficultyTier)}`;\r\n      } else {\r\n        // Second+ attempt - not destabilising\r\n        completionText += `<br>Best Completion Time: ${TimeSpan.fromSeconds(oldInfo.fastestCompletion).toStringShort()}\r\n        âžœ ${TimeSpan.fromSeconds(laitelaInfo.fastestCompletion).toStringShort()}\r\n        <br>Highest Active Dimension: ${formatInt(8 - oldInfo.difficultyTier)}`;\r\n      }\r\n      player.records.bestReality.laitelaSet = Glyphs.copyForRecords(Glyphs.active.filter(g => g !== null));\r\n    } else {\r\n      completionText += ` You need to destabilize in faster than\r\n        ${TimeSpan.fromSeconds(laitelaInfo.fastestCompletion).toStringShort()} to improve your multiplier.`;\r\n    }\r\n    if (Laitela.isFullyDestabilized) SpeedrunMilestones(24).tryComplete();\r\n    Modal.message.show(completionText, {}, 2);\r\n  }\r\n}\r\n\r\nfunction laitelaBeatText(disabledDim) {\r\n  switch (disabledDim) {\r\n    case 1: return `<br><br>Lai'tela's Reality will now completely disable production from all Dimensions.\r\n        The Reality can still be entered, but further destabilization is no longer possible.\r\n        For completely destabilizing the Reality, you also get an additional ${formatX(8)} to Dark Energy gain.`;\r\n    case 2: return `<br><br>Lai'tela's Reality will now disable production from all 2nd Dimensions during\r\n      future runs, but the reward will be ${formatInt(100)} times stronger than before. Completely destabilizing\r\n      the Reality for the final Dimension will give you an additional ${formatX(8)} to Dark Energy gain.`;\r\n    case 3: return `<br><br>Lai'tela's Reality will now disable production from all 3rd Dimensions during\r\n        future runs, but the reward will be ${formatInt(100)} times stronger than before.`;\r\n    case 8: return `<br><br>Lai'tela's Reality will now disable production from all 8th Dimensions during\r\n        future runs, but the reward will be ${formatInt(100)} times stronger than before. This boost can be\r\n        repeated for each remaining Dimension by reaching destabilization within ${formatInt(30)} seconds again.`;\r\n    default: return `<br><br>Lai'tela's Reality will now disable production from all\r\n        ${disabledDim}th Dimensions during future runs, but the reward will be\r\n        ${formatInt(100)} times stronger than before.`;\r\n  }\r\n}\r\n\r\n// This gives IP/EP/RM from the respective upgrades that reward the prestige currencies continuously\r\nfunction applyAutoprestige(diff) {\r\n  Currency.infinityPoints.add(TimeStudy(181).effectOrDefault(0));\r\n\r\n  if (TeresaUnlocks.epGen.canBeApplied) {\r\n    Currency.eternityPoints.add(player.records.thisEternity.bestEPmin.times(DC.D0_01)\r\n      .times(getGameSpeedupFactor() * diff / 1000).timesEffectOf(Ra.unlocks.continuousTTBoost.effects.autoPrestige));\r\n  }\r\n\r\n  if (InfinityUpgrade.ipGen.isCharged) {\r\n    const addedRM = MachineHandler.gainedRealityMachines\r\n      .timesEffectsOf(InfinityUpgrade.ipGen.chargedEffect)\r\n      .times(diff / 1000);\r\n    Currency.realityMachines.add(addedRM);\r\n  }\r\n\r\n  if (PelleRifts.chaos.milestones[2].canBeApplied) {\r\n    Currency.eternityPoints.add(gainedEternityPoints().times(DC.D0_1).times(diff / 1000));\r\n  }\r\n}\r\n\r\nfunction updateImaginaryMachines(diff) {\r\n  MachineHandler.updateIMCap();\r\n  Currency.imaginaryMachines.add(MachineHandler.gainedImaginaryMachines(diff));\r\n}\r\n\r\nfunction updateTachyonGalaxies() {\r\n  const tachyonGalaxyMult = Effects.max(1, DilationUpgrade.doubleGalaxies);\r\n  const tachyonGalaxyThreshold = 1000;\r\n  const thresholdMult = getTachyonGalaxyMult();\r\n  player.dilation.baseTachyonGalaxies = Math.max(player.dilation.baseTachyonGalaxies,\r\n    1 + Math.floor(Decimal.log(Currency.dilatedTime.value.dividedBy(1000), thresholdMult)));\r\n  player.dilation.nextThreshold = DC.E3.times(new Decimal(thresholdMult)\r\n    .pow(player.dilation.baseTachyonGalaxies));\r\n  player.dilation.totalTachyonGalaxies =\r\n    Math.min(player.dilation.baseTachyonGalaxies * tachyonGalaxyMult, tachyonGalaxyThreshold) +\r\n    Math.max(player.dilation.baseTachyonGalaxies * tachyonGalaxyMult - tachyonGalaxyThreshold, 0) / tachyonGalaxyMult;\r\n\r\n  player.dilation.totalTachyonGalaxies *= DilationUpgrade.galaxyMultiplier.effectValue;\r\n}\r\n\r\nexport function getTTPerSecond() {\r\n  // All TT multipliers (note that this is equal to 1 pre-Ra)\r\n  let ttMult = Effects.product(\r\n    Ra.unlocks.continuousTTBoost.effects.ttGen,\r\n    Ra.unlocks.achievementTTMult,\r\n    Achievement(137),\r\n    Achievement(156),\r\n  );\r\n  if (GlyphAlteration.isAdded(\"dilation\")) ttMult *= getSecondaryGlyphEffect(\"dilationTTgen\");\r\n\r\n  // Glyph TT generation\r\n  const glyphTT = Teresa.isRunning || Enslaved.isRunning || Pelle.isDoomed\r\n    ? 0\r\n    : getAdjustedGlyphEffect(\"dilationTTgen\") * ttMult;\r\n\r\n  // Dilation TT generation\r\n  const dilationTT = DilationUpgrade.ttGenerator.isBought\r\n    ? DilationUpgrade.ttGenerator.effectValue.times(Pelle.isDoomed ? 1 : ttMult)\r\n    : DC.D0;\r\n\r\n  // Lai'tela TT power\r\n  let finalTT = dilationTT.add(glyphTT);\r\n  if (finalTT.gt(1)) {\r\n    finalTT = finalTT.pow(SingularityMilestone.theoremPowerFromSingularities.effectOrDefault(1));\r\n  }\r\n\r\n  return finalTT;\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction recursiveTimeOut(fn, iterations, endFn) {\r\n  fn(iterations);\r\n  if (iterations === 0) endFn();\r\n  else setTimeout(() => recursiveTimeOut(fn, iterations - 1, endFn), 0);\r\n}\r\n\r\nfunction afterSimulation(seconds, playerBefore) {\r\n  if (seconds > 600) {\r\n    const playerAfter = deepmergeAll([{}, player]);\r\n    Modal.awayProgress.show({ playerBefore, playerAfter, seconds });\r\n  }\r\n\r\n  GameUI.notify.showBlackHoles = true;\r\n}\r\n\r\nexport function simulateTime(seconds, real, fast) {\r\n  seconds *= getGlobalSpeedFactor();\r\n  // The game is simulated at a base 50ms update rate, with a maximum tick count based on the values of real and fast\r\n  // - Calling with real === true will always simulate at full accuracy with no tick count reduction unless it would\r\n  //   otherwise simulate with more ticks than offline progress would allow\r\n  // - Calling with fast === true will only simulate it with a max of 50 ticks\r\n  // - Otherwise, tick count will be limited to the offline tick count (which may be set externally during save import)\r\n  // Tick count is never *increased*, and only ever decreased if needed.\r\n  if (seconds < 0) return;\r\n  let ticks = Math.floor(seconds / getGlobalSpeedFactor() * 20);\r\n  GameUI.notify.showBlackHoles = false;\r\n\r\n  // Limit the tick count (this also applies if the black hole is unlocked)\r\n  const maxTicks = GameStorage.maxOfflineTicks(1000 * seconds / getGlobalSpeedFactor(), GameStorage.offlineTicks ?? player.options.offlineTicks);\r\n  if (ticks > maxTicks && !fast) {\r\n    ticks = maxTicks;\r\n  } else if (ticks > 50 && !real && fast) {\r\n    ticks = 50;\r\n  }\r\n\r\n  const playerStart = deepmergeAll([{}, player]);\r\n\r\n  let totalGameTime;\r\n\r\n  if (BlackHoles.areUnlocked && !BlackHoles.arePaused) {\r\n    totalGameTime = BlackHoles.calculateGameTimeFromRealTime(seconds, BlackHoles.calculateSpeedups());\r\n  } else {\r\n    totalGameTime = getGameSpeedupFactor() * seconds;\r\n  }\r\n\r\n  const infinitiedMilestone = getInfinitiedMilestoneReward(totalGameTime * 1000);\r\n  const eternitiedMilestone = getEternitiedMilestoneReward(totalGameTime * 1000);\r\n\r\n  if (eternitiedMilestone.gt(0)) {\r\n    Currency.eternities.add(eternitiedMilestone);\r\n  } else if (infinitiedMilestone.gt(0)) {\r\n    Currency.infinities.add(infinitiedMilestone);\r\n  } else {\r\n    Currency.eternityPoints.add(getOfflineEPGain(seconds * 1000));\r\n  }\r\n\r\n  if (InfinityUpgrade.ipOffline.isBought && player.options.offlineProgress) {\r\n    Currency.infinityPoints.add(player.records.thisEternity.bestIPMsWithoutMaxAll.times(seconds * 1000 / 2));\r\n  }\r\n\r\n  EventHub.dispatch(GAME_EVENT.OFFLINE_CURRENCY_GAINED);\r\n\r\n  let remainingRealSeconds = seconds / getGlobalSpeedFactor();\r\n  // During async code the number of ticks remaining can go down suddenly\r\n  // from \"Speed up\" which means tick length needs to go up, and thus\r\n  // you can't just divide total time by total ticks to get tick length.\r\n  // For example, suppose you had 6000 offline ticks, and called \"Speed up\"\r\n  // 1000 ticks in, meaning that after \"Speed up\" there'd only be 1000 ticks more\r\n  // (so 1000 + 1000 = 2000 ticks total). Dividing total time by total ticks would\r\n  // use 1/6th of the total time before \"Speed up\" (1000 of 6000 ticks), and 1/2 after\r\n  // (1000 of 2000 ticks). Short of some sort of magic user prediction to figure out\r\n  // whether the user *will* press \"Speed up\" at some point, dividing remaining time\r\n  // by remaining ticks seems like the best thing to do.\r\n  let loopFn = i => {\r\n    const diff = remainingRealSeconds / i;\r\n    gameLoop(1000 * diff);\r\n    remainingRealSeconds -= diff;\r\n  };\r\n\r\n  // Simulation code which accounts for BH cycles (segments where a BH is active doesn't use diff since it splits\r\n  // up intervals based on real time instead in an effort to keep ticks all roughly equal in game time).\r\n  // Black hole auto-pausing is entirely handled by the black hole phase advancement code (for actually pausing)\r\n  // and calculateOfflineTick (for time calculation).\r\n  if (BlackHoles.areUnlocked && !BlackHoles.arePaused) {\r\n    loopFn = i => {\r\n      const [realTickTime, blackHoleSpeedup] = BlackHoles.calculateOfflineTick(remainingRealSeconds,\r\n        i, 0.0001);\r\n      remainingRealSeconds -= realTickTime;\r\n      gameLoop(1000 * realTickTime, { blackHoleSpeedup });\r\n    };\r\n  }\r\n\r\n  // We don't show the offline modal here or bother with async if doing a fast simulation\r\n  if (fast) {\r\n    // Fast simulations happen when simulating between 10 and 50 seconds of offline time.\r\n    // One easy way to get this is to autosave every 30 or 60 seconds, wait until the save timer\r\n    // in the bottom-left hits 15 seconds, and refresh (without saving directly beforehand).\r\n    GameIntervals.stop();\r\n    // Fast simulations are always 50 ticks. They're done in this weird countdown way because\r\n    // we want to be able to call the same function that we call when using async code (to avoid\r\n    // duplicating functions), and that function expects a parameter saying how many ticks are remaining.\r\n    for (let remaining = 50; remaining > 0; remaining--) {\r\n      loopFn(remaining);\r\n    }\r\n    GameStorage.postLoadStuff();\r\n    afterSimulation(seconds, playerStart);\r\n  } else {\r\n    const progress = {};\r\n    ui.view.modal.progressBar = {};\r\n    Async.run(loopFn,\r\n      ticks,\r\n      {\r\n        batchSize: 1,\r\n        maxTime: 60,\r\n        sleepTime: 1,\r\n        asyncEntry: doneSoFar => {\r\n          GameIntervals.stop();\r\n          ui.$viewModel.modal.progressBar = {\r\n            label: \"Offline Progress Simulation\",\r\n            info: () => `The game is being run at a lower accuracy in order to quickly calculate the resources you\r\n              gained while you were away. See the How To Play entry on \"Offline Progress\" for technical details. If\r\n              you are impatient and want to get back to the game sooner, you can click the \"Speed up\" button to\r\n              simulate the rest of the time with half as many ticks (down to a minimum of ${formatInt(500)} ticks\r\n              remaining). The \"SKIP\" button will instead use all the remaining offline time in ${formatInt(10)}\r\n              ticks.`,\r\n            progressName: \"Ticks\",\r\n            current: doneSoFar,\r\n            max: ticks,\r\n            startTime: Date.now(),\r\n            buttons: [{\r\n              text: \"Speed up\",\r\n              condition: (current, max) => max - current > 500,\r\n              click: () => {\r\n                const newRemaining = Math.clampMin(Math.floor(progress.remaining / 2), 500);\r\n                // We subtract the number of ticks we skipped, which is progress.remaining - newRemaining.\r\n                // This, and the below similar code in \"SKIP\", are needed or the progress bar to be accurate\r\n                // (both with respect to the number of ticks it shows and with respect to how full it is).\r\n                progress.maxIter -= progress.remaining - newRemaining;\r\n                progress.remaining = newRemaining;\r\n                // We update the progress bar max data (remaining will update automatically).\r\n                ui.$viewModel.modal.progressBar.max = progress.maxIter;\r\n              }\r\n            },\r\n            {\r\n              text: \"SKIP\",\r\n              condition: (current, max) => max - current > 10,\r\n              click: () => {\r\n                // We jump to 10 from the end (condition guarantees there are at least 10 left).\r\n                // We subtract the number of ticks we skipped, which is progress.remaining - 10.\r\n                progress.maxIter -= progress.remaining - 10;\r\n                progress.remaining = 10;\r\n              }\r\n            }]\r\n          };\r\n        },\r\n        asyncProgress: doneSoFar => {\r\n          ui.$viewModel.modal.progressBar.current = doneSoFar;\r\n        },\r\n        asyncExit: () => {\r\n          ui.$viewModel.modal.progressBar = undefined;\r\n          // .postLoadStuff will restart GameIntervals\r\n          GameStorage.postLoadStuff();\r\n        },\r\n        then: () => {\r\n          afterSimulation(seconds, playerStart);\r\n        },\r\n        progress\r\n      });\r\n  }\r\n}\r\n\r\nwindow.onload = function() {\r\n  const supportedBrowser = browserCheck();\r\n  GameUI.initialized = supportedBrowser;\r\n  ui.view.initialized = supportedBrowser;\r\n  setTimeout(() => {\r\n    ElectronRuntime.updateZoom();\r\n    document.getElementById(\"loading\").style.display = \"none\";\r\n  }, 500);\r\n  if (!supportedBrowser) {\r\n    GameIntervals.stop();\r\n    document.getElementById(\"loading\").style.display = \"none\";\r\n    document.getElementById(\"browser-warning\").style.display = \"flex\";\r\n  }\r\n};\r\n\r\nwindow.onfocus = function() {\r\n  setShiftKey(false);\r\n};\r\n\r\nwindow.onblur = function() {\r\n  GameKeyboard.stopSpins();\r\n};\r\n\r\nexport function setShiftKey(isDown) {\r\n  ui.view.shiftDown = isDown;\r\n}\r\n\r\nexport function setHoldingR(x) {\r\n  Replicanti.galaxies.isPlayerHoldingR = x;\r\n}\r\n\r\nexport function browserCheck() {\r\n  return supportedBrowsers.test(navigator.userAgent);\r\n}\r\n\r\nexport function init() {\r\n  // eslint-disable-next-line no-console\r\n  console.log(\"ðŸŒŒ Antimatter Dimensions: Reality Update ðŸŒŒ\");\r\n  if (DEV) {\r\n    // eslint-disable-next-line no-console\r\n    console.log(\"ðŸ‘¨â€ðŸ’» Development Mode ðŸ‘©â€ðŸ’»\");\r\n  }\r\n  ElectronRuntime.initialize();\r\n  SteamRuntime.initialize();\r\n  Cloud.init();\r\n  GameStorage.load();\r\n  Tabs.all.find(t => t.config.id === player.options.lastOpenTab).show(true);\r\n  Payments.init();\r\n}\r\n\r\nwindow.tweenTime = 0;\r\nlet lastFrame;\r\nfunction animateTweens(time) {\r\n  requestAnimationFrame(animateTweens);\r\n  if (time === undefined || lastFrame === undefined) {\r\n    lastFrame = time;\r\n    return;\r\n  }\r\n  let delta = time - lastFrame;\r\n  lastFrame = time;\r\n  if (player.dilation.active) {\r\n    delta /= Pelle.isDoomed ? 1.5 : 10;\r\n  }\r\n  tweenTime += delta;\r\n  TWEEN.update(tweenTime);\r\n}\r\n\r\nanimateTweens();\r\n"]},"metadata":{},"sourceType":"module"}