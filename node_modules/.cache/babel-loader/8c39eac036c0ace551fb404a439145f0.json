{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport { hasCompilationErrors } from \"@/core/automator\";\nimport ModalWrapperChoice from \"@/components/modals/ModalWrapperChoice\";\nexport default {\n  name: \"ImportAutomatorDataModal\",\n  components: {\n    ModalWrapperChoice\n  },\n\n  data() {\n    return {\n      input: \"\",\n      isValid: false,\n      hasExtraData: false,\n      scriptName: \"\",\n      lineCount: 0,\n      scriptContent: \"\",\n      hasErrors: false,\n      importedPresets: [],\n      importedConstants: [],\n      ignorePresets: false,\n      ignoreConstants: false\n    };\n  },\n\n  computed: {\n    hasPresets() {\n      var _this$importedPresets, _this$importedPresets2;\n\n      return ((_this$importedPresets = (_this$importedPresets2 = this.importedPresets) === null || _this$importedPresets2 === void 0 ? void 0 : _this$importedPresets2.length) !== null && _this$importedPresets !== void 0 ? _this$importedPresets : 0) !== 0;\n    },\n\n    hasConstants() {\n      var _this$importedConstan, _this$importedConstan2;\n\n      return ((_this$importedConstan = (_this$importedConstan2 = this.importedConstants) === null || _this$importedConstan2 === void 0 ? void 0 : _this$importedConstan2.length) !== null && _this$importedConstan !== void 0 ? _this$importedConstan : 0) !== 0;\n    },\n\n    isImportingExtraData() {\n      // These two checks differ because we suppress the preset import warning when importing into an empty\n      // slot, but we use this prop for information on importing rather than overwriting\n      const hasNewConstants = this.willOverwriteConstant || this.constantCountAfterImport > this.currentConstants;\n      const isImportingPresets = this.importedPresets ? !this.ignorePresets : false;\n      const isImportingConstants = this.importedConstants ? !this.ignoreConstants && hasNewConstants : false;\n      return this.isValid && this.hasExtraData && (isImportingPresets || isImportingConstants);\n    },\n\n    currentPresets: () => player.timestudy.presets,\n    currentConstants: () => Object.keys(player.reality.automator.constants),\n\n    maxConstantCount() {\n      return AutomatorData.MAX_ALLOWED_CONSTANT_COUNT;\n    },\n\n    // Number of studies with different contents which will be overwritten\n    overwrittenPresetCount() {\n      let mismatchedPresets = 0;\n\n      for (const toImport of this.importedPresets) {\n        const existingPreset = this.currentPresets[toImport.id];\n        const isEmpty = existingPreset.name === \"\" && existingPreset.studies === \"\";\n\n        if (!isEmpty && (existingPreset.name !== toImport.name || existingPreset.studies !== toImport.studies)) {\n          mismatchedPresets++;\n        }\n      }\n\n      return mismatchedPresets;\n    },\n\n    willOverwriteConstant() {\n      if (!this.hasExtraData) return false;\n      const all = new Set();\n\n      for (const constant of this.currentConstants) all.add(constant);\n\n      for (const constant of this.importedConstants) {\n        if (all.has(constant.key) && player.reality.automator.constants[constant.key] !== constant.value) return true;\n      }\n\n      return false;\n    },\n\n    constantCountAfterImport() {\n      if (!this.hasExtraData) return this.currentConstants.length;\n      const all = new Set();\n\n      for (const constant of this.currentConstants) all.add(constant);\n\n      for (const constant of this.importedConstants) all.add(constant.key);\n\n      return all.size;\n    },\n\n    extraConstants() {\n      return this.constantCountAfterImport - this.maxConstantCount;\n    },\n\n    presetButtonText() {\n      return this.ignorePresets ? \"Will Ignore Presets\" : \"Will Import Presets\";\n    },\n\n    constantButtonText() {\n      return this.ignoreConstants ? \"Will Ignore Constants\" : \"Will Import Constants\";\n    }\n\n  },\n\n  mounted() {\n    this.$refs.input.select();\n  },\n\n  methods: {\n    update() {\n      // We need to sequentially parse full data and then single script data in order to handle both in the same modal.\n      // Parsing order doesn't matter due to the fact that export formatting means it's only ever one or the other.\n      let parsed = AutomatorBackend.parseFullScriptData(this.input);\n      if (parsed) this.hasExtraData = true;else {\n        parsed = AutomatorBackend.parseScriptContents(this.input);\n        this.hasExtraData = false;\n      }\n\n      if (!parsed) {\n        this.isValid = false;\n        return;\n      } // Some of these may be undefined for single script importing (ie. no additional data attached) or for scripts\n      // with errors. These cases are checked elsewhere\n\n\n      this.scriptName = parsed.name;\n      this.scriptContent = parsed.content;\n      this.importedPresets = parsed.presets;\n      this.importedConstants = parsed.constants;\n      this.lineCount = this.scriptContent.split(\"\\n\").length;\n      this.hasErrors = hasCompilationErrors(this.scriptContent);\n      this.isValid = true;\n    },\n\n    importSave() {\n      if (!this.isValid) return;\n\n      if (this.hasExtraData) {\n        AutomatorBackend.importFullScriptData(this.input, {\n          presets: this.ignorePresets,\n          constants: this.ignoreConstants\n        });\n      } else {\n        AutomatorBackend.importScriptContents(this.input);\n      }\n\n      this.emitClose();\n    }\n\n  }\n};","map":{"version":3,"sources":["ImportAutomatorDataModal.vue"],"names":[],"mappings":"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","sourcesContent":["<script>\r\nimport { hasCompilationErrors } from \"@/core/automator\";\r\n\r\nimport ModalWrapperChoice from \"@/components/modals/ModalWrapperChoice\";\r\n\r\nexport default {\r\n  name: \"ImportAutomatorDataModal\",\r\n  components: {\r\n    ModalWrapperChoice,\r\n  },\r\n  data() {\r\n    return {\r\n      input: \"\",\r\n      isValid: false,\r\n      hasExtraData: false,\r\n      scriptName: \"\",\r\n      lineCount: 0,\r\n      scriptContent: \"\",\r\n      hasErrors: false,\r\n      importedPresets: [],\r\n      importedConstants: [],\r\n      ignorePresets: false,\r\n      ignoreConstants: false,\r\n    };\r\n  },\r\n  computed: {\r\n    hasPresets() {\r\n      return (this.importedPresets?.length ?? 0) !== 0;\r\n    },\r\n    hasConstants() {\r\n      return (this.importedConstants?.length ?? 0) !== 0;\r\n    },\r\n    isImportingExtraData() {\r\n      // These two checks differ because we suppress the preset import warning when importing into an empty\r\n      // slot, but we use this prop for information on importing rather than overwriting\r\n      const hasNewConstants = this.willOverwriteConstant || this.constantCountAfterImport > this.currentConstants;\r\n      const isImportingPresets = this.importedPresets ? !this.ignorePresets : false;\r\n      const isImportingConstants = this.importedConstants\r\n        ? !this.ignoreConstants && hasNewConstants\r\n        : false;\r\n      return this.isValid && this.hasExtraData && (isImportingPresets || isImportingConstants);\r\n    },\r\n    currentPresets: () => player.timestudy.presets,\r\n    currentConstants: () => Object.keys(player.reality.automator.constants),\r\n    maxConstantCount() {\r\n      return AutomatorData.MAX_ALLOWED_CONSTANT_COUNT;\r\n    },\r\n    // Number of studies with different contents which will be overwritten\r\n    overwrittenPresetCount() {\r\n      let mismatchedPresets = 0;\r\n      for (const toImport of this.importedPresets) {\r\n        const existingPreset = this.currentPresets[toImport.id];\r\n        const isEmpty = existingPreset.name === \"\" && existingPreset.studies === \"\";\r\n        if (!isEmpty && (existingPreset.name !== toImport.name || existingPreset.studies !== toImport.studies)) {\r\n          mismatchedPresets++;\r\n        }\r\n      }\r\n      return mismatchedPresets;\r\n    },\r\n    willOverwriteConstant() {\r\n      if (!this.hasExtraData) return false;\r\n      const all = new Set();\r\n      for (const constant of this.currentConstants) all.add(constant);\r\n      for (const constant of this.importedConstants) {\r\n        if (all.has(constant.key) && player.reality.automator.constants[constant.key] !== constant.value) return true;\r\n      }\r\n      return false;\r\n    },\r\n    constantCountAfterImport() {\r\n      if (!this.hasExtraData) return this.currentConstants.length;\r\n      const all = new Set();\r\n      for (const constant of this.currentConstants) all.add(constant);\r\n      for (const constant of this.importedConstants) all.add(constant.key);\r\n      return all.size;\r\n    },\r\n    extraConstants() {\r\n      return this.constantCountAfterImport - this.maxConstantCount;\r\n    },\r\n    presetButtonText() {\r\n      return this.ignorePresets ? \"Will Ignore Presets\" : \"Will Import Presets\";\r\n    },\r\n    constantButtonText() {\r\n      return this.ignoreConstants ? \"Will Ignore Constants\" : \"Will Import Constants\";\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$refs.input.select();\r\n  },\r\n  methods: {\r\n    update() {\r\n      // We need to sequentially parse full data and then single script data in order to handle both in the same modal.\r\n      // Parsing order doesn't matter due to the fact that export formatting means it's only ever one or the other.\r\n      let parsed = AutomatorBackend.parseFullScriptData(this.input);\r\n      if (parsed) this.hasExtraData = true;\r\n      else {\r\n        parsed = AutomatorBackend.parseScriptContents(this.input);\r\n        this.hasExtraData = false;\r\n      }\r\n      if (!parsed) {\r\n        this.isValid = false;\r\n        return;\r\n      }\r\n\r\n      // Some of these may be undefined for single script importing (ie. no additional data attached) or for scripts\r\n      // with errors. These cases are checked elsewhere\r\n      this.scriptName = parsed.name;\r\n      this.scriptContent = parsed.content;\r\n      this.importedPresets = parsed.presets;\r\n      this.importedConstants = parsed.constants;\r\n      this.lineCount = this.scriptContent.split(\"\\n\").length;\r\n      this.hasErrors = hasCompilationErrors(this.scriptContent);\r\n      this.isValid = true;\r\n    },\r\n    importSave() {\r\n      if (!this.isValid) return;\r\n      if (this.hasExtraData) {\r\n        AutomatorBackend.importFullScriptData(this.input, {\r\n          presets: this.ignorePresets,\r\n          constants: this.ignoreConstants\r\n        });\r\n      } else {\r\n        AutomatorBackend.importScriptContents(this.input);\r\n      }\r\n      this.emitClose();\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <ModalWrapperChoice\r\n    :show-cancel=\"!isValid\"\r\n    :show-confirm=\"isValid\"\r\n    @confirm=\"importSave\"\r\n  >\r\n    <template #header>\r\n      Import Automator Script Data\r\n    </template>\r\n    This will create a new Automator script at the end of your list.\r\n    <span v-if=\"isImportingExtraData\">This will also import additional data related to the script.</span>\r\n    <input\r\n      ref=\"input\"\r\n      v-model=\"input\"\r\n      type=\"text\"\r\n      class=\"c-modal-input c-modal-import__input\"\r\n      @keyup.enter=\"importSave\"\r\n      @keyup.esc=\"emitClose\"\r\n    >\r\n    <div v-if=\"isValid\">\r\n      Script name: {{ scriptName }}\r\n      <br>\r\n      Line count: {{ lineCount }}\r\n      <div v-if=\"hasPresets\">\r\n        <br>\r\n        Study Presets:\r\n        <span\r\n          v-for=\"(preset, id) in importedPresets\"\r\n          :key=\"id\"\r\n          class=\"c-import-data-name\"\r\n        >\r\n          <span v-if=\"preset.name\">\"{{ preset.name }}\" (slot {{ preset.id + 1 }})</span>\r\n          <span v-else>Preset slot #{{ preset.id + 1 }}</span>\r\n        </span>\r\n        <div\r\n          v-if=\"!ignorePresets && overwrittenPresetCount > 0\"\r\n          class=\"l-has-errors\"\r\n        >\r\n          {{ formatInt(overwrittenPresetCount) }} of your existing presets\r\n          will be overwritten by imported presets!\r\n        </div>\r\n        <br>\r\n        <button\r\n          class=\"o-primary-btn\"\r\n          @click=\"ignorePresets = !ignorePresets\"\r\n        >\r\n          {{ presetButtonText }}\r\n        </button>\r\n      </div>\r\n      <div v-if=\"hasConstants\">\r\n        <br>\r\n        Constants:\r\n        <span\r\n          v-for=\"(constant, id) in importedConstants\"\r\n          :key=\"id + 10\"\r\n          class=\"c-import-data-name\"\r\n        >\r\n          \"{{ constant.key }}\"\r\n        </span>\r\n        <div\r\n          v-if=\"!ignoreConstants && (willOverwriteConstant || extraConstants > 0)\"\r\n          class=\"l-has-errors\"\r\n        >\r\n          <span v-if=\"willOverwriteConstant\">Some of your existing constants will be overwritten!</span>\r\n          <br v-if=\"willOverwriteConstant && extraConstants > 0\">\r\n          <span v-if=\"extraConstants > 0\">\r\n            {{ quantifyInt(\"constant\", extraConstants) }} will not be imported due to the\r\n            {{ maxConstantCount }} constant limit.\r\n          </span>\r\n        </div>\r\n        <br>\r\n        <button\r\n          class=\"o-primary-btn\"\r\n          @click=\"ignoreConstants = !ignoreConstants\"\r\n        >\r\n          {{ constantButtonText }}\r\n        </button>\r\n      </div>\r\n      <br>\r\n      <div\r\n        v-if=\"hasErrors\"\r\n        class=\"l-has-errors\"\r\n      >\r\n        This script has errors which need to be fixed before it can be run!\r\n      </div>\r\n      <div v-if=\"hasErrors && isImportingExtraData\">\r\n        <i>Some errors may be fixed with the additional data being imported.</i>\r\n      </div>\r\n    </div>\r\n    <div v-else-if=\"input.length !== 0\">\r\n      Invalid Automator data string\r\n    </div>\r\n    <template #confirm-text>\r\n      Import\r\n    </template>\r\n  </ModalWrapperChoice>\r\n</template>\r\n\r\n<style scoped>\r\n.l-has-errors {\r\n  color: red;\r\n}\r\n\r\n.c-import-data-name {\r\n  padding: 0 1rem;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components/modals"},"metadata":{},"sourceType":"module"}