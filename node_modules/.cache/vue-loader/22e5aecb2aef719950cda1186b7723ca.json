{"remainingRequest":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\@vue\\vue-loader-v15\\lib\\index.js??vue-loader-options!C:\\Games\\ADFasterer\\ADfasterer\\src\\components\\tabs\\automator\\AutomatorBlockEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Games\\ADFasterer\\ADfasterer\\src\\components\\tabs\\automator\\AutomatorBlockEditor.vue","mtime":1745241597060},{"path":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\babel-loader\\lib\\index.js","mtime":1745242219290},{"path":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745242214069},{"path":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\@vue\\vue-loader-v15\\lib\\index.js","mtime":1745242220175}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7DQoNCmltcG9ydCBBdXRvbWF0b3JCbG9ja1NpbmdsZVJvdyBmcm9tICIuL0F1dG9tYXRvckJsb2NrU2luZ2xlUm93IjsNCmltcG9ydCB7IGJsb2NraWZ5VGV4dEF1dG9tYXRvciB9IGZyb20gIkAvY29yZS9hdXRvbWF0b3IiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJBdXRvbWF0b3JCbG9ja0VkaXRvciIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBBdXRvbWF0b3JCbG9ja1NpbmdsZVJvdywNCiAgICBkcmFnZ2FibGUNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBsaW5lczogew0KICAgICAgZ2V0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy4kdmlld01vZGVsLnRhYnMucmVhbGl0eS5hdXRvbWF0b3IubGluZXM7DQogICAgICB9LA0KICAgICAgc2V0KHZhbHVlKSB7DQogICAgICAgIHRoaXMuJHZpZXdNb2RlbC50YWJzLnJlYWxpdHkuYXV0b21hdG9yLmxpbmVzID0gdmFsdWU7DQogICAgICB9DQogICAgfSwNCiAgICBudW1iZXJPZkxpbmVzKCkgew0KICAgICAgcmV0dXJuIHRoaXMubGluZXMucmVkdWNlKChhLCBsKSA9PiBhICsgQmxvY2tBdXRvbWF0b3IubnVtYmVyT2ZMaW5lc0luQmxvY2sobCksIDApOw0KICAgIH0sDQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgQmxvY2tBdXRvbWF0b3IuaW5pdGlhbGl6ZSgpOw0KICAgIEF1dG9tYXRvckRhdGEucmVjYWxjdWxhdGVFcnJvcnMoKTsNCiAgICBCbG9ja0F1dG9tYXRvci5lZGl0b3Iuc2Nyb2xsVG8oMCwgQmxvY2tBdXRvbWF0b3IucHJldmlvdXNTY3JvbGxQb3NpdGlvbik7DQogICAgQmxvY2tBdXRvbWF0b3IuZ3V0dGVyLnN0eWxlLmJvdHRvbSA9IGAke0Jsb2NrQXV0b21hdG9yLmVkaXRvci5zY3JvbGxUb3B9cHhgOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgdXBkYXRlKCkgew0KICAgICAgaWYgKEF1dG9tYXRvckJhY2tlbmQuc3RhdGUuZm9sbG93RXhlY3V0aW9uKSBBdXRvbWF0b3JCYWNrZW5kLmp1bXBUb0FjdGl2ZUxpbmUoKTsNCiAgICAgIGNvbnN0IHRhcmdldExpbmUgPSBBdXRvbWF0b3JCYWNrZW5kLmlzT24NCiAgICAgICAgPyBCbG9ja0F1dG9tYXRvci5saW5lTnVtYmVyRnJvbUJsb2NrSUQoQmxvY2tBdXRvbWF0b3IuY3VycmVudEJsb2NrSWQpDQogICAgICAgIDogLTE7DQogICAgICBBdXRvbWF0b3JIaWdobGlnaHRlci51cGRhdGVIaWdobGlnaHRlZExpbmUodGFyZ2V0TGluZSwgTGluZUVudW0uQWN0aXZlKTsNCiAgICB9LA0KICAgIHNldFByZXZpb3VzU2Nyb2xsKCkgew0KICAgICAgQmxvY2tBdXRvbWF0b3IucHJldmlvdXNTY3JvbGxQb3NpdGlvbiA9IHRoaXMuJHJlZnMuYmxvY2tFZGl0b3JFbGVtZW50LnNjcm9sbFRvcDsNCiAgICAgIEJsb2NrQXV0b21hdG9yLmd1dHRlci5zdHlsZS5ib3R0b20gPSBgJHtCbG9ja0F1dG9tYXRvci5lZGl0b3Iuc2Nyb2xsVG9wfXB4YDsNCiAgICB9LA0KICAgIHBhcnNlUmVxdWVzdCgpIHsNCiAgICAgIEJsb2NrQXV0b21hdG9yLnVwZGF0ZUlkQXJyYXkoKTsNCiAgICAgIEF1dG9tYXRvckRhdGEucmVjYWxjdWxhdGVFcnJvcnMoKTsNCiAgICAgIEJsb2NrQXV0b21hdG9yLnBhcnNlVGV4dEZyb21CbG9ja3MoKTsNCiAgICB9LA0KICAgIHVwZGF0ZUJsb2NrKGJsb2NrLCBpZCkgew0KICAgICAgdGhpcy5saW5lc1t0aGlzLmxpbmVzLmZpbmRJbmRleCh4ID0+IHguaWQgPT09IGlkKV0gPSBibG9jazsNCiAgICAgIHRoaXMucGFyc2VSZXF1ZXN0KCk7DQogICAgfSwNCiAgICBkZWxldGVCbG9jayhpZCkgew0KICAgICAgY29uc3QgaWR4ID0gdGhpcy5saW5lcy5maW5kSW5kZXgoeCA9PiB4LmlkID09PSBpZCk7DQogICAgICB0aGlzLmxpbmVzLnNwbGljZShpZHgsIDEpOw0KICAgICAgdGhpcy5wYXJzZVJlcXVlc3QoKTsNCiAgICB9LA0KICB9DQp9Ow0KDQpleHBvcnQgY29uc3QgQmxvY2tBdXRvbWF0b3IgPSB7DQogIGVkaXRvcjogbnVsbCwNCiAgZ3V0dGVyOiBudWxsLA0KICBfaWRBcnJheTogW10sDQoNCiAgaW5pdGlhbGl6ZSgpIHsNCiAgICB0aGlzLmVkaXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImMtYXV0b21hdG9yLWJsb2NrLWVkaXRvciIpWzBdOw0KICAgIHRoaXMuZ3V0dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiYy1hdXRvbWF0b3ItYmxvY2stZWRpdG9yLS1ndXR0ZXIiKVswXTsNCiAgfSwNCg0KICBnZXQgbGluZXMoKSB7DQogICAgcmV0dXJuIHVpLnZpZXcudGFicy5yZWFsaXR5LmF1dG9tYXRvci5saW5lczsNCiAgfSwNCg0KICBzZXQgbGluZXMoYXJyKSB7DQogICAgdWkudmlldy50YWJzLnJlYWxpdHkuYXV0b21hdG9yLmxpbmVzID0gYXJyOw0KICAgIHRoaXMudXBkYXRlSWRBcnJheSgpOw0KICB9LA0KDQogIGdldCBjdXJyZW50QmxvY2tJZCgpIHsNCiAgICBpZiAoQXV0b21hdG9yQmFja2VuZC5zdGFjay5pc0VtcHR5KSByZXR1cm4gZmFsc2U7DQogICAgcmV0dXJuIHRoaXMuX2lkQXJyYXlbQXV0b21hdG9yQmFja2VuZC5zdGFjay50b3AubGluZU51bWJlciAtIDFdOw0KICB9LA0KDQogIC8vIF9pZEFycmF5IGNvbnRhaW5zIGEgbWFwcGluZyBmcm9tIGFsbCB0ZXh0IGxpbmVzIHRvIGJsb2NrIElEcyBpbiB0aGUgYmxvY2ttYXRvLCB3aGVyZSBvbmx5IGxpbmVzIHdpdGgNCiAgLy8gYWN0dWFsIGNvbW1hbmRzIGhhdmUgZGVmaW5lZCB2YWx1ZXMuIFRoaXMgbWVhbnMgdGhhdCBldmVyeSB0aW1lIGEgY2xvc2luZyBjdXJseSBicmFjZSB9IG9jY3VycywgYWxsIGZ1cnRoZXINCiAgLy8gbGluZSBudW1iZXJzIGJldHdlZW4gb24gYmxvY2sgd2lsbCBiZSBvbmUgbGVzcyB0aGFuIHRoZSBjb3JyZXNwb25kaW5nIHRleHQgbGluZSBudW1iZXINCiAgbGluZU51bWJlcih0ZXh0TGluZSkgew0KICAgIGNvbnN0IHNraXBMaW5lcyA9IHRoaXMuX2lkQXJyYXkubWFwKChpZCwgaW5kZXgpID0+IChpZCA/IC0xIDogaW5kZXggKyAxKSkuZmlsdGVyKHYgPT4gdiAhPT0gLTEpOw0KICAgIHJldHVybiB0ZXh0TGluZSAtIHNraXBMaW5lcy5jb3VudFdoZXJlKGxpbmUgPT4gbGluZSA8PSB0ZXh0TGluZSk7DQogIH0sDQoNCiAgbGluZU51bWJlckZyb21CbG9ja0lEKGlkKSB7DQogICAgcmV0dXJuIHRoaXMubGluZU51bWJlcih0aGlzLl9pZEFycmF5LmluZGV4T2YoaWQpICsgMSk7DQogIH0sDQoNCiAgLy8gVGhpcyBnZXRzIGNhbGxlZCBmcm9tIG1hbnkgcGxhY2VzIHdoaWNoIGRvIGJsb2NrIGVkaXRvciBlcnJvciBjaGVja2luZyBmb3IgdGhlIHB1cnBvc2Ugb2YgYSByZXNwb25zaXZlIFVJLCBzbw0KICAvLyB3ZSB1c2UgY2hlY2tJRCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIHNjcmlwdHMgdG8gY2hlY2suIFdoZW4gbm90IGdpdmVuLCB3ZSBhc3N1bWUgaXQncyB0aGUgY3VycmVudGx5LWRpc3BsYXllZA0KICAvLyBzY3JpcHQ7IG90aGVyd2lzZSB3ZSBuZWVkIHRvIGJlIGNhcmVmdWwgYmVjYXVzZSB3ZSdyZSBpbiB0aGUgcHJvY2VzcyBvZiBjaGFuZ2luZyBzY3JpcHRzDQogIHBhcnNlVGV4dEZyb21CbG9ja3MoY2hlY2tJRCkgew0KICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLnBhcnNlTGluZXMoQmxvY2tBdXRvbWF0b3IubGluZXMpLmpvaW4oIlxuIik7DQogICAgY29uc3QgYXV0b21hdG9ySUQgPSBjaGVja0lEID8/IHVpLnZpZXcudGFicy5yZWFsaXR5LmF1dG9tYXRvci5lZGl0b3JTY3JpcHRJRDsNCiAgICBBdXRvbWF0b3JEYXRhLnJlY2FsY3VsYXRlRXJyb3JzKCk7DQogICAgQXV0b21hdG9yQmFja2VuZC5zYXZlU2NyaXB0KGF1dG9tYXRvcklELCBjb250ZW50KTsNCiAgfSwNCg0KICB1cGRhdGVFZGl0b3Ioc2NyaXB0VGV4dCkgew0KICAgIGNvbnN0IGxpbmVzID0gYmxvY2tpZnlUZXh0QXV0b21hdG9yKHNjcmlwdFRleHQpLmJsb2NrczsNCiAgICB0aGlzLmxpbmVzID0gbGluZXM7DQogICAgcmV0dXJuIGxpbmVzOw0KICB9LA0KDQogIGhhc1VucGFyc2FibGVDb21tYW5kcyh0ZXh0KSB7DQogICAgY29uc3QgYmxvY2tpZmllZCA9IGJsb2NraWZ5VGV4dEF1dG9tYXRvcih0ZXh0KTsNCiAgICByZXR1cm4gYmxvY2tpZmllZC52YWxpZGF0ZWRCbG9ja3MgIT09IGJsb2NraWZpZWQudmlzaXRlZEJsb2NrczsNCiAgfSwNCg0KICBnZW5lcmF0ZVRleHQoYmxvY2ssIGluZGVudGF0aW9uID0gMCkgew0KICAgIC8vIFdlIGFkZCBhbiBleHRyYSB0cmFpbGluZyBzcGFjZSBoZXJlIGFuZCByZW1vdmUgZG91YmxlLXNwYWNlcyBhdCB0aGUgZW5kIGJlY2F1c2UgdGhpcyBtYWtlcyBzb21lIGNvbnZlcnNpb24NCiAgICAvLyBlcnJvcnMgc2xpZ2h0bHkgbGVzcyBoYXJzaDsgc29tZSBlcnJvcnMgd2hpY2ggd2lwZWQgZW50aXJlIGxpbmVzIG5vdyBqdXN0IGZhaWwgdG8gcGFyc2UgYXJndW1lbnRzIGluc3RlYWQNCiAgICBsZXQgcGFyc2VkID0gYCR7Ilx0Ii5yZXBlYXQoaW5kZW50YXRpb24pfSR7YmxvY2suY21kfSBgOw0KDQogICAgcGFyc2VkID0gcGFyc2VkDQogICAgICAucmVwbGFjZSgiQ09NTUVOVCIsICIvLyIpDQogICAgICAucmVwbGFjZSgiQkxPQiIsICJibG9iICAiKTsNCg0KICAgIGlmIChibG9jay5jYW5XYWl0ICYmIGJsb2NrLm5vd2FpdCkgew0KICAgICAgcGFyc2VkID0gcGFyc2VkLnJlcGxhY2UoLyhcUyspL3UsICIkMSBOT1dBSVQiKTsNCiAgICB9DQogICAgaWYgKGJsb2NrLnJlc3BlYykgcGFyc2VkICs9IGAgUkVTUEVDYDsNCg0KICAgIGNvbnN0IHByb3BzVG9DaGVjayA9IFsiZ2VuZXJpY0lucHV0MSIsICJjb21wT3BlcmF0b3IiLCAiZ2VuZXJpY0lucHV0MiIsICJzaW5nbGVTZWxlY3Rpb25JbnB1dCIsICJzaW5nbGVUZXh0SW5wdXQiXTsNCiAgICBmb3IgKGNvbnN0IHByb3Agb2YgcHJvcHNUb0NoZWNrKSB7DQogICAgICBpZiAoYmxvY2tbcHJvcF0pIHBhcnNlZCArPSBgICR7YmxvY2tbcHJvcF19YDsNCiAgICB9DQoNCiAgICBpZiAoYmxvY2suY21kID09PSAiSUYiIHx8IGJsb2NrLmNtZCA9PT0gIldISUxFIiB8fCBibG9jay5jbWQgPT09ICJVTlRJTCIpIHBhcnNlZCArPSAiIHsiOw0KDQogICAgcmV0dXJuIHBhcnNlZC5yZXBsYWNlKCIgICIsICIgIik7DQogIH0sDQoNCiAgcGFyc2VMaW5lcyhsLCBpbmRlbnRhdGlvbiA9IDApIHsNCiAgICBjb25zdCBsaW5lcyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbC5sZW5ndGg7IGkrKykgew0KICAgICAgbGluZXMucHVzaCh0aGlzLmdlbmVyYXRlVGV4dChsW2ldLCBpbmRlbnRhdGlvbikpOw0KICAgICAgaWYgKGxbaV0uY21kID09PSAiSUYiIHx8IGxbaV0uY21kID09PSAiV0hJTEUiIHx8IGxbaV0uY21kID09PSAiVU5USUwiKSB7DQogICAgICAgIGxpbmVzLnB1c2goLi4udGhpcy5wYXJzZUxpbmVzKGxbaV0ubmVzdCwgaW5kZW50YXRpb24gKyAxKSk7DQogICAgICAgIGxpbmVzLnB1c2goYCR7Ilx0Ii5yZXBlYXQoaW5kZW50YXRpb24pfX1gKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gbGluZXM7DQogIH0sDQoNCiAgYmxvY2tJZEFycmF5KGJsb2Nrcykgew0KICAgIGNvbnN0IG91dHB1dCA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7DQogICAgICBjb25zdCBiID0gYmxvY2tzW2ldOw0KICAgICAgb3V0cHV0LnB1c2goYi5pZCk7DQogICAgICBpZiAoYi5uZXN0ZWQpIG91dHB1dC5wdXNoKC4uLnRoaXMuYmxvY2tJZEFycmF5KGIubmVzdCksIHVuZGVmaW5lZCk7DQogICAgfQ0KICAgIHJldHVybiBvdXRwdXQ7DQogIH0sDQoNCiAgdXBkYXRlSWRBcnJheSgpIHsNCiAgICB0aGlzLl9pZEFycmF5ID0gdGhpcy5ibG9ja0lkQXJyYXkodGhpcy5saW5lcyk7DQogIH0sDQoNCiAgbnVtYmVyT2ZMaW5lc0luQmxvY2soYmxvY2spIHsNCiAgICByZXR1cm4gYmxvY2submVzdGVkID8gTWF0aC5tYXgoYmxvY2submVzdC5yZWR1Y2UoKHYsIGIpID0+IHYgKyB0aGlzLm51bWJlck9mTGluZXNJbkJsb2NrKGIpLCAxKSwgMikgOiAxOw0KICB9LA0KDQogIGNsZWFyRWRpdG9yKCkgew0KICAgIC8vIEkgZ2VudWluZWx5IGRvbid0IHVuZGVyc3RhbmQgd2h5IHRoaXMgbmVlZHMgdG8gYmUgZG9uZSBhc3luY2hyb25vdXNseSwgYnV0IHJlbW92aW5nIHRoZSBzZXRUaW1lb3V0IG1ha2VzIHRoaXMNCiAgICAvLyBtZXRob2Qgbm90IGRvIGFueXRoaW5nIGF0IGFsbC4gRXZlbiBzZXR0aW5nIHRoZSBhcnJheSBpbiB0aGUgY29uc29sZSB3aXRob3V0IHRoZSBzZXRUaW1lb3V0IHdvcmtzIGZpbmUuDQogICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmxpbmVzID0gW10sIDApOw0KICB9LA0KDQogIHByZXZpb3VzU2Nyb2xsUG9zaXRpb246IDAsDQp9Ow0K"},{"version":3,"sources":["AutomatorBlockEditor.vue"],"names":[],"mappings":";AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"AutomatorBlockEditor.vue","sourceRoot":"src/components/tabs/automator","sourcesContent":["<script>\r\nimport draggable from \"vuedraggable\";\r\n\r\nimport AutomatorBlockSingleRow from \"./AutomatorBlockSingleRow\";\r\nimport { blockifyTextAutomator } from \"@/core/automator\";\r\n\r\nexport default {\r\n  name: \"AutomatorBlockEditor\",\r\n  components: {\r\n    AutomatorBlockSingleRow,\r\n    draggable\r\n  },\r\n  computed: {\r\n    lines: {\r\n      get() {\r\n        return this.$viewModel.tabs.reality.automator.lines;\r\n      },\r\n      set(value) {\r\n        this.$viewModel.tabs.reality.automator.lines = value;\r\n      }\r\n    },\r\n    numberOfLines() {\r\n      return this.lines.reduce((a, l) => a + BlockAutomator.numberOfLinesInBlock(l), 0);\r\n    },\r\n  },\r\n  mounted() {\r\n    BlockAutomator.initialize();\r\n    AutomatorData.recalculateErrors();\r\n    BlockAutomator.editor.scrollTo(0, BlockAutomator.previousScrollPosition);\r\n    BlockAutomator.gutter.style.bottom = `${BlockAutomator.editor.scrollTop}px`;\r\n  },\r\n  methods: {\r\n    update() {\r\n      if (AutomatorBackend.state.followExecution) AutomatorBackend.jumpToActiveLine();\r\n      const targetLine = AutomatorBackend.isOn\r\n        ? BlockAutomator.lineNumberFromBlockID(BlockAutomator.currentBlockId)\r\n        : -1;\r\n      AutomatorHighlighter.updateHighlightedLine(targetLine, LineEnum.Active);\r\n    },\r\n    setPreviousScroll() {\r\n      BlockAutomator.previousScrollPosition = this.$refs.blockEditorElement.scrollTop;\r\n      BlockAutomator.gutter.style.bottom = `${BlockAutomator.editor.scrollTop}px`;\r\n    },\r\n    parseRequest() {\r\n      BlockAutomator.updateIdArray();\r\n      AutomatorData.recalculateErrors();\r\n      BlockAutomator.parseTextFromBlocks();\r\n    },\r\n    updateBlock(block, id) {\r\n      this.lines[this.lines.findIndex(x => x.id === id)] = block;\r\n      this.parseRequest();\r\n    },\r\n    deleteBlock(id) {\r\n      const idx = this.lines.findIndex(x => x.id === id);\r\n      this.lines.splice(idx, 1);\r\n      this.parseRequest();\r\n    },\r\n  }\r\n};\r\n\r\nexport const BlockAutomator = {\r\n  editor: null,\r\n  gutter: null,\r\n  _idArray: [],\r\n\r\n  initialize() {\r\n    this.editor = document.getElementsByClassName(\"c-automator-block-editor\")[0];\r\n    this.gutter = document.getElementsByClassName(\"c-automator-block-editor--gutter\")[0];\r\n  },\r\n\r\n  get lines() {\r\n    return ui.view.tabs.reality.automator.lines;\r\n  },\r\n\r\n  set lines(arr) {\r\n    ui.view.tabs.reality.automator.lines = arr;\r\n    this.updateIdArray();\r\n  },\r\n\r\n  get currentBlockId() {\r\n    if (AutomatorBackend.stack.isEmpty) return false;\r\n    return this._idArray[AutomatorBackend.stack.top.lineNumber - 1];\r\n  },\r\n\r\n  // _idArray contains a mapping from all text lines to block IDs in the blockmato, where only lines with\r\n  // actual commands have defined values. This means that every time a closing curly brace } occurs, all further\r\n  // line numbers between on block will be one less than the corresponding text line number\r\n  lineNumber(textLine) {\r\n    const skipLines = this._idArray.map((id, index) => (id ? -1 : index + 1)).filter(v => v !== -1);\r\n    return textLine - skipLines.countWhere(line => line <= textLine);\r\n  },\r\n\r\n  lineNumberFromBlockID(id) {\r\n    return this.lineNumber(this._idArray.indexOf(id) + 1);\r\n  },\r\n\r\n  // This gets called from many places which do block editor error checking for the purpose of a responsive UI, so\r\n  // we use checkID to distinguish between scripts to check. When not given, we assume it's the currently-displayed\r\n  // script; otherwise we need to be careful because we're in the process of changing scripts\r\n  parseTextFromBlocks(checkID) {\r\n    const content = this.parseLines(BlockAutomator.lines).join(\"\\n\");\r\n    const automatorID = checkID ?? ui.view.tabs.reality.automator.editorScriptID;\r\n    AutomatorData.recalculateErrors();\r\n    AutomatorBackend.saveScript(automatorID, content);\r\n  },\r\n\r\n  updateEditor(scriptText) {\r\n    const lines = blockifyTextAutomator(scriptText).blocks;\r\n    this.lines = lines;\r\n    return lines;\r\n  },\r\n\r\n  hasUnparsableCommands(text) {\r\n    const blockified = blockifyTextAutomator(text);\r\n    return blockified.validatedBlocks !== blockified.visitedBlocks;\r\n  },\r\n\r\n  generateText(block, indentation = 0) {\r\n    // We add an extra trailing space here and remove double-spaces at the end because this makes some conversion\r\n    // errors slightly less harsh; some errors which wiped entire lines now just fail to parse arguments instead\r\n    let parsed = `${\"\\t\".repeat(indentation)}${block.cmd} `;\r\n\r\n    parsed = parsed\r\n      .replace(\"COMMENT\", \"//\")\r\n      .replace(\"BLOB\", \"blob  \");\r\n\r\n    if (block.canWait && block.nowait) {\r\n      parsed = parsed.replace(/(\\S+)/u, \"$1 NOWAIT\");\r\n    }\r\n    if (block.respec) parsed += ` RESPEC`;\r\n\r\n    const propsToCheck = [\"genericInput1\", \"compOperator\", \"genericInput2\", \"singleSelectionInput\", \"singleTextInput\"];\r\n    for (const prop of propsToCheck) {\r\n      if (block[prop]) parsed += ` ${block[prop]}`;\r\n    }\r\n\r\n    if (block.cmd === \"IF\" || block.cmd === \"WHILE\" || block.cmd === \"UNTIL\") parsed += \" {\";\r\n\r\n    return parsed.replace(\"  \", \" \");\r\n  },\r\n\r\n  parseLines(l, indentation = 0) {\r\n    const lines = [];\r\n    for (let i = 0; i < l.length; i++) {\r\n      lines.push(this.generateText(l[i], indentation));\r\n      if (l[i].cmd === \"IF\" || l[i].cmd === \"WHILE\" || l[i].cmd === \"UNTIL\") {\r\n        lines.push(...this.parseLines(l[i].nest, indentation + 1));\r\n        lines.push(`${\"\\t\".repeat(indentation)}}`);\r\n      }\r\n    }\r\n\r\n    return lines;\r\n  },\r\n\r\n  blockIdArray(blocks) {\r\n    const output = [];\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      const b = blocks[i];\r\n      output.push(b.id);\r\n      if (b.nested) output.push(...this.blockIdArray(b.nest), undefined);\r\n    }\r\n    return output;\r\n  },\r\n\r\n  updateIdArray() {\r\n    this._idArray = this.blockIdArray(this.lines);\r\n  },\r\n\r\n  numberOfLinesInBlock(block) {\r\n    return block.nested ? Math.max(block.nest.reduce((v, b) => v + this.numberOfLinesInBlock(b), 1), 2) : 1;\r\n  },\r\n\r\n  clearEditor() {\r\n    // I genuinely don't understand why this needs to be done asynchronously, but removing the setTimeout makes this\r\n    // method not do anything at all. Even setting the array in the console without the setTimeout works fine.\r\n    setTimeout(() => this.lines = [], 0);\r\n  },\r\n\r\n  previousScrollPosition: 0,\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"c-automator-block-editor--container\">\r\n    <div\r\n      ref=\"editorGutter\"\r\n      class=\"c-automator-block-editor--gutter\"\r\n    >\r\n      <div\r\n        v-for=\"i in numberOfLines\"\r\n        :key=\"i\"\r\n        class=\"c-automator-block-line-number\"\r\n        :style=\"{\r\n          top: `${(i - 1) * 3.45}rem`\r\n        }\"\r\n      >\r\n        {{ i }}\r\n      </div>\r\n    </div>\r\n    <div\r\n      ref=\"blockEditorElement\"\r\n      class=\"c-automator-block-editor\"\r\n      @scroll=\"setPreviousScroll()\"\r\n    >\r\n      <draggable\r\n        v-model=\"lines\"\r\n        group=\"code-blocks\"\r\n        class=\"c-automator-blocks\"\r\n        ghost-class=\"c-automator-block-row-ghost\"\r\n        @end=\"parseRequest\"\r\n      >\r\n        <AutomatorBlockSingleRow\r\n          v-for=\"(block, lineNum) in lines\"\r\n          :key=\"block.id + 10000 * lineNum\"\r\n          :block=\"block\"\r\n          :update-block=\"updateBlock\"\r\n          :delete-block=\"deleteBlock\"\r\n        />\r\n      </draggable>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.c-automator-block-editor {\r\n  display: flex;\r\n  overflow-y: auto;\r\n  tab-size: 1.5rem;\r\n  width: 100%;\r\n  background-color: var(--color-blockmator-editor-background);\r\n  box-sizing: content-box;\r\n}\r\n\r\n.c-automator-block-editor--container {\r\n  display: flex;\r\n  overflow-y: hidden;\r\n  height: 100%;\r\n  position: relative;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.c-automator-blocks {\r\n  width: 100%;\r\n  height: max-content;\r\n  padding: 0.3rem 0.6rem 5rem;\r\n}\r\n\r\n.c-automator-block-editor--gutter {\r\n  height: max-content;\r\n  min-height: 100%;\r\n  position: relative;\r\n  background-color: var(--color-automator-controls-background);\r\n  border-right: 0.1rem solid #505050;\r\n  /* left and right paddings are 1 to make space for text, bottom padding is 20 to make for a buffer */\r\n  padding: 0.3rem 1rem 20rem;\r\n}\r\n\r\n.c-automator-block-line-number {\r\n  display: flex;\r\n  height: 3.45rem;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n  font-size: 1.4rem;\r\n  color: var(--color-automator-docs-font);\r\n}\r\n\r\n.null-block {\r\n  display: none;\r\n  visibility: hidden;\r\n}\r\n</style>\r\n"]}]}