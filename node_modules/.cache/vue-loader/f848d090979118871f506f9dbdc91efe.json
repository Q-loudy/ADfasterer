{"remainingRequest":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\@vue\\vue-loader-v15\\lib\\index.js??vue-loader-options!C:\\Games\\ADFasterer\\ADfasterer\\src\\components\\tabs\\automator\\AutomatorTextEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Games\\ADFasterer\\ADfasterer\\src\\components\\tabs\\automator\\AutomatorTextEditor.vue","mtime":1745241597091},{"path":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\babel-loader\\lib\\index.js","mtime":1745242219290},{"path":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1745242214069},{"path":"C:\\Games\\ADFasterer\\ADfasterer\\node_modules\\@vue\\vue-loader-v15\\lib\\index.js","mtime":1745242220175}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJBdXRvbWF0b3JUZXh0RWRpdG9yIiwNCiAgcHJvcHM6IHsNCiAgICBjdXJyZW50U2NyaXB0SWQ6IHsNCiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sDQogICAgICByZXF1aXJlZDogdHJ1ZQ0KICAgIH0sDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIG1hcmtlZExpbmVOdW1iZXI6IDAsDQogICAgICB1bmNsZWFyZWRMaW5lczogZmFsc2UsDQogICAgICBpc0FjdGl2ZVNjcmlwdDogZmFsc2UsDQogICAgfTsNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBVSSgpIHsNCiAgICAgIEF1dG9tYXRvclRleHRVSS5pbml0aWFsaXplKCk7DQogICAgICByZXR1cm4gQXV0b21hdG9yVGV4dFVJOw0KICAgIH0sDQogICAgZnVsbFNjcmVlbigpIHsNCiAgICAgIHJldHVybiB0aGlzLiR2aWV3TW9kZWwudGFicy5yZWFsaXR5LmF1dG9tYXRvci5mdWxsU2NyZWVuOw0KICAgIH0sDQogIH0sDQogIHdhdGNoOiB7DQogICAgY3VycmVudFNjcmlwdElkOiB7DQogICAgICBoYW5kbGVyKGlkLCBvbGRJZCkgew0KICAgICAgICB0aGlzLnVubWFya0FjdGl2ZUxpbmUoKTsNCiAgICAgICAgY29uc3Qgc3RvcmVkU2NyaXB0cyA9IHBsYXllci5yZWFsaXR5LmF1dG9tYXRvci5zY3JpcHRzOw0KICAgICAgICBpZiAoIXRoaXMuVUkuZG9jdW1lbnRzW2lkXSB8fCB0aGlzLlVJLmRvY3VtZW50c1tpZF0uZ2V0VmFsdWUoKSAhPT0gc3RvcmVkU2NyaXB0c1tpZF0uY29udGVudCkgew0KICAgICAgICAgIHRoaXMuVUkuZG9jdW1lbnRzW2lkXSA9IENvZGVNaXJyb3IuRG9jKHN0b3JlZFNjcmlwdHNbaWRdLmNvbnRlbnQsICJhdXRvbWF0byIpOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLlVJLmVkaXRvci5nZXREb2MoKSAhPT0gdGhpcy5VSS5kb2N1bWVudHNbaWRdKSB0aGlzLlVJLmVkaXRvci5zd2FwRG9jKHRoaXMuVUkuZG9jdW1lbnRzW2lkXSk7DQogICAgICAgIC8vIFdoZW4gYSBzY3JpcHQgZ2V0cyBkZWxldGVkLCBnZXQgcmlkIG9mIHRoZSBvbGQgZG9jdW1lbnQgb2JqZWN0DQogICAgICAgIGlmICh0aGlzLlVJLmRvY3VtZW50c1tvbGRJZF0gIT09IHVuZGVmaW5lZCAmJiBzdG9yZWRTY3JpcHRzW29sZElkXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgZGVsZXRlIHRoaXMuVUkuZG9jdW1lbnRzW29sZElkXTsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICB9LA0KICAgIGZ1bGxTY3JlZW4oKSB7DQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB0aGlzLlVJLmVkaXRvci5yZWZyZXNoKCkpOw0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICBBdXRvbWF0b3JUZXh0VUkuaW5pdGlhbGl6ZSgpOw0KICAgIHRoaXMub24kKEdBTUVfRVZFTlQuR0FNRV9MT0FELCAoKSA9PiB0aGlzLm9uR2FtZUxvYWQoKSk7DQogICAgdGhpcy5vbiQoR0FNRV9FVkVOVC5BVVRPTUFUT1JfU0FWRV9DSEFOR0VELCAoKSA9PiB0aGlzLm9uR2FtZUxvYWQoKSk7DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy4kcmVmcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5VSS5jb250YWluZXIpOw0KICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgIHRoaXMuVUkuZWRpdG9yLnJlZnJlc2goKTsNCiAgICAgIHRoaXMuVUkuZWRpdG9yLnBlcmZvcm1MaW50KCk7DQogICAgICB0aGlzLlVJLmVkaXRvci5zY3JvbGxUbyhudWxsLCBBdXRvbWF0b3JUZXh0VUkuc2F2ZWRWZXJ0UG9zKTsNCiAgICB9KTsNCiAgfSwNCiAgYmVmb3JlRGVzdHJveSgpIHsNCiAgICAvLyBUaGlzIHdpbGwgc3RpY2sgYXJvdW5kLCBvdGhlcndpc2UNCiAgICBBdXRvbWF0b3JIaWdobGlnaHRlci5jbGVhckFsbEhpZ2hsaWdodGVkTGluZXMoKTsNCiAgICBBdXRvbWF0b3JUZXh0VUkuc2F2ZWRWZXJ0UG9zID0gQXV0b21hdG9yVGV4dFVJLmVkaXRvci5kb2Muc2Nyb2xsVG9wOw0KICAgIHRoaXMuJHJlZnMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuVUkuY29udGFpbmVyKTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHVwZGF0ZSgpIHsNCiAgICAgIEF1dG9tYXRvckJhY2tlbmQuanVtcFRvQWN0aXZlTGluZSgpOw0KICAgICAgaWYgKHRoaXMudW5jbGVhcmVkTGluZXMgJiYgIUF1dG9tYXRvckJhY2tlbmQuaXNPbikgdGhpcy5jbGVhckFsbEFjdGl2ZUxpbmVzKCk7DQogICAgICBpZiAoQXV0b21hdG9yQmFja2VuZC5pc09uKSB7DQogICAgICAgIHRoaXMuc2V0QWN0aXZlU3RhdGUoYCR7QXV0b21hdG9yQmFja2VuZC5zdGF0ZS50b3BMZXZlbFNjcmlwdH1gLCBBdXRvbWF0b3JCYWNrZW5kLnN0YWNrLnRvcC5saW5lTnVtYmVyKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuc2V0QWN0aXZlU3RhdGUoIiIsIC0xKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG9uR2FtZUxvYWQoKSB7DQogICAgICB0aGlzLlVJLmRvY3VtZW50cyA9IHt9Ow0KICAgIH0sDQogICAgdW5tYXJrQWN0aXZlTGluZSgpIHsNCiAgICAgIEF1dG9tYXRvckhpZ2hsaWdodGVyLnVwZGF0ZUhpZ2hsaWdodGVkTGluZSgtMSwgTGluZUVudW0uQWN0aXZlKTsNCiAgICB9LA0KICAgIG1hcmtBY3RpdmVMaW5lKGxpbmVOdW1iZXIpIHsNCiAgICAgIEF1dG9tYXRvckhpZ2hsaWdodGVyLnVwZGF0ZUhpZ2hsaWdodGVkTGluZShsaW5lTnVtYmVyLCBMaW5lRW51bS5BY3RpdmUpOw0KICAgICAgdGhpcy51bmNsZWFyZWRMaW5lcyA9IHRydWU7DQogICAgfSwNCiAgICAvLyBUaGlzIG9ubHkgcnVucyB3aGVuIGEgc2NyaXB0IGlzIGludGVycnVwdGVkIGFuZCBzdG9wcyBkdXJpbmcgZXhlY3V0aW9uIGJlY2F1c2Ugb2YgdGhlIHBsYXllciBlZGl0aW5nIHRoZSB0ZXh0DQogICAgY2xlYXJBbGxBY3RpdmVMaW5lcygpIHsNCiAgICAgIEF1dG9tYXRvckhpZ2hsaWdodGVyLmNsZWFyQWxsSGlnaGxpZ2h0ZWRMaW5lcygpOw0KICAgICAgdGhpcy51bmNsZWFyZWRMaW5lcyA9IGZhbHNlOw0KICAgIH0sDQogICAgc2V0QWN0aXZlU3RhdGUoc2NyaXB0SUQsIGxpbmVOdW1iZXIpIHsNCiAgICAgIGlmIChgJHt0aGlzLmN1cnJlbnRTY3JpcHRJZH1gID09PSBzY3JpcHRJRCkgdGhpcy5tYXJrQWN0aXZlTGluZShsaW5lTnVtYmVyKTsNCiAgICAgIGVsc2UgdGhpcy51bm1hcmtBY3RpdmVMaW5lKCk7DQogICAgfSwNCiAgfQ0KfTsNCg0KZXhwb3J0IGNvbnN0IEF1dG9tYXRvclRleHRVSSA9IHsNCiAgZG9jdW1lbnRzOiB7fSwNCiAgd3JhcHBlcjogbnVsbCwNCiAgZWRpdG9yOiBudWxsLA0KICBjb250YWluZXI6IG51bGwsDQogIHRleHRBcmVhOiBudWxsLA0KICBtb2RlOiB7DQogICAgbW9kZTogImF1dG9tYXRvIiwNCiAgICBsaW50OiAiYXV0b21hdG8iLA0KICAgIGxpbmVOdW1iZXJzOiB0cnVlLA0KICAgIHRoZW1lOiAibGlxdWlieXRlIiwNCiAgICB0YWJTaXplOiAyLA0KICAgIGV4dHJhS2V5czogew0KICAgICAgVGFiOiBjbSA9PiBjbS5leGVjQ29tbWFuZCgiaW5kZW50TW9yZSIpLA0KICAgICAgIlNoaWZ0LVRhYiI6IGNtID0+IGNtLmV4ZWNDb21tYW5kKCJpbmRlbnRMZXNzIiksDQogICAgfSwNCiAgICBhdXRvQ2xvc2VCcmFja2V0czogdHJ1ZSwNCiAgICBsaW5lV3JhcHBpbmc6IHRydWUNCiAgfSwNCiAgaW5pdGlhbGl6ZSgpIHsNCiAgICBpZiAodGhpcy5jb250YWluZXIpIHJldHVybjsNCiAgICB0aGlzLnNldFVwQ29udGFpbmVyKCk7DQogICAgdGhpcy5zZXRVcEVkaXRvcigpOw0KICAgIEV2ZW50SHViLnVpLm9uKEdBTUVfRVZFTlQuR0FNRV9MT0FELCAoKSA9PiB0aGlzLmRvY3VtZW50cyA9IHt9KTsNCiAgfSwNCiAgc2V0VXBDb250YWluZXIoKSB7DQogICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAibC1hdXRvbWF0b3ItZWRpdG9yX19jb2RlbWlycm9yLWNvbnRhaW5lciI7DQogICAgdGhpcy50ZXh0QXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7DQogICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy50ZXh0QXJlYSk7DQogIH0sDQogIHNldFVwRWRpdG9yKCkgew0KICAgIHRoaXMuZWRpdG9yID0gQ29kZU1pcnJvci5mcm9tVGV4dEFyZWEodGhpcy50ZXh0QXJlYSwgdGhpcy5tb2RlKTsNCiAgICAvLyBDb2RlTWlycm9yIGhhcyBhIGJ1aWx0LWluIHVuZG8vcmVkbyBmdW5jdGlvbmFsaXR5IGJvdW5kIHRvIGN0cmwtei9jdHJsLXkgd2hpY2ggZG9lc24ndCBoYXZlIGFuDQogICAgLy8gZWFzaWx5LWNvbmZpZ3VyZWQgaGlzdG9yeSBidWZmZXI7IHdlIG5lZWQgdG8gc3BlY2lmaWNhbGx5IGNhbmNlbCB0aGlzIGV2ZW50IHNpbmNlIHdlIGhhdmUgb3VyIG93biB1bmRvDQogICAgdGhpcy5lZGl0b3Iub24oImJlZm9yZUNoYW5nZSIsIChfLCBldmVudCkgPT4gew0KICAgICAgaWYgKGV2ZW50Lm9yaWdpbiA9PT0gInVuZG8iKSBldmVudC5jYW5jZWwoKTsNCiAgICB9KTsNCiAgICB0aGlzLmVkaXRvci5vbigia2V5ZG93biIsIChlZGl0b3IsIGV2ZW50KSA9PiB7DQogICAgICBjb25zdCBrZXkgPSBldmVudC5rZXk7DQogICAgICBpZiAoZXZlbnQuY3RybEtleSAmJiBbInoiLCAieSJdLmluY2x1ZGVzKGtleSkpIHsNCiAgICAgICAgaWYgKGtleSA9PT0gInoiKSBBdXRvbWF0b3JEYXRhLnVuZG9TY3JpcHRFZGl0KCk7DQogICAgICAgIGlmIChrZXkgPT09ICJ5IikgQXV0b21hdG9yRGF0YS5yZWRvU2NyaXB0RWRpdCgpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICAvLyBUaGlzIGNoZWNrIGlzIHJlbGF0ZWQgdG8gdGhlIGRyb3AtZG93biBjb21tYW5kIHN1Z2dlc3Rpb24gbWVudSwgYnV0IG11c3QgY29tZSBhZnRlciB0aGUgdW5kby9yZWRvIGNoZWNrDQogICAgICAvLyBhcyBpdCBvZnRlbiBldmFsdWF0ZXMgdG8gaW5ub2N1b3VzIGZhbHNlIHBvc2l0aXZlcyB3aGljaCBlYXQgdGhlIGtleWJpbmRzDQogICAgICBpZiAoZWRpdG9yLnN0YXRlLmNvbXBsZXRpb25BY3RpdmUpIHJldHVybjsNCiAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50LmFsdEtleSB8fCBldmVudC5tZXRhS2V5IHx8ICEvXlthLXpBLVowLTkgXHRdJC91LnRlc3Qoa2V5KSkgcmV0dXJuOw0KICAgICAgQ29kZU1pcnJvci5jb21tYW5kcy5hdXRvY29tcGxldGUoZWRpdG9yLCBudWxsLCB7IGNvbXBsZXRlU2luZ2xlOiBmYWxzZSB9KTsNCiAgICB9KTsNCiAgICB0aGlzLmVkaXRvci5vbigiY2hhbmdlIiwgKGVkaXRvciwgZXZlbnQpID0+IHsNCiAgICAgIGNvbnN0IHNjcmlwdElEID0gdWkudmlldy50YWJzLnJlYWxpdHkuYXV0b21hdG9yLmVkaXRvclNjcmlwdElEOw0KICAgICAgY29uc3Qgc2NyaXB0VGV4dCA9IGVkaXRvci5nZXREb2MoKS5nZXRWYWx1ZSgpOw0KICAgICAgLy8gVW5kby9yZWRvIGRpcmVjdGx5IGNoYW5nZXMgdGhlIGVkaXRvciBjb250ZW50cywgd2hpY2ggYWxzbyBjYXVzZXMgdGhpcyBldmVudCB0byBiZSBmaXJlZDsgd2UgaGF2ZSBhIGZldw0KICAgICAgLy8gdGhpbmdzIHdoaWNoIHdlIHNwZWNpZmljYWxseSBvbmx5IHdhbnQgdG8gZG8gb24gbWFudWFsIHR5cGluZyBjaGFuZ2VzDQogICAgICBpZiAoZXZlbnQub3JpZ2luICE9PSAic2V0VmFsdWUiKSB7DQogICAgICAgIEF1dG9tYXRvckJhY2tlbmQuc2F2ZVNjcmlwdChzY3JpcHRJRCwgc2NyaXB0VGV4dCk7DQogICAgICAgIEF1dG9tYXRvckRhdGEucmVkb0J1ZmZlciA9IFtdOw0KICAgICAgfQ0KDQogICAgICBBdXRvbWF0b3JEYXRhLnJlY2FsY3VsYXRlRXJyb3JzKCk7DQogICAgICBjb25zdCBlcnJvcnMgPSBBdXRvbWF0b3JEYXRhLmN1cnJlbnRFcnJvcnMoKS5sZW5ndGg7DQogICAgICBpZiAoZXJyb3JzID4gZWRpdG9yLmRvYy5zaXplKSBTZWNyZXRBY2hpZXZlbWVudCg0OCkudW5sb2NrKCk7DQoNCiAgICAgIC8vIENsZWFyIGFsbCBsaW5lIGhpZ2hsaWdodGluZyBhcyBzb29uIGFzIGFueSB0ZXh0IGlzIGNoYW5nZWQgYmVjYXVzZSB0aGF0IG1pZ2h0IGhhdmUgc2hpZnRlZCBsaW5lcyBhcm91bmQNCiAgICAgIEF1dG9tYXRvckhpZ2hsaWdodGVyLmNsZWFyQWxsSGlnaGxpZ2h0ZWRMaW5lcygpOw0KICAgIH0pOw0KICB9LA0KICBjbGVhckVkaXRvcigpIHsNCiAgICAvLyBJbiBzb21lIGltcG9ydGluZyBjYXNlcyAobW9zdGx5IHdoZW4gaW1wb3J0aW5nIGEgc2F2ZSB3aXRob3V0IHRoZSBhdXRvbWF0b3IgdW5sb2NrZWQpLCB0aGUgZWRpdG9yIGRvZXNuJ3QgZXhpc3QNCiAgICAvLyBhbmQgYXR0ZW1wdGluZyB0byBtb2RpZnkgaXQgd2lsbCBjYXVzZSBjb25zb2xlIGVycm9yczsgaW4gdGhpcyBjYXNlIHdlIGluaXRpYWxpemUgaXQgdG8gYSBibGFuayBlZGl0b3IgKGV2ZW4NCiAgICAvLyB0aG91Z2ggaXRzIGluYWNjZXNzaWJsZSkgaW4gb3JkZXIgdG8gcHJldmVudCBlcnJvcnMgb24tbG9hZCBhbmQgd2hlbiBmaXJzdCBjaGVja2luZyB0aGF0IHN1YnRhYg0KICAgIGlmICghdGhpcy5lZGl0b3IpIHsNCiAgICAgIHRoaXMuc2V0VXBDb250YWluZXIoKTsNCiAgICAgIHRoaXMuc2V0VXBFZGl0b3IoKTsNCiAgICB9DQogICAgdGhpcy5lZGl0b3Iuc2V0VmFsdWUoIiIpOw0KICAgIHRoaXMuZWRpdG9yLmNsZWFySGlzdG9yeSgpOw0KICAgIHRoaXMuZWRpdG9yLmNsZWFyR3V0dGVyKCJndXR0ZXJJZCIpOw0KICB9LA0KICAvLyBVc2VkIHRvIHJldHVybiBiYWNrIHRvIHRoZSBzYW1lIGxpbmUgdGhlIGVkaXRvciB3YXMgb24gZnJvbSBiZWZvcmUgc3dpdGNoaW5nIHRhYnMNCiAgc2F2ZWRWZXJ0UG9zOiAwLA0KfTsNCg=="},{"version":3,"sources":["AutomatorTextEditor.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AutomatorTextEditor.vue","sourceRoot":"src/components/tabs/automator","sourcesContent":["<script>\r\nexport default {\r\n  name: \"AutomatorTextEditor\",\r\n  props: {\r\n    currentScriptId: {\r\n      type: [Number, String],\r\n      required: true\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      markedLineNumber: 0,\r\n      unclearedLines: false,\r\n      isActiveScript: false,\r\n    };\r\n  },\r\n  computed: {\r\n    UI() {\r\n      AutomatorTextUI.initialize();\r\n      return AutomatorTextUI;\r\n    },\r\n    fullScreen() {\r\n      return this.$viewModel.tabs.reality.automator.fullScreen;\r\n    },\r\n  },\r\n  watch: {\r\n    currentScriptId: {\r\n      handler(id, oldId) {\r\n        this.unmarkActiveLine();\r\n        const storedScripts = player.reality.automator.scripts;\r\n        if (!this.UI.documents[id] || this.UI.documents[id].getValue() !== storedScripts[id].content) {\r\n          this.UI.documents[id] = CodeMirror.Doc(storedScripts[id].content, \"automato\");\r\n        }\r\n        if (this.UI.editor.getDoc() !== this.UI.documents[id]) this.UI.editor.swapDoc(this.UI.documents[id]);\r\n        // When a script gets deleted, get rid of the old document object\r\n        if (this.UI.documents[oldId] !== undefined && storedScripts[oldId] === undefined) {\r\n          delete this.UI.documents[oldId];\r\n        }\r\n      },\r\n      immediate: true,\r\n    },\r\n    fullScreen() {\r\n      this.$nextTick(() => this.UI.editor.refresh());\r\n    }\r\n  },\r\n  created() {\r\n    AutomatorTextUI.initialize();\r\n    this.on$(GAME_EVENT.GAME_LOAD, () => this.onGameLoad());\r\n    this.on$(GAME_EVENT.AUTOMATOR_SAVE_CHANGED, () => this.onGameLoad());\r\n  },\r\n  mounted() {\r\n    this.$refs.container.appendChild(this.UI.container);\r\n    this.$nextTick(() => {\r\n      this.UI.editor.refresh();\r\n      this.UI.editor.performLint();\r\n      this.UI.editor.scrollTo(null, AutomatorTextUI.savedVertPos);\r\n    });\r\n  },\r\n  beforeDestroy() {\r\n    // This will stick around, otherwise\r\n    AutomatorHighlighter.clearAllHighlightedLines();\r\n    AutomatorTextUI.savedVertPos = AutomatorTextUI.editor.doc.scrollTop;\r\n    this.$refs.container.removeChild(this.UI.container);\r\n  },\r\n  methods: {\r\n    update() {\r\n      AutomatorBackend.jumpToActiveLine();\r\n      if (this.unclearedLines && !AutomatorBackend.isOn) this.clearAllActiveLines();\r\n      if (AutomatorBackend.isOn) {\r\n        this.setActiveState(`${AutomatorBackend.state.topLevelScript}`, AutomatorBackend.stack.top.lineNumber);\r\n      } else {\r\n        this.setActiveState(\"\", -1);\r\n      }\r\n    },\r\n    onGameLoad() {\r\n      this.UI.documents = {};\r\n    },\r\n    unmarkActiveLine() {\r\n      AutomatorHighlighter.updateHighlightedLine(-1, LineEnum.Active);\r\n    },\r\n    markActiveLine(lineNumber) {\r\n      AutomatorHighlighter.updateHighlightedLine(lineNumber, LineEnum.Active);\r\n      this.unclearedLines = true;\r\n    },\r\n    // This only runs when a script is interrupted and stops during execution because of the player editing the text\r\n    clearAllActiveLines() {\r\n      AutomatorHighlighter.clearAllHighlightedLines();\r\n      this.unclearedLines = false;\r\n    },\r\n    setActiveState(scriptID, lineNumber) {\r\n      if (`${this.currentScriptId}` === scriptID) this.markActiveLine(lineNumber);\r\n      else this.unmarkActiveLine();\r\n    },\r\n  }\r\n};\r\n\r\nexport const AutomatorTextUI = {\r\n  documents: {},\r\n  wrapper: null,\r\n  editor: null,\r\n  container: null,\r\n  textArea: null,\r\n  mode: {\r\n    mode: \"automato\",\r\n    lint: \"automato\",\r\n    lineNumbers: true,\r\n    theme: \"liquibyte\",\r\n    tabSize: 2,\r\n    extraKeys: {\r\n      Tab: cm => cm.execCommand(\"indentMore\"),\r\n      \"Shift-Tab\": cm => cm.execCommand(\"indentLess\"),\r\n    },\r\n    autoCloseBrackets: true,\r\n    lineWrapping: true\r\n  },\r\n  initialize() {\r\n    if (this.container) return;\r\n    this.setUpContainer();\r\n    this.setUpEditor();\r\n    EventHub.ui.on(GAME_EVENT.GAME_LOAD, () => this.documents = {});\r\n  },\r\n  setUpContainer() {\r\n    this.container = document.createElement(\"div\");\r\n    this.container.className = \"l-automator-editor__codemirror-container\";\r\n    this.textArea = document.createElement(\"textarea\");\r\n    this.container.appendChild(this.textArea);\r\n  },\r\n  setUpEditor() {\r\n    this.editor = CodeMirror.fromTextArea(this.textArea, this.mode);\r\n    // CodeMirror has a built-in undo/redo functionality bound to ctrl-z/ctrl-y which doesn't have an\r\n    // easily-configured history buffer; we need to specifically cancel this event since we have our own undo\r\n    this.editor.on(\"beforeChange\", (_, event) => {\r\n      if (event.origin === \"undo\") event.cancel();\r\n    });\r\n    this.editor.on(\"keydown\", (editor, event) => {\r\n      const key = event.key;\r\n      if (event.ctrlKey && [\"z\", \"y\"].includes(key)) {\r\n        if (key === \"z\") AutomatorData.undoScriptEdit();\r\n        if (key === \"y\") AutomatorData.redoScriptEdit();\r\n        return;\r\n      }\r\n      // This check is related to the drop-down command suggestion menu, but must come after the undo/redo check\r\n      // as it often evaluates to innocuous false positives which eat the keybinds\r\n      if (editor.state.completionActive) return;\r\n      if (event.ctrlKey || event.altKey || event.metaKey || !/^[a-zA-Z0-9 \\t]$/u.test(key)) return;\r\n      CodeMirror.commands.autocomplete(editor, null, { completeSingle: false });\r\n    });\r\n    this.editor.on(\"change\", (editor, event) => {\r\n      const scriptID = ui.view.tabs.reality.automator.editorScriptID;\r\n      const scriptText = editor.getDoc().getValue();\r\n      // Undo/redo directly changes the editor contents, which also causes this event to be fired; we have a few\r\n      // things which we specifically only want to do on manual typing changes\r\n      if (event.origin !== \"setValue\") {\r\n        AutomatorBackend.saveScript(scriptID, scriptText);\r\n        AutomatorData.redoBuffer = [];\r\n      }\r\n\r\n      AutomatorData.recalculateErrors();\r\n      const errors = AutomatorData.currentErrors().length;\r\n      if (errors > editor.doc.size) SecretAchievement(48).unlock();\r\n\r\n      // Clear all line highlighting as soon as any text is changed because that might have shifted lines around\r\n      AutomatorHighlighter.clearAllHighlightedLines();\r\n    });\r\n  },\r\n  clearEditor() {\r\n    // In some importing cases (mostly when importing a save without the automator unlocked), the editor doesn't exist\r\n    // and attempting to modify it will cause console errors; in this case we initialize it to a blank editor (even\r\n    // though its inaccessible) in order to prevent errors on-load and when first checking that subtab\r\n    if (!this.editor) {\r\n      this.setUpContainer();\r\n      this.setUpEditor();\r\n    }\r\n    this.editor.setValue(\"\");\r\n    this.editor.clearHistory();\r\n    this.editor.clearGutter(\"gutterId\");\r\n  },\r\n  // Used to return back to the same line the editor was on from before switching tabs\r\n  savedVertPos: 0,\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    ref=\"container\"\r\n    class=\"c-automator-editor l-automator-editor l-automator-pane__content\"\r\n  />\r\n</template>\r\n"]}]}